
(function(){'use strict';var NS='common.controllers';angular.module(NS,[]);}());(function(){'use strict';angular.module('common.controllers').controller('OmnitureCtrl',['$scope','omnitureService','OMNITURE_EVENTS',function($scope,omnitureService,OMNITURE_EVENTS){$scope.$on(OMNITURE_EVENTS.CTA_CLICK,function(event,ctaText){omnitureService.ctaClick(ctaText);});$scope.$on(OMNITURE_EVENTS.ADP.ADP_LOAD,function(event,args){omnitureService.adpPageLoad(args);});$scope.$on(OMNITURE_EVENTS.ADP.FILE_DOWNLOAD,function(event,args){omnitureService.adpDownload(args);});$scope.$on(OMNITURE_EVENTS.LB_TOGGLE,function(event,args){omnitureService.toggleLightbox(args);});$scope.$on(OMNITURE_EVENTS.LB_ADD,function(event,args){omnitureService.addToLightbox(args);});$scope.$on(OMNITURE_EVENTS.LB_CREATE,function(event,args){omnitureService.createLightbox(args);});$scope.$on(OMNITURE_EVENTS.ADP.SIMILAR_FILE_CLICK,function(){omnitureService.similarFileClick();});$scope.$on(OMNITURE_EVENTS.ADP.FILE_ZOOM_CLICK,function(event,args){omnitureService.fileZoomClick(args);});}]);}());(function(){'use strict';var NS='common.constants';angular.module(NS,[]);}());(function(){'use strict';var APP=angular.module('common.constants');APP.constant('ERROR_MESSAGING',{LIGHTBOX_ERROR:'LIGHTBOX_ERROR',DROPBOX_ERROR:{OAUTH_TOKEN_BROKEN:'OAUTH_TOKEN_BROKEN',API_LIMIT_ERROR:'API_LIMIT_ERROR',SERVER_ERROR:'SERVER_ERROR',STORAGE_FULL:'STORAGE_FULL',ERROR:'ERROR'}});})();(function(){'use strict';angular.module('common.constants').constant('OMNITURE_EVENTS',{CTA_CLICK:'cta-click',LB_CREATE:'lb-create',LB_ADD:'lb-add',LB_TOGGLE:'lb-toggle',ADP:{ADP_LOAD:'adp-load',SIMILAR_FILE_CLICK:'adp-similar-file-click',FILE_ZOOM_CLICK:'adp-file-zoom-click',FILE_DOWNLOAD:'adp-file-download'},SRP:{SRP_SEARCH_UPDATE:'srp-search-update'}});}());(function(){'use strict';angular.module('common.constants').constant('MEDIAPLAYER_STATES',{PLAY:'play',PAUSE:'pause',STOP:'stop'});}());(function(){'use strict';angular.module('common.constants').constant('ABSTRACT_TYPE',{'photos':1,'photo':1,'flash':4,'illustrations':7,'vector':7,'video':8,'audio':9});}());(function(){'use strict';angular.module('common.constants').value('SEARCH_STATE',{EXECUTING_SEARCH:true}).constant('SEARCH',{FORMATTED_KEY:'f',FACET_PREFERENCES:{perPage:100,filterContent:false,exclude:false,pageNumber:1},MAX_RESULTS_CACHE_TIME:86400000,MAX_CACHED_RESULT_COUNT:10});}());(function(){'use strict';angular.module('common.constants').constant('LIGHTBOX_EVENTS',{LB_REMOVED_EVENT:'lightbox-removed',LB_OPEN_EVENT:'lightbox-opened'});}());(function(){'use strict';angular.module('common.services',['restangular']).config(['RestangularProvider',function(RestangularProvider){RestangularProvider.setBaseUrl('/api/');RestangularProvider.setDefaultHeaders({'Content-Type':'application/json'});RestangularProvider.setResponseExtractor(function(response){if(response.data&&response.status){return response.data;}
return response;});}]);}());(function(){'use strict';angular.module('common.services').factory('mediaPlayerService',[function(){var self,mediaPlayerCache={};self={_register:function(mediaPlayerScope){mediaPlayerCache[mediaPlayerScope.$id]=mediaPlayerScope;},_unregister:function(mediaPlayerId){delete mediaPlayerCache[mediaPlayerId];},playMedia:function(mediaPlayerId){angular.forEach(mediaPlayerCache,function(mediaPlayer){if(mediaPlayer.$id!==mediaPlayerId){mediaPlayer.state.stop(true);}});mediaPlayerCache[mediaPlayerId].state.play();},getCache:function(){return mediaPlayerCache;}};return self;}]);}());(function(i){'use strict';var NS='common.services';angular.module(NS).constant('url',i.url);}(istock));(function(){'use strict';angular.module('common.services').factory('authorizationService',['OptionsRestangular','$q',function(OptionsRestangular,$q){var AUTH_ENDPOINT='authorization',_refreshToken,response;_refreshToken=function(){var deferred=$q.defer(),restangular;restangular=OptionsRestangular.getPhpRestConfig().one(AUTH_ENDPOINT,1);restangular.put().then(function(data){response=data;deferred.resolve(response);}).catch(function(error){deferred.reject(error);});return deferred.promise;};return{refreshToken:_refreshToken};}]);}());(function(i){'use strict';var NS='common.services';angular.module(NS).constant('cookielessUrl',i.cookielessUrl);}(istock));(function(i){'use strict';var NS='common.services';angular.module(NS).constant('cacheKey',i.cachekey);}(istock));(function(){'use strict';angular.module('common.services').factory('dropdownService',[function(){var self,dropdownCache={};self={_register:function(dropdownScope){dropdownCache[dropdownScope.$id]=dropdownScope;},_unregister:function(dropdownId){delete dropdownCache[dropdownId];},show:function(dropdownId){angular.forEach(dropdownCache,function(dropdown){if(dropdown.$id!==dropdownId){dropdown.isVisible=false;}});dropdownCache[dropdownId].isVisible=true;},hide:function(dropdownId){dropdownCache[dropdownId].isVisible=false;},toggle:function(dropdownId){if(dropdownCache[dropdownId].isVisible){self.hide(dropdownId);}else{self.show(dropdownId);}},getCache:function(){return dropdownCache;}};return self;}]);}());(function(){'use strict';angular.module('common.services').service('formValidationService',['VATService',function(VATService){var expressions,defaultMsgKey,descriptions,usZipMatchState,doesZipMatchState=true;usZipMatchState=function(){var result=doesZipMatchState;doesZipMatchState=true;return result;};expressions={required:/^.+$/,number:/^\d*$/,alphanumeric:/^[a-zA-Z0-9]+$/,onlyLetters:/^\D+$/,vat:VATService.validate,usZip:/^\d{5}([\-\s]?\d{4})?$/,usZipMatchState:usZipMatchState,cdnZip:/^[ABCEGHJKLMNPRSTVXYabceghjklmnprstvxy]\d[A-Za-z][ -]?\s*\d[A-Za-z]\d$/,alphanumericKatakana:/^[\u30A0-\u30FFA-z0-9 ]+$/,requiredSelect:function(selectedItem){return selectedItem;},emailValidation:function(emailValue){var emailRegex;if(emailValue!==undefined){emailRegex=new RegExp(['^[-a-z0-9~!$%^&*_=+}{\\\'?]+(\\.[-a-z0-9~!$%^&*_=+}{\\\'?]+)*','@([a-z0-9_][-a-z0-9_]*(\\.[-a-z0-9_]+)*\\.','(aero|arpa|biz|com|coop|edu|gov|info|int|mil','|museum|name|net|org|pro|travel|mobi|[a-z][a-z])','|([0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}))(:[0-9]{1,5})?$'].join(''));return emailRegex.test(emailValue.toLowerCase());}
return false;},cpfCnpjNumber:/\d{3}\.\d{3}\.\d{3}-\d{2}|\d{2}\.\d{3}\.\d{3}\/\d{4}-\d{2}/};descriptions={required:'This is a required field, can not be blank',number:'Numbers only',onlyLetters:'Anything EXCEPT for numbers (\\D regex flag)',vat:'Valid VAT codes',usZip:'American ZIP codes',usZipMatchState:'Zip code must match state',cdnZip:'Canadian Postal Codes',alphanumeric:'lower and uppercase letters and nubers 0-9',alphanumericKatakana:'katacana characters only',requiredSelect:'Validates that the element is in the select box',emailValidation:'Has to be an email address',cpfCnpjNumber:'Brazilian Individual or Company ID Code'};defaultMsgKey={required:{error:'ERROR_REQUIRED'},requiredSelect:{error:'ERROR_REQUIRED'},emailValidation:{error:'ERROR_EMAIL'},number:{error:'ERROR_NUMBER'},onlyLetters:{error:'ERROR_ONLY_LETTERS'},vat:{error:'ERROR_VAT'},usZip:{error:'ERROR_US_ZIP'},usZipMatchState:{error:'ERROR_US_ZIP_MATCH_STATE'},cdnZip:{error:'ERROR_CDN_ZIP'},alphanumeric:{error:'ERROR_ALPHANUMERIC'},alphanumericKatakana:{error:'ERROR_ALPHA_NUMERIC_KATAKANA'},cpfCnpjNumber:{error:'ERROR_CPF_CPNJ_NUMBER'}};this.allExpressions=function(){return expressions;};this.allDescriptions=function(){return descriptions;};this.setExpression=function(obj){angular.extend(expressions,obj);};this.getExpression=function(expr){return expressions[expr];};this.setDefaultMsgKey=function(obj){angular.extend(defaultMsgKey,obj);};this.getDefaultMsgKey=function(msg){return defaultMsgKey[msg];};this.process=function(type,value){var validation=this.getExpression(type),validationType=validation.constructor;if(validationType===Function){return validation(value);}else if(validationType===RegExp){return value!==undefined&&validation.test(value);}};this.setZipMatchState=function(match){doesZipMatchState=match;};}]);}());(function(){'use strict';angular.module('common.services').factory('cartService',['$q','Restangular',function($q,Restangular){var CART_ENDPOINT='carts',USERS_ENDPOINT='users',_getCart,_getDeferred,_deleteItem,_deleteItemForUser,_deleteItemFromSessionCart,_transferSessionCartToUserCart,cartService;_getDeferred=function(){return $q.defer();};_getCart=function(postdata){return Restangular.all(CART_ENDPOINT).post(postdata);};_deleteItem=function(deleteData){if(deleteData.newUser){return cartService.deleteSessionCartItem(deleteData);}else{return cartService.deleteItemForUser(deleteData);}};_deleteItemForUser=function(deleteData){return Restangular.one(USERS_ENDPOINT,deleteData.userId).one(CART_ENDPOINT+'/'+deleteData.type).withHttpConfig({timeout:3000}).customDELETE(deleteData.assetId);};_deleteItemFromSessionCart=function(deleteData){return Restangular.one(CART_ENDPOINT+'/'+deleteData.type).withHttpConfig({timeout:3000}).customDELETE(deleteData.assetId,{type:deleteData.type});};_transferSessionCartToUserCart=function(putData){return Restangular.one(CART_ENDPOINT,putData.userId).put(putData,{type:'credits'});};cartService={getDeferred:_getDeferred,getCart:_getCart,deleteItem:_deleteItem,deleteItemForUser:_deleteItemForUser,deleteSessionCartItem:_deleteItemFromSessionCart,transferSessionToCart:_transferSessionCartToUserCart};return cartService;}]);}());(function(){'use strict';angular.module('common.services').factory('orderService',['Restangular','$q',function(Restangular,$q){var ORDERS_ENDPOINT='orders',USERS_ENDPOINT='users',cart={items:[],subInfo:{}},currencyInfo={},taxes={},subTotal={},convertedTotal={},total={},specialCodes={},periodicBillingOptions={},self;self={encodeOrder:function(order){var params=[];params.push('id'+'='+encodeURIComponent(order.userId));params.push('type'+'='+encodeURIComponent(order.type));params.push('companyname'+'='+encodeURIComponent(order.billingInformation.companyName));params.push('countrycode'+'='+encodeURIComponent(order.billingInformation.country.GettyCountryCode));params.push('countryname'+'='+encodeURIComponent(order.billingInformation.country.ENName));params.push('postalcode'+'='+encodeURIComponent(order.billingInformation.postalCode));if(typeof order.billingInformation.notes!==undefined){params.push('notesjob'+'='+encodeURIComponent(order.billingInformation.notes.job));params.push('notesordernum'+'='+encodeURIComponent(order.billingInformation.notes.orderNumber));params.push('notesorderedby'+'='+encodeURIComponent(order.billingInformation.notes.orderedBy));}
if(typeof order.specialCodes.promoCode!==undefined){params.push('promocode'+'='+encodeURIComponent(order.specialCodes.promoCode));params.push('vat'+'='+encodeURIComponent(order.specialCodes.vat));}
return params.join('&');},createOrder:function(order,billingInfoUpdated){if(order.paymentInformation.type==='paypal'&&order.paymentInformation.token===undefined){var param=self.encodeOrder(order);billingInfoUpdated.then(function(){window.location.href='/credit-paypal/index/?'+param;});return $q.reject({isPaypalRedirrect:true});}
return Restangular.all(ORDERS_ENDPOINT).post(order);},getOrder:function(orderId,userId,type){return Restangular.one(USERS_ENDPOINT,userId).one(ORDERS_ENDPOINT).customGET(orderId,{type:type});},setCurrencyInfo:function(info){currencyInfo=info;return currencyInfo;},getItemsNotPendingDelete:function(){return cart.items.filter(function(arg){return arg.pendingDelete===false;});},getCurrencyInfo:function(){return currencyInfo;},setSpecialCodes:function(sc){specialCodes=sc;return specialCodes;},getSpecialCodes:function(){return specialCodes;},setPeriodicBillingOptions:function(options){periodicBillingOptions=options;return periodicBillingOptions;},getPeriodicBillingOptions:function(){return periodicBillingOptions;},setTaxes:function(t){taxes=t;return taxes;},getTaxes:function(){return taxes;},setSubTotal:function(st){subTotal=st;return st;},getSubTotal:function(){return subTotal;},setConvertedTotal:function(ct){convertedTotal=ct;},getConvertedTotal:function(){return convertedTotal;},setTotal:function(t){total=t;},getTotal:function(){return total;},deleteItem:function(item){var index=cart.item.indexOf(item);if(index<0){return undefined;}
return cart.item.splice(index,1);},addItem:function(item){return cart.items.push(item);},getItems:function(){return cart.items;},clearItems:function(){cart.items=[];return cart.items;},containsAnnualSubscription:function(){if(this.getPeriodicBillingOptions()===undefined){return false;}
return this.getItems().length===1&&this.getItems()[0].type==='sub'&&Object.keys(this.getPeriodicBillingOptions()).length>1;},isTaxInclusive:function(){if(this.getCurrencyInfo().code==='BRL'){return true;}
return false;}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('preferenceService',['$q','accountService','facetStateService','sessionStorageService','OptionsRestangular','authorizationService','$injectedData',function($q,accountService,facetStateService,sessionStorageService,OptionsRestangular,authorizationService,$injectedData){var PREFERENCE_ENDPOINT='user/preference',self;self={defaultSearchPreferences:{'removeAdultContent':false,'excludeEditorial':false,'showDetails':false,'resultsPerPage':100},attemptedRefreshes:0,initSearchPreferences:function(preferences){var deferred=self._getDeferred(),filterContent;if(!preferences){preferences=self.defaultSearchPreferences;if(facetStateService.getFacet('perPage')!==0){preferences.resultsPerPage=facetStateService.getFacet('perPage');}
if(facetStateService.getActiveValues('editorial').length){preferences.excludeEditorial=facetStateService.getActiveValues('editorial')[0]==='false';}
if(facetStateService.getActiveValues('filterContent').length){filterContent=facetStateService.getActiveValues('filterContent');preferences.removeAdultContent=(filterContent[0]==='false');}
self.setPreferences(preferences);}
facetStateService.setFacet('perPage',parseInt(preferences.resultsPerPage));facetStateService.setFacetOption('editorial',false,preferences.excludeEditorial);facetStateService.setFacetOption('filterContent',false,preferences.removeAdultContent);facetStateService.showFileDetails=preferences.showDetails||false;deferred.resolve(preferences);return deferred.promise;},getPreferences:function(){var deferred=self._getDeferred();if(accountService.isLoggedIn()===false){deferred.resolve(sessionStorageService.getStorage('preferences'));}else{OptionsRestangular.getJavaRestConfig().one(PREFERENCE_ENDPOINT).get().then(deferred.resolve).catch(function(response){if(response.status&&response.status===401){authorizationService.refreshToken().then(function(data){$injectedData.token=data.token;}).catch(function(){self.updatePreference(self.defaultSearchPreferences);}).finally(function(){self.attemptedRefreshes++;if(self.attemptedRefreshes>1){self.updatePreference(self.defaultSearchPreferences);}else{self.initSearchPreferences();}});}else{self.updatePreference(self.defaultSearchPreferences);}});}
return deferred.promise;},setPreferences:function(prefs){var deferred=self._getDeferred();if(accountService.isLoggedIn()===false){prefs=angular.toJson(prefs);deferred.resolve(sessionStorageService.setStorage('preferences',prefs));}else{OptionsRestangular.getJavaRestConfig().one(PREFERENCE_ENDPOINT).customPUT(prefs).then(function(response){deferred.resolve(response);},function(response){deferred.reject(response);});}},updatePreference:function(prefs){self.setPreferences(prefs);facetStateService.setFacet('perPage',prefs.resultsPerPage);facetStateService.setFacetOption('editorial',false,prefs.excludeEditorial);facetStateService.setFacetOption('filterContent',false,prefs.removeAdultContent);},getPreferenceFacetMapping:function(){return{'removeAdultContent':'filterContent','excludeEditorial':'editorial','resultsPerPage':'perPage'};},_getDeferred:function(){return $q.defer();}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('userService',['Restangular','$q',function(Restangular,$q){var USERS_ENDPOINT='users',lastUser,expiredStatus,activeStatus,suspendedStatus;return{getUser:function(userId,isBillingRequest,bypassCache){var params=null,cacheControl={};if(isBillingRequest){params={'isBillingRequest':true,'nocache':new Date().getTime()};}
if(bypassCache){cacheControl={'Cache-Control':'no-cache'};}
return Restangular.one(USERS_ENDPOINT,userId).get(params,cacheControl).then(function(user){lastUser=user;return user;});},currentUser:function(){return lastUser;},setCurrentUser:function(user){lastUser=user;},updateBillingInfo:function(userId,address){return Restangular.one(USERS_ENDPOINT,userId).customPUT({address:address});},activeSubscription:function(userId){if(typeof activeStatus==='undefined'){activeStatus=Restangular.one(USERS_ENDPOINT,userId).one('subscriptions').one('active').get();}
return activeStatus;},hasActualSuspendedSubscription:function(userId){if(typeof suspendedStatus==='undefined'){suspendedStatus=Restangular.one(USERS_ENDPOINT,userId).one('subscriptions').one('actual_suspended').get();}
return suspendedStatus;},createUser:function(email,password,country,optin,elqFormName,siteId,customerGUID,cookieWrite){var deferred=$q.defer(),payload={email:email,password:password,country:country,optin:optin,logIn:true,elqFormName:elqFormName,siteId:siteId,customerGUID:customerGUID,cookieWrite:cookieWrite};Restangular.all(USERS_ENDPOINT).post(payload).then(deferred.resolve,deferred.reject);return deferred.promise;},isAlreadyUser:function(userEmail){var deferred=$q.defer(),params={'email':encodeURIComponent(userEmail)};Restangular.one(USERS_ENDPOINT).head(params).then(function(){deferred.resolve(true);},function(){deferred.reject(false);});return deferred.promise;},subscriptionExpirationStatus:function(userId){if(typeof expiredStatus==='undefined'){expiredStatus=Restangular.one(USERS_ENDPOINT,userId).one('subscriptions').one('expiration_status').get();}
return expiredStatus;},getProfileUri:function(username){return'/profile/'+encodeURIComponent(username.toLowerCase());}};}]);}());(function(){'use strict';angular.module('common.services').factory('countryService',['Restangular','$q',function(Restangular,$q){var COUNTRIES_ENDPOINT='countries',getCountries,getSupportedSubCountries,countries,paypalBannedCountries=['China'],supportedCountries;getCountries=function(){var deferred;if(countries===undefined){return Restangular.all(COUNTRIES_ENDPOINT).getList().then(function(data){countries=data;return countries;});}
deferred=$q.defer();deferred.resolve(countries);return deferred.promise;};getSupportedSubCountries=function(){var deferred;if(supportedCountries===undefined){return Restangular.all(COUNTRIES_ENDPOINT).getList({noSubEmbargo:true}).then(function(data){supportedCountries=data;return supportedCountries;});}
deferred=$q.defer();deferred.resolve(supportedCountries);return deferred.promise;};return{getCountries:getCountries,getSupportedSubCountries:getSupportedSubCountries,paypalBannedCountries:paypalBannedCountries};}]);}());(function(){'use strict';var module=angular.module('common.services'),serviceFn;serviceFn=function($window){return{to:function(url){$window.location.href=url;}};};module.factory('redirect',['$window',serviceFn]);}());(function(){'use strict';angular.module('common.services').factory('sessionStorageService',['$window',function($window){var _getStorage,_setStorage,_deleteStorage,sessionStorageService;_getStorage=function(key){if($window.sessionStorage){return $window.sessionStorage.getItem(key);}else{return'';}};_setStorage=function(key,data){if($window.sessionStorage){$window.sessionStorage.setItem(key,data);}};_deleteStorage=function(key){if($window.sessionStorage){$window.sessionStorage.removeItem(key);}};sessionStorageService={getStorage:_getStorage,setStorage:_setStorage,deleteStorage:_deleteStorage};return sessionStorageService;}]);}());(function(i){'use strict';var NS='common.services';angular.module(NS).constant('baseUrl',i.baseUrl);}(istock));(function(i){'use strict';var NS='common.services';angular.module(NS).constant('restUrl',i.restUrl);}(istock));(function(){'use strict';var hintSvc,HINT_ENDPOINT='search-hints';hintSvc=function(searchRestangular,$q){var _getHints,_handleHints,cache={},fromCache=true,startTime=-1,requestTime=-1,version=0,language='en_US',currentQuery='';_handleHints=function(response){requestTime=Math.round((new Date()).getTime())-startTime;if(response.hasOwnProperty('language')){language=response.language;}
if(response.hasOwnProperty('version')){version=response.version;}
if(response.hasOwnProperty('from-cache')){fromCache=response['from-cache'];}
var deferred=$q.defer(),namespace='',suggestions={hints:[],members:[],version:version,requestTime:requestTime,source:namespace,cache:fromCache,language:language,startTime:startTime},pattern=new RegExp('('+currentQuery.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,'\\$&')+')','ig'),contributorPattern=new RegExp('(.+:)','ig'),highlight='<span class="hint-highlight">$1</span>',contributor='<span class="contributor">$1</span>',hints=response;if(response.version===1&&response.query){namespace=response.query.substring(0,3);cache[namespace]=response;}
if('suggestions'in hints){hints.suggestions.forEach(function(hint,index){var hintData=hints.data[index];hintData.userString=hint;hintData.displayString=hint.replace(pattern,highlight);suggestions.hints.push(hintData);});}
if('membernames'in hints){hints.membernames.forEach(function(member,index){var memberData=hints.membernamedata[index],displayString=member.replace(pattern,highlight);memberData.userString=member;memberData.displayString=displayString.replace(contributorPattern,contributor);suggestions.members.push(memberData);});}
deferred.resolve(suggestions);return deferred.promise;};_getHints=function(){var deferred=$q.defer(),namespace;startTime=Math.round((new Date()).getTime());if(typeof currentQuery==='undefined'||currentQuery.length<1){deferred.reject('Query is undefined or too short');}else{if(version<2){namespace=currentQuery.substring(0,3);}else{namespace=currentQuery;}
if(namespace in cache){deferred.resolve(cache[namespace]);fromCache=true;}else{fromCache=false;searchRestangular.one(HINT_ENDPOINT,[namespace,version]).withHttpConfig({ignoreLoadingBar:true}).get().then(deferred.resolve);}}
return deferred.promise;};return{getHints:function(query){var deferred=$q.defer();currentQuery=query;_getHints().then(_handleHints).then(deferred.resolve)
['catch'](deferred.reject);return deferred.promise;}};};angular.module('common.services').factory('searchRestangular',function(Restangular){return Restangular.withConfig(function(RestangularConfigurer){RestangularConfigurer.setBaseUrl('/api/');});}).factory('hints',['searchRestangular','$q',hintSvc]);}());(function(){'use strict';var urlBuilderSvc;urlBuilderSvc=function($q,$interpolate,urlSvc){var _handleInput,_getUrl,portfolioUrl=$interpolate('{{baseUrl}}/portfolio/{{string}}'),searchUrl=$interpolate('{{baseUrl}}/search/text/{{text}}{{fileTypes}}{{disambiguation}}{{source}}'),fileIdUrl=$interpolate('{{baseUrl}}/search/text/{{text}}{{fileTypes}}');_getUrl=function(term,pattern){var deferred=$q.defer(),url;url=pattern(term).replace(/([^:]\/)\/+/g,'$1');deferred.resolve(url);return deferred.promise;};_handleInput=function(query,fileTypes,source){var deferred=$q.defer(),searchTerm={text:null,fileTypes:null,disambiguation:null,source:null,baseUrl:urlSvc},tmp;if(typeof query==='object'&&query.hasOwnProperty('userId')){_getUrl(query,portfolioUrl).then(deferred.resolve);}else if(typeof query==='number'){searchTerm.text=query;searchTerm.fileTypes='/filetypes/'+fileTypes;_getUrl(searchTerm,fileIdUrl).then(deferred.resolve);}else{if(typeof query==='string'){tmp=encodeURIComponent(query);query={string:tmp.replace(/%20/g,'+')};}else{tmp=encodeURIComponent(query.string);query.string=tmp.replace(/%20/g,'+');}
searchTerm.text=query.string;if(typeof fileTypes==='string'&&fileTypes!==''){searchTerm.fileTypes='/filetypes/'+fileTypes;}
if('disambiguation'in query){searchTerm.disambiguation='/textDisambiguation/'+angular.toJson(query.disambiguation);}
if(source){searchTerm.source='/source/'+source;}
_getUrl(searchTerm,searchUrl).then(deferred.resolve);}
return deferred.promise;};return{build:function(query,fileTypes,source){var deferred=$q.defer();if(!query||query.length===0){deferred.reject('input not defined');}else{_handleInput(query,fileTypes,source).then(deferred.resolve);}
return deferred.promise;}};};angular.module('common.services').factory('urlBuilder',['$q','$interpolate','url',urlBuilderSvc]);}());(function(){'use strict';angular.module('common.services').factory('facetService',['$filter',function($filter){var audioFacets=function(){var keys={'all':'ANY','undefined':'UNDEFINED','A':'A','A major':'A_MAJOR','A minor':'A_MINOR','A flat':'A_FLAT','A flat major':'A_FLAT_MAJOR','A flat minor':'A_FLAT_MINOR','B':'B','B major':'B_MAJOR','B minor':'B_MINOR','B flat':'B_FLAT','B flat major':'B_FLAT_MAJOR','B flat minor':'B_FLAT_MINOR','C':'C','C major':'C_MAJOR','C minor':'C_MINOR','C sharp':'C_SHARP','C sharp major':'C_SHARP_MAJOR','C sharp minor':'C_SHARP_MINOR','D':'D','D major':'D_MAJOR','D minor':'D_MINOR','E':'E','E major':'E_MAJOR','E minor':'E_MINOR','E flat':'E_FLAT','E flat major':'E_FLAT_MAJOR','E flat minor':'E_FLAT_MINOR','F':'F','F major':'F_MAJOR','F minor':'F_MINOR','F sharp':'F_SHARP','F sharp major':'F_SHARP_MAJOR','F sharp minor':'F_SHARP_MINOR','G':'G','G major':'G_MAJOR','G minor':'G_MINOR'},facets={};angular.forEach(keys,function(value,key){facets[key]={display:$filter('i18n')(value),accessibility:'public',value:key};});return facets;},self={config:{abstractType:{facets:{images:{display:$filter('i18n')('IMAGES'),accessibility:'public',value:'images'},photos:{display:$filter('i18n')('PHOTOS'),accessibility:'public',value:'photos'},illustrations:{display:$filter('i18n')('ILLUSTRATIONS'),accessibility:'public',value:'illustrations'},video:{display:$filter('i18n')('VIDEO'),accessibility:'public',value:'video'},audio:{display:$filter('i18n')('AUDIO'),accessibility:'public',value:'audio'},all:{display:$filter('i18n')('ALL'),accessibility:'private',value:'all'}},type:''},order:{facets:{bestMatch:{display:$filter('i18n')('BEST_MATCH'),accessibility:'public',value:'bestMatch'},bestMatchAlternate:{display:$filter('i18n')('BEST_MATCH_ALTERNATE'),accessibility:'private',value:'bestMatchAlternate'},new:{display:$filter('i18n')('NEW'),accessibility:'public',value:'new'},mostPopular:{display:$filter('i18n')('MOST_POPULAR'),accessibility:'public',value:'yearPopular'}},subFacets:{monthPopular:{display:$filter('i18n')('THIS_MONTH'),accessibility:'public',value:'monthPopular'},yearPopular:{display:$filter('i18n')('THIS_YEAR'),accessibility:'public',value:'yearPopular'},allTimePopular:{display:$filter('i18n')('ALL_TIME'),accessibility:'public',value:'allTimePopular'}},mixedFacets:{bestMatch:{display:$filter('i18n')('BEST_MATCH'),accessibility:'public',value:'bestMatch'},new:{display:$filter('i18n')('NEW'),accessibility:'public',value:'new'},monthPopular:{display:$filter('i18n')('MOST_POPULAR_THIS_MONTH'),accessibility:'public',value:'monthPopular'},yearPopular:{display:$filter('i18n')('MOST_POPULAR_THIS_YEAR'),accessibility:'public',value:'yearPopular'},allTimePopular:{display:$filter('i18n')('MOST_POPULAR_ALL_TIME'),accessibility:'public',value:'allTimePopular'}},type:'single',default:'bestMatch'},date:{facets:{oneDay:{display:$filter('i18n')('TODAY'),accessibility:'public',value:'oneDay'},oneWeek:{display:$filter('i18n')('THIS_WEEK'),accessibility:'public',value:'oneWeek'},oneMonth:{display:$filter('i18n')('THIS_MONTH'),accessibility:'public',value:'oneMonth'},threeMonths:{display:$filter('i18n')('PAST_THREE_MONTHS'),accessibility:'public',value:'threeMonths'},sixMonths:{display:$filter('i18n')('PAST_SIX_MONTHS'),accessibility:'public',value:'sixMonths'},allTimes:{display:$filter('i18n')('ALL_TIME'),accessibility:'public',value:'allTimes'}},type:'single'},editorial:{facets:{creative:{display:$filter('i18n')('CREATIVE'),accessibility:'public',value:false},editorial:{display:$filter('i18n')('EDITORIAL'),accessibility:'public',value:true,class:'icon editorial'}},type:'multi-null-complete'},collectionPrice:{facets:{essentials:{display:$filter('i18n')('ESSENTIALS'),accessibility:'public',value:'essentials'},signature:{display:$filter('i18n')('SIGNATURE'),accessibility:'public',value:'signature'}},type:'multi-null-complete'},exclusiveContributor:{facets:{onlyFromiStock:{display:$filter('i18n')('ONLY_FROM_ISTOCK'),accessibility:'public',value:true}},type:'multi'},showPeople:{facets:{people:{display:$filter('i18n')('PEOPLE'),accessibility:'public',value:true,class:'icon people'},noPeople:{display:$filter('i18n')('NO_PEOPLE'),accessibility:'public',value:false,class:'icon no-people'}},type:'multi'},orientation:{facets:{horizontal:{display:$filter('i18n')('LANDSCAPE'),accessibility:'public',value:'horizontal',class:'icon horizontal'},vertical:{display:$filter('i18n')('PORTRAIT'),accessibility:'public',value:'vertical',class:'icon vertical'},square:{display:$filter('i18n')('SQUARE'),accessibility:'public',value:'square',class:'icon square'}},type:'multi-null-complete'},aspectRatioVideo:{facets:{'4:3':{display:'4:3',accessibility:'public',value:'4:3'},'16:9':{display:'16:9',accessibility:'public',value:'16:9'}},type:'multi-null-complete'},videoSize:{facets:{'hd1080':{display:'HD 1080',accessibility:'public',value:'hd1080'},'hd720':{display:'HD 720',accessibility:'public',value:'hd720'},'pal':{display:'SD PAL',accessibility:'public',value:'pal'},'ntsc':{display:'SD NTSC',accessibility:'public',value:'ntsc'},'dv':{display:'SD DV',accessibility:'public',value:'dv'}},type:'multi-null-complete'},tempo:{facets:{'all':{display:$filter('i18n')('ANY'),accessibility:'public',value:'all'},'very slow':{display:$filter('i18n')('VERY_SLOW'),subtitle:'(0 - 79 bpm)',accessibility:'public',value:'very slow'},'slow':{display:$filter('i18n')('SLOW'),subtitle:'(80 - 119 bpm)',accessibility:'public',value:'slow'},'medium':{display:$filter('i18n')('MEDIUM'),subtitle:'(120 - 139 bpm)',accessibility:'public',value:'medium'},'fast':{display:$filter('i18n')('FAST'),subtitle:'(140 - 159 bpm)',accessibility:'public',value:'fast'},'very fast':{display:$filter('i18n')('VERY_FAST'),subtitle:'(160+)',accessibility:'public',value:'very fast'}},type:'single',default:'all'},audioKey:{facets:audioFacets(),type:'single',default:'all'},audioPrice:{facets:{'basic':{display:$filter('i18n')('BASIC'),accessibility:'public',value:'basic'},'moderate':{display:$filter('i18n')('MODERATE'),accessibility:'public',value:'moderate'},'detailed':{display:$filter('i18n')('DETAILED'),accessibility:'public',value:'detailed'},'complex':{display:$filter('i18n')('COMPLEX'),accessibility:'public',value:'complex'},'elaborate':{display:$filter('i18n')('ELABORATE'),accessibility:'public',value:'elaborate'}},type:'multi-null-complete'},color:{type:'color'},filterContent:{type:'single',default:'true',forceInclude:true}},getConfig:function(){return self.config;},getFacetGroup:function(facetName){return self.config[facetName];}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('facetStateService',['$location','facetService','SEARCH',function($location,facetService,SEARCH){var self={facetState:{text:[],pageNumber:1,perPage:100,abstractType:{photos:false,illustrations:false,video:false,audio:false},date:{oneHour:false,oneDay:false,oneWeek:false,oneMonth:false,threeMonths:false,sixMonths:false,allTimes:false},order:{bestMatch:false,bestMatchAlternate:false,new:false,allTimePopular:false,monthPopular:false,yearPopular:false},editorial:{true:false,false:false},collectionPrice:{essentials:false,signature:false},exclusiveContributor:{true:false,false:false},showPeople:{true:false,false:false,'other':false},filterContent:{true:true,false:false},orientation:{horizontal:false,vertical:false,square:false},aspectRatioVideo:{'4:3':false,'16:9':false},videoSize:{hd1080:false,hd720:false,pal:false,ntsc:false,dv:false},tempo:{all:false,'very slow':false,slow:false,medium:false,fast:false,'very fast':false},audioKey:{'all':false,'undefined':false,'A':false,'A major':false,'A minor':false,'A flat':false,'A flat major':false,'A flat minor':false,'B':false,'B major':false,'B minor':false,'B flat':false,'B flat major':false,'B flat minor':false,'C':false,'C major':false,'C minor':false,'C sharp':false,'C sharp major':false,'C sharp minor':false,'D':false,'D major':false,'D minor':false,'E':false,'E major':false,'E minor':false,'E flat':false,'E flat major':false,'E flat minor':false,'F':false,'F major':false,'F minor':false,'F sharp':false,'F sharp major':false,'F sharp minor':false,'G':false,'G major':false,'G minor':false},audioPrice:{basic:false,moderate:false,detailed:false,complex:false,elaborate:false},subscriptionCollection:{standard:false},color:'',portfolioID:0,lightboxID:0,additionalAudio:'',adminSearch:false,fileCollection:{essentials:false,vetta:false,value:false,signature:false,'signature+':false},fileIdSet:[],noCache:{true:false,false:false},photoSize:{'xl':false,'xxl':false,'xxxl':false},loginToken:'',keywordLanguage:'',deduplicate:[],gettyMasterIdSet:[],exclusiveEditorsPickVetta:{onlyFromIstock:false,editorsPick:false,vetta:false},filterVector:{true:false,false:false},countryID:'',editorsPick:{true:false,false:false},textDisambiguation:[],copySpace:[],timeSignature1:'',timeSignature2:'',decoration:[],priceLevel:[],searchId:'',activeStatus:'',bestMatchMix:[],vectorPrice:[],similarity:[],shuffleFiletypeCycle:'',userPartition:'',shufflePriceLevelCycle:'',keywordRankAdjustment:'',latestFiles:''},imagesFacets:['editorial','showPeople','orientation','color','photoSize'],audioFacets:['tempo','audioKey','audioPrice','additionalAudio','timeSignature1','timeSignature2'],videoFacets:['aspectRatioVideo','videoSize'],filterFacets:['editorial','collectionPrice','exclusiveContributor','showPeople','orientation','aspectRatioVideo','videoSize','tempo','audioKey','audioPrice','color'],noOptionArrayFacets:['text','fileIdSet','deduplicate','gettyMasterIdSet','priceLevel','textDisambiguation','copySpace','decoration','bestMatchMix','vectorPrice','similarity'],defaultFacets:['order','tempo','audioKey'],showFileDetails:false,initialized:false,dirty:false,initFromFacets:function(facets){console.log('-----initFromFacets');console.log(facets);angular.copy(self.defaultState,self.facetState);angular.forEach(facets,function(facetValue,facetName){console.log('loop');console.log('facetValue = '+facetValue);console.log('facetName = '+facetName);if(angular.isArray(facetValue)){if(facetName==='text'){self.setFacet(facetName,self.formatKeywords(facetValue.join(' ')));}else if(self.noOptionArrayFacets.indexOf(facetName)!==-1){self.setFacet(facetName,facetValue);}else{angular.forEach(facetValue,function(filterValue){filterValue=self.mapLegacyFacetValue(filterValue);if(filterValue==='audio'){self.setFacet('additionalAudio','true');}
self.setFacetOption(facetName,filterValue,true);});}}else if(angular.isObject(self.facetState[facetName])){self.setFacetOption(facetName,facetValue,true);}else if(facetName!==SEARCH.FORMATTED_KEY){self.setFacet(facetName,facetValue);}});},initDefaultValues:function(){var list=self.defaultFacets,def;list.forEach(function(facetName){def=facetService.getFacetGroup(facetName).default;if(def&&self.getActiveValues(facetName).length===0){self.setFacetOption(facetName,def,true);}});if(self.getActiveValues('abstractType').indexOf('audio')===-1){self.clearFileTypeFacets(self.audioFacets);}
self.initialized=true;},isInitialized:function(){return self.initialized;},getFacet:function(name){return self.facetState[name];},getOptionState:function(name,value){return self.facetState[name][value];},toggleFacet:function(name,value){self.facetState[name][value]=!self.facetState[name][value];self.dirty=true;},setFacet:function(name,value){if(typeof self.facetState[name]===typeof value){if('text'===name){value=self.formatKeywords(value.join(' '));}
if(self.facetState[name]!==value){self.facetState[name]=value;self.dirty=true;}}else{throw new TypeError();}},setFacetOption:function(name,option,value){var facetGroup=facetService.getFacetGroup(name);if(typeof self.facetState[name][option]===typeof value){self.facetState[name][option]=value;if(self.isSingleFacet(facetGroup)){if(option===true){self.facetState[name]['false']=false;}else if(option===false){self.facetState[name]['true']=false;}}
self.dirty=true;}else{throw new TypeError();}},clearFacetGroup:function(name){if(self.noOptionArrayFacets.indexOf(name)!==-1||name==='searchId'){self.clearFacet(name);}else{angular.forEach(self.facetState[name],function(value,key){self.setFacetOption(name,key,false);});}},clearFacet:function(name){if(self.noOptionArrayFacets.indexOf(name)!==-1){self.facetState[name]=[];}else if(name==='searchId'){self.facetState[name]='';}},clearFileTypeFacetGroups:function(fileTypeSelected){if(fileTypeSelected==='images'||fileTypeSelected==='photos'||fileTypeSelected==='illustrations'){self.clearFileTypeFacets(self.audioFacets);self.clearFileTypeFacets(self.videoFacets);if(fileTypeSelected==='illustrations'){self.clearFacetGroup('editorial');}}else if(fileTypeSelected==='video'){self.clearFileTypeFacets(self.imagesFacets);self.clearFileTypeFacets(self.audioFacets);}else if(fileTypeSelected==='audio'){self.clearFileTypeFacets(self.imagesFacets);self.clearFileTypeFacets(self.videoFacets);}else{self.clearAllFileTypeFacets();}},clearFileTypeFacets:function(fileType){angular.forEach(fileType,function(value){self.clearFacetGroup(value);});},clearAllFileTypeFacets:function(){self.clearFileTypeFacets(self.imagesFacets);self.clearFileTypeFacets(self.videoFacets);self.clearFileTypeFacets(self.audioFacets);self.clearFacetGroup('collectionPrice');self.clearFacetGroup('exclusiveContributor');self.clearFacetGroup('order');self.setFacet('pageNumber',1);self.setFacetOption('order','bestMatch',true);},clearAltViewFacets:function(){self.setFacet('portfolioID',0);self.setFacet('lightboxID',0);},setFileTypeToDefault:function(){self.clearFacetGroup('abstractType');self.setFacet('additionalAudio','');self.toggleFacet('abstractType','photos');self.toggleFacet('abstractType','illustrations');},getActiveValues:function(nameAry){var result=[];if(!angular.isArray(nameAry)){nameAry=nameAry.split(',');}
angular.forEach(nameAry,function(name){if(typeof self.facetState[name]!=='object'){result.push(self.facetState[name]);}else{angular.forEach(self.facetState[name],function(value,key){if(self.facetState[name][key]===true){result.push(key);}});}});return result;},mapLegacyFacetValue:function(value){if(value==='videos'){value='video';}else if(value==='music'){value='audio';}
return value;},allOptionsActive:function(name){var allSelected=true;angular.forEach(self.facetState[name],function(value,key){if(self.facetState[name][key]===false){allSelected=false;}});return allSelected;},activateAllOptions:function(name){angular.forEach(self.facetState[name],function(value,key){self.setFacetOption(name,key,true);});},hasActiveFacets:function(list){var hasActiveValues=false,activeValue=[];if(!angular.isArray(list)){list=list.split(',');}
list.forEach(function(facetName){activeValue=self.getActiveValues(facetName);if(!self.isOnlyDefaultSet(facetName)&&((activeValue.length>0)&&(activeValue.indexOf('')===-1))){hasActiveValues=true;return;}});return hasActiveValues;},isOnlyDefaultSet:function(name){var active=self.getActiveValues(name),def,facetGroup;if(self.facetState[name]&&active.length===1){facetGroup=facetService.getFacetGroup(name);if(facetGroup){def=facetGroup.default;}
if(def&&active[0]===def){return true;}}
return false;},build:function(forceInclude){var facets={};angular.forEach(self.facetState,function(value,filterName){var facetGroup=facetService.getFacetGroup(filterName);if(self.isDefaultPref(filterName,value)&&!forceInclude){return;}
if(!angular.isArray(value)&&!angular.isObject(value)&&value){facets[filterName]=value;}else{angular.forEach(value,function(facetValue,facetType){var singleFacetType,isFacetDefault,shouldInclude;if(self.isNoOptionFacet(filterName)){self.setArrayFacet(facets,filterName,facetValue);}
singleFacetType=self.isSingleFacet(facetGroup);if(singleFacetType){isFacetDefault=self.isFacetDefault(facetGroup,facetType);shouldInclude=self.shouldInclude(facetGroup,facetType,forceInclude);if(facetValue===true&&(!isFacetDefault||shouldInclude)){facets[filterName]=facetType;}}else if(!singleFacetType&&facetValue===true){self.setArrayFacet(facets,filterName,facetType);}});}});return facets;},setArrayFacet:function(facets,name,value){if(!facets[name]){facets[name]=[];}
facets[name].push(value);},shouldInclude:function(facetGroup,value,forceInclude){return(forceInclude===true&&typeof facetGroup!=='undefined'&&'forceInclude'in facetGroup);},isFacetDefault:function(facetGroup,value){return(typeof facetGroup!=='undefined'&&'default'in facetGroup&&facetGroup.default===value);},isDefaultPref:function(filterName,value){var DEFAULTS=SEARCH.FACET_PREFERENCES;return(filterName in DEFAULTS&&DEFAULTS[filterName]===value);},isNoOptionFacet:function(filterName){return self.noOptionArrayFacets.indexOf(filterName)!==-1;},isSingleFacet:function(facetGroup){return(typeof facetGroup!=='undefined'&&'type'in facetGroup&&facetGroup.type==='single');},formatKeywords:function(keywordString){var keywords,ret=[],booleans=['NOT','OR'];if(keywordString.indexOf('+')!==-1){keywords=keywordString.split('+');}else{keywords=keywordString.split(' ');}
angular.forEach(keywords,function(word,index){if(booleans.indexOf(word.toUpperCase())!==-1&&index+1<keywords.length){ret.push([word.toUpperCase(),keywords[index+1]].join(' '));keywords.splice(index+1,1);}else{ret.push(word);}});if(ret[0]){return[ret.join(' ')];}
return[];},correctSpelling:function(suggestion,misspelled){var tempText=[];angular.forEach(self.facetState.text,function(keyword){if(keyword===misspelled){keyword=suggestion;}
tempText.push(keyword);});self.setFacet('text',tempText);},isDirty:function(){return self.dirty;},resetDirty:function(){self.dirty=false;}};self.defaultState=angular.copy(self.facetState);return self;}]);}());(function(i){'use strict';var NS='common.services',CONSTANT='siteLang',constant;constant=i.siteLang;angular.module(NS).constant(CONSTANT,constant);}(istock));(function(){'use strict';angular.module('common.services').factory('spinnerService',[function(){var self,spinnerCache={};self={_register:function(spinnerScope){if(spinnerCache[spinnerScope.id]){spinnerCache[spinnerScope.id]=angular.extend(spinnerScope,spinnerCache[spinnerScope.id]);}else{spinnerCache[spinnerScope.id]=spinnerScope;}},_unregister:function(spinnerId){delete spinnerCache[spinnerId];},_unregisterGroup:function(spinnerGroup){var spinnerId;for(spinnerId in spinnerCache){if(spinnerCache[spinnerId].group===spinnerGroup){delete spinnerCache[spinnerId];}}},show:function(spinnerId){if(!spinnerCache[spinnerId]){spinnerCache[spinnerId]={};}
spinnerCache[spinnerId].showSpinner=true;},hide:function(spinnerId){if(!spinnerCache[spinnerId]){spinnerCache[spinnerId]={};}
spinnerCache[spinnerId].showSpinner=false;},showGroup:function(spinnerGroup){var spinnerId;for(spinnerId in spinnerCache){if(spinnerCache[spinnerId].group===spinnerGroup){this.show(spinnerId);}}},hideGroup:function(spinnerGroup){var spinnerId;for(spinnerId in spinnerCache){if(spinnerCache[spinnerId].group===spinnerGroup){this.hide(spinnerId);}}},getCache:function(){return spinnerCache;}};return self;}]);}());(function(translations){'use strict';var NS='common.services',key,formattedTranslations=[];for(key in translations){if(translations.hasOwnProperty(key)){formattedTranslations.push({key:key,value:translations[key],description:''});}}
angular.module(NS).constant('translations',formattedTranslations);}(window.translations));(function(){'use strict';angular.module('common.services').factory('VATService',[function(){var invalidCodes=[],regexp=/^[a-zA-Z]{2,3}\w{8,12}$/;return{validate:function(vatCode){var isValid,i;if(!vatCode){return false;}
for(i=0;i<invalidCodes.length;i++){if(invalidCodes[i]===vatCode){return false;}}
isValid=regexp.test(vatCode);if(!isValid&&vatCode){isValid=regexp.test(vatCode.replace(/ /g,''));}
return isValid;},clearInvalidCodes:function(){invalidCodes.length=0;},addInvalidVat:function(vatCode){invalidCodes[invalidCodes.length]=vatCode;}};}]);}());(function(){'use strict';angular.module('common.services').factory('omnitureService',['$window',function($window){var _commonPageLoad,_adpPageLoad,_ctaClick,_adpDownload,_fileZoomClick,_toggleLightbox,_createLightbox,_addToLightbox,_similarFileClick,_setSubsProp,_findDaysBetween,_adpDropboxCtaClick,_srpPageLoad,_toggleRefinePanel,_playAudioFile,_srpSearchDetails='pageName,channel,server,prop1,eVar1,prop3,eVar3,prop4,eVar4,'+'prop5,eVar5,eVar6,prop7,eVar7,prop11,eVar11,prop12,eVar12,prop13,prop14,eVar14,'+'prop15,eVar15,prop16,eVar16,prop18,prop28,eVar28,prop31,eVar31,prop38,eVar38,prop39,eVar39,prop40,eVar40,'+'prop41,eVar41,prop44,eVar44,prop45,prop53,eVar53,prop60,prop70,prop73,prop74,prop75';_commonPageLoad=function(){s.server=istock.baseUrl;if(s.prop3){s.prop3=istock.locale+'|'+s.prop3;}else{s.prop3=istock.locale;}
s.eVar3=istock.locale;s.prop5=$window.location.href;s.eVar7=s.prop7=s.getPreviousValue(s.pageName,'gpv_07');s.prop18=s.getPercentPageViewed();s.eVar28=s.prop28=s.getDaysSinceLastVisit('s_lv');if(s.prop40===undefined||s.prop40===null){s.prop40=s.eVar40='Authenticated';}
if(s.prop41===undefined||s.prop41===null){s.prop41=s.eVar41='Client';}
s.prop70='D=s_vi';if($window.timestamps){var temp74;s.prop73=$window.timestamps.serverEnd-$window.timestamps.serverStart;temp74=$window.timestamps.cssEnd-$window.timestamps.htmlStart+s.prop73;s.prop74=temp74+'|'+($window.timestamps.htmlEnd-$window.timestamps.cssEnd+temp74);if(!s.prop75){s.prop75='null';}
s.prop75=s.prop75+'|render:'+($window.timestamps.htmlEnd-$window.timestamps.serverStart);}};_ctaClick=function(ctaTitle){ctaTitle=ctaTitle.replace(/\s+/g,'');ctaTitle=ctaTitle.replace(/<\/?[^>]+(>|$)/g,'');s.linkTrackVars='events,prop65';s.linkTrackEvents='event45';s.events='event45';s.tl(true,'o',ctaTitle);};_adpPageLoad=function(args){var asset=args.asset,user=args.user,assetId=args.assetId,name='iStock|Product|'+asset.presentation.type+'FCP',segmentString=args.segmentString,classification='Creative',assetClickedFromSRP;s.pageName=s.eVar5=name;s.channel='Product';s.events='event3';if(asset.presentation.editorialCaption){classification='Editorial';}
s.eVar13=[classification,asset.presentation.type,asset.presentation.bestMatchCollection].join('|');s.prop26=new Date(asset.approvalDate);s.eVar39=segmentString;assetClickedFromSRP=localStorage.getItem('assetClickedFromSRP');if(assetClickedFromSRP){assetClickedFromSRP=angular.fromJson(assetClickedFromSRP);s.prop44=assetClickedFromSRP.column+':'+assetClickedFromSRP.row;localStorage.removeItem('assetClickedFromSRP');}
s.prop52='Credits';s.prop56=assetId;s.prop62='SimilarImages';s.prop65='iStockADP_New';if(asset.isAdultContent){s.prop61=s.eVar61='Adult';}
if(user){s.prop4=s.eVar4=user.userId;s.prop58=s.eVar58=user.numCredits;if(user.hasSub){_setSubsProp(user);}}
_commonPageLoad();s.t();};_adpDropboxCtaClick=function(requestTitle){s.linkTrackEvents=s.events='event28';s.tl(true,'o',requestTitle);};_srpPageLoad=function(){_commonPageLoad();s.t();};_adpDownload=function(args){var asset=args.asset,user=args.user,assetId=args.assetId,downloadInfo=args.downloadInfo,creditsRemaining=args.creditsRemaining,segmentString=args.segmentString,classification='Creative';s.events='event4';s.prop59='adp|download';s.eVar39=segmentString;if(asset.presentation.editorialCaption){classification='Editorial';}
s.eVar13=[classification,asset.presentation.type,asset.presentation.bestMatchCollection].join('|');s.prop72=assetId;s.prop58=s.eVar58=creditsRemaining;if(downloadInfo.acquiredWithCredits){s.eVar62='Credits';s.events='event4,event23';s.products=';;;;event23='+downloadInfo.creditBurned+';;';}else{s.eVar62='Subscription';s.products=';SUBISTOCK1M';_setSubsProp(user);if(user.sub.autoRenewal===true){s.prop24+='|on';}else if(user.sub.autoRenewal===false){s.prop24+='|off';}}
if(downloadInfo.creditBurned===0&&!downloadInfo.acquiredUnderSubscription){s.events='event33';}
s.linkTrackVars='events,products,prop24,prop59,eVar13,eVar39,prop72,prop58,eVar62,prop65';s.linkTrackEvents='event4,event23,event33';s.tl('DownloadConfirm','o','DownloadConfirm');};_fileZoomClick=function(args){var asset=args.asset,classification='Creative';if(asset.presentation.editorialCaption){classification='Editorial';}
s.eVar13=[classification,asset.presentation.type,asset.presentation.bestMatchCollection].join('|');s.prop23='Zoom';s.linkTrackVars='prop23,eVar13,prop65';s.tl('ImageZoomADP','o','ImageZoomADP');};_toggleLightbox=function(args){var assetId=args.assetId,classification='Creative',assetIsEditorial=args.assetIsEditorial,assetType=args.assetType,assetCollection=args.assetCollection,appId=args.appId;if(appId==='srp'){if(assetIsEditorial){classification='Editorial';}
s.eVar13=[classification,assetType,assetCollection].join('|');s.prop56=assetId;s.linkTrackVars='prop56,eVar13';s.linkTrackVars+=','+_srpSearchDetails;s.linkTrackEvents='event5,event6';s.tl(true,'o','SRP-LightboxModalLoad');}};_createLightbox=function(args){var lightboxName=args.name,assetId=args.assetId,appId=args.appId;s.events='event5,event6';s.prop10=s.eVar10=lightboxName;s.prop56=assetId;s.linkTrackVars='events,prop10,eVar10,eVar13,prop65,prop56';s.linkTrackEvents='event5,event6';if(appId==='srp'){s.linkTrackVars+=','+_srpSearchDetails;s.tl(true,'o','SRP-AddCreateLightbox');}else{s.tl('LightboxCreate','o','LightboxCreate');}};_addToLightbox=function(args){var assetType=args.assetType,assetCollection=args.assetCollection,assetId=args.assetId,assetIsEditorial=args.assetIsEditorial,appId=args.appId,lightboxName=args.name,classification='Creative';s.prop10=s.eVar10=lightboxName;s.events='event5';s.prop72=s.prop56=assetId;if(assetIsEditorial){classification='Editorial';}
if(assetCollection==='Essentials'){assetCollection='Main';}
s.eVar13=[classification,assetType,assetCollection].join('|');s.linkTrackVars='events,prop10,prop72,eVar10,eVar13,prop65,prop56';s.linkTrackEvents='event5';if(appId==='srp'){s.linkTrackVars+=','+_srpSearchDetails;s.tl(true,'o','SRP-AddToLightbox');}else{s.tl('LightboxAdd','o','LightboxAdd');}};_similarFileClick=function(){s.events='event44';s.prop62='SimilarImages';s.linkTrackVars='events,prop62,prop65';s.linkTrackEvents='event44';s.tl('SimilarFileClick','e','SimilarFileClick');};_setSubsProp=function(user){var daysRemaining,dlRemaining=user.sub.downloadsRemaining,expiryTimestamp=user.sub.expires,dlTotal=user.sub.downloadCount;daysRemaining=_findDaysBetween(expiryTimestamp);s.prop24=dlRemaining+'|'+dlTotal+'|'+daysRemaining;s.prop52='Credits|Subscription';};_findDaysBetween=function(expiry){var dayMs=1000*60*60*24,difference,todayDate,futureDate;todayDate=new Date(Date.now()).getTime();futureDate=new Date(expiry).getTime();difference=futureDate-todayDate;return Math.round(difference/dayMs);};_toggleRefinePanel=function(refinePanelOpen){var name='SRP-RefinePanelClose';if(refinePanelOpen){name='SRP-RefinePanelOpen';}
s.linkTrackVars+=','+_srpSearchDetails;s.tl(true,'o',name);};_playAudioFile=function(){s.linkTrackVars+=','+_srpSearchDetails;s.tl(true,'o','AudioSRP-PlayFile');};return{adpDownload:_adpDownload,adpPageLoad:_adpPageLoad,commonPageLoad:_commonPageLoad,addToLightbox:_addToLightbox,createLightbox:_createLightbox,ctaClick:_ctaClick,fileZoomClick:_fileZoomClick,toggleLightbox:_toggleLightbox,similarFileClick:_similarFileClick,adpDropboxCtaClick:_adpDropboxCtaClick,srpPageLoad:_srpPageLoad,toggleRefinePanel:_toggleRefinePanel,playAudioFile:_playAudioFile,srpSearchDetails:_srpSearchDetails};}]);}());(function(){'use strict';angular.module('common.services').factory('accountService',['$q','ipCookie','OptionsRestangular','$injectedData','authorizationService',function($q,ipCookie,OptionsRestangular,$injectedData,authorizationService){var ACCOUNT_ENDPOINT='user/account',SUBTYPE_COOKIE='subtype',defer,accountData,attemptedRefreshes=0,self={getAccount:function(){var result;defer=$q.defer();if(!self.isLoggedIn()){defer.resolve(null);}else{if($injectedData.accountInfo){result=$injectedData.accountInfo;self.handleCookie(result);defer.resolve(result);attemptedRefreshes=0;}else{OptionsRestangular.getJavaRestConfig().one(ACCOUNT_ENDPOINT).get().then(function(account){self.setAccountData(account);defer.resolve(accountData);attemptedRefreshes=0;}).catch(function(error){if(error.status===401&&attemptedRefreshes<=1){attemptedRefreshes++;authorizationService.refreshToken().then(function(data){$injectedData.token=data.data.token;self.getAccount();}).catch(function(){accountData=error;defer.reject(error);});}else{accountData=error;defer.reject(error);}});}}
return defer.promise;},setAccountData:function(account){var result=account;result.hasSub=account.hasSubscription;result.numCredits=account.creditBalance;result.userId=account.istockUserId;if(account.hasSubscription){result.sub={type:account.subscriptionInfo.collectionName,downloadsRemaining:account.subscriptionInfo.downloadCountRemaining,downloadCount:account.subscriptionInfo.downloadCount,expires:account.subscriptionInfo.expiration,sku:account.subscriptionInfo.sku,duration:account.subscriptionInfo.duration,autoRenewal:account.subscriptionInfo.isAutoRenew};}
self.handleCookie(result);accountData=result;},getAccountData:function(){return accountData;},isLoggedIn:function(){return OptionsRestangular.userLoggedIn();},handleCookie:function(result){if(result.hasSub){if(!ipCookie(SUBTYPE_COOKIE)||(ipCookie(SUBTYPE_COOKIE)&&ipCookie(SUBTYPE_COOKIE)!==result.sub.type)){ipCookie(SUBTYPE_COOKIE,result.sub.type,{path:'/',expires:7,domain:'.istockphoto.com'});}}else if(ipCookie(SUBTYPE_COOKIE)){ipCookie.remove(SUBTYPE_COOKIE);}},getSubTypeCookie:function(){return ipCookie(SUBTYPE_COOKIE);}};return self;}]);}());(function(){'use strict';var APP=angular.module('common.services');APP.factory('OptionsRestangular',['Restangular','$routeParams','$injectedData',function(Restangular,$routeParams,$injectedData){var self={getIETFCode:function(strCode){if(strCode.indexOf('_')>-1){return strCode.split('_')[0];}
return strCode;},getJavaRestConfig:function(){return Restangular.withConfig(function(RestangularConfigurer){var headers={'Content-Type':'application/json','Accept-Language':self.getIETFCode(istock.siteLang),'X-Istock-Development-Subdomain':$injectedData.env,'X-Istock-Search-Token':$routeParams.st};if($injectedData.token){headers.Authorization='Bearer '+$injectedData.token;}
RestangularConfigurer.setBaseUrl(istock.restUrl);RestangularConfigurer.setDefaultHeaders(headers);RestangularConfigurer.setDefaultHttpFields({cache:true});});},getJavaRestWithDescription:function(){return Restangular.withConfig(function(RestangularConfigurer){var headers={'Content-Type':'application/json','Accept-Language':self.getIETFCode(istock.siteLang),'X-Istock-Search-Token':$routeParams.st,'X-Istock-Include-Description':true};if($injectedData.token){headers.Authorization='Bearer '+$injectedData.token;}
RestangularConfigurer.setBaseUrl(istock.restUrl);RestangularConfigurer.setDefaultHeaders(headers);RestangularConfigurer.setDefaultHttpFields({cache:true});});},getPhpRestConfig:function(){return Restangular.withConfig(function(RestangularConfigurer){var headers={'Content-Type':'application/json'};RestangularConfigurer.setBaseUrl('/api/');RestangularConfigurer.setDefaultHeaders(headers);RestangularConfigurer.setDefaultHttpFields({cache:true});});},userLoggedIn:function(){return $injectedData.token!==null&&$injectedData.token!==undefined;},getJavaFullResponseConfig:function(){return Restangular.withConfig(function(RestangularConfigurer){var headers={'Content-Type':'application/json','Accept-Language':self.getIETFCode(istock.siteLang),'X-Istock-Search-Token':$routeParams.st};if($injectedData.token){headers.Authorization='Bearer '+$injectedData.token;}
RestangularConfigurer.setBaseUrl(istock.restUrl);RestangularConfigurer.setDefaultHeaders(headers);RestangularConfigurer.setFullResponse(true);RestangularConfigurer.setDefaultHttpFields({cache:true});});}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('gettyMasterIdService',['$q','OptionsRestangular',function($q,OptionsRestangular){var CONVERT_ID_ENDPOINT='assets/convert/afid',cachedData={},_getMasterId;_getMasterId=function(assetId){var defer=$q.defer();if(!(assetId in cachedData)){OptionsRestangular.getJavaRestConfig().one(CONVERT_ID_ENDPOINT,assetId).get().then(function(gettyObject){cachedData[assetId]=gettyObject;defer.resolve(cachedData[assetId]);},function(error){defer.reject(error);});}else{defer.resolve(cachedData[assetId]);}
return defer.promise;};return{getMasterId:_getMasterId};}]);}());(function(){'use strict';angular.module('common.services').factory('colorService',[function(){var self={isHexadecimalValue:function(hex){return/(^#?[0-9A-Fa-f]{6}$)/i.test(hex);},formatHexadecimalValue:function(hex){if(!self.isHexadecimalValue(hex)){return hex;}
return hex.replace('#','').toUpperCase();},getMostVisibleColor:function(hexadecimal,light,dark){if(!self.isHexadecimalValue(hexadecimal)){return light;}
var hex=self.formatHexadecimalValue(hexadecimal),r=parseInt(hex.substr(0,2),16),g=parseInt(hex.substr(2,2),16),b=parseInt(hex.substr(4,2),16),yiq=((r*299)+(g*587)+(b*114))/1000;return(yiq>=128)?dark:light;},rgbToHex:function(R,G,B){return'#'+self.toHex(R)+self.toHex(G)+self.toHex(B);},toHex:function(value){var hex='00';if(value===null||value<=0){return hex;}
hex=value.toString(16).toUpperCase();if(hex.length===1){hex='0'+hex;}
return hex;}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('categoriesService',[function(){var self={categories:{'animals and pets':{urlTranslation:{'en_US':'animals+or+pets','de_DE':'tier+or+haustier','es_ES':'animal+or+animales+domsticos','fr_FR':'faune+ou+animaux+familiers','it_IT':'animale+or+animale+domestico','ja_JP':'+or+','ko_KR':'+or+ ','pl_PL':'zwierz+or+pieszczochy','pt_BR':'animal+or+pet','pt_PT':'animal+or+pet','ru_RU':'+or+'}},'animals':{urlTranslation:{'en_US':'animals','de_DE':'tier','es_ES':'animal','fr_FR':'faune','it_IT':'animale','ja_JP':'','ko_KR':'','pl_PL':'zwierz','pt_BR':'animal','pt_PT':'animal','ru_RU':''}},'pets':{urlTranslation:{'en_US':'pets','de_DE':'haustier','es_ES':'animales+domsticos','fr_FR':'animaux+familiers','it_IT':'animale+domestico','ja_JP':'','ko_KR':' ','pl_PL':'pieszczochy','pt_BR':'pet','pt_PT':'pet','ru_RU':''}},'dogs':{urlTranslation:{'en_US':'dogs','de_DE':'hund','es_ES':'perro','fr_FR':'chien','it_IT':'cane','ja_JP':'','ko_KR':'','pl_PL':'dobytek','pt_BR':'criaco','pt_PT':'criaco','ru_RU':'+'}},'wild animals':{urlTranslation:{'en_US':'wild+animals','de_DE':'wildtier','es_ES':'salvaje','fr_FR':'faune+sauvage','it_IT':'selvaggio','ja_JP':'','ko_KR':'+','pl_PL':'dzika+fauna','pt_BR':'selvagem','pt_PT':'selvagem','ru_RU':'+'}},'architecture and buildings':{urlTranslation:{'en_US':'architecture','de_DE':'architektionisch','es_ES':'arquitectura','fr_FR':'architecture','it_IT':'architettura','ja_JP':'','ko_KR':'','pl_PL':'architektura','pt_BR':'arquitetura','pt_PT':'arquitetura','ru_RU':''}},'architecture':{urlTranslation:{'en_US':'architecture','de_DE':'architektionisch','es_ES':'arquitectura','fr_FR':'architecture','it_IT':'architettura','ja_JP':'','ko_KR':'','pl_PL':'architektura','pt_BR':'arquitetura','pt_PT':'arquitetura','ru_RU':''}},'arts abstract':{urlTranslation:{'en_US':'arts+abstract','de_DE':'kunst+abstrakt','es_ES':'arte+abstracto','fr_FR':'art+abstrait','it_IT':'arte+astratto','ja_JP':'+','ko_KR':'+','pl_PL':'sztuka+abstrakcyjny','pt_BR':'arte+abstrato','pt_PT':'arte+abstrato','ru_RU':'+'}},'beauty and health':{urlTranslation:{'en_US':'beauty+and+health','de_DE':'schnheit+and+gesundheit','es_ES':'belleza+and+salud','fr_FR':'beaut+et+sant','it_IT':'bellezza+and+salute','ja_JP':'+and+','ko_KR':'+and+','pl_PL':'pikno+and+zdrowy','pt_BR':'beleza+and+sade','pt_PT':'beleza+and+sade','ru_RU':'+and+'}},'beauty':{urlTranslation:{'en_US':'beauty','de_DE':'schnheit','es_ES':'belleza','fr_FR':'beaut','it_IT':'bellezza','ja_JP':'','ko_KR':'','pl_PL':'pikno','pt_BR':'beleza','pt_PT':'beleza','ru_RU':''}},'body':{urlTranslation:{'en_US':'body','de_DE':'koerperteile','es_ES':'parte+del+cuerpo+humano','fr_FR':'corps','it_IT':'anatomia+umana','ja_JP':'','ko_KR':'','pl_PL':'ludzkie+ciao','pt_BR':'corpo+humano','pt_PT':'corpo+humano','ru_RU':'+'}},'fashion':{urlTranslation:{'en_US':'fashion','de_DE':'mode','es_ES':'moda','fr_FR':'secteur+de+la+mode','it_IT':'moda','ja_JP':'','ko_KR':'','pl_PL':'fason','pt_BR':'moda+e+roupas','pt_PT':'moda+e+roupas','ru_RU':''}},'medicine':{urlTranslation:{'en_US':'medicine','de_DE':'medikament','es_ES':'medicina','fr_FR':'mdicament','it_IT':'medicina','ja_JP':'','ko_KR':'','pl_PL':'medycyna','pt_BR':'remdio','pt_PT':'remdio','ru_RU':''}},'business':{urlTranslation:{'en_US':'business','de_DE':'geschaeftsleben','es_ES':'negocio','fr_FR':'affaires','it_IT':'affari','ja_JP':'','ko_KR':'','pl_PL':'handlowy','pt_BR':'negcios','pt_PT':'negcios','ru_RU':''}},'concepts and ideas':{urlTranslation:{'en_US':'concepts','de_DE':'konzepte','es_ES':'conceptos','fr_FR':'concepts','it_IT':'concetti','ja_JP':'','ko_KR':'','pl_PL':'pojcia','pt_BR':'conceitos','pt_PT':'conceitos','ru_RU':''}},'feelings and emotions':{urlTranslation:{'en_US':'emotions','de_DE':'gefhl','es_ES':'emocin+humana','fr_FR':'motive','it_IT':'emozione','ja_JP':'','ko_KR':'','pl_PL':'zachowanie','pt_BR':'comportamento','pt_PT':'emoo+humana','ru_RU':''}},'healthy lifestyle':{urlTranslation:{'en_US':'healthy+lifestyle','de_DE':'gesundheit','es_ES':'salud','fr_FR':'sant','it_IT':'salute','ja_JP':'','ko_KR':'','pl_PL':'zdrowy','pt_BR':'sade','pt_PT':'sade','ru_RU':'+'}},'food and drink':{urlTranslation:{'en_US':'food+and+drink','de_DE':'essen+und+trinken','es_ES':'comida+y+bebida','fr_FR':'alimentation+et+boisson','it_IT':'cibo+e+bevande','ja_JP':'','ko_KR':'+','pl_PL':'jado+i+pijaj','pt_BR':'comida+e+bebida','pt_PT':'comida+e+bebida','ru_RU':'++'}},'food':{urlTranslation:{'en_US':'food','de_DE':'essen','es_ES':'comida','fr_FR':'alimentation','it_IT':'cibo','ja_JP':'','ko_KR':'','pl_PL':'jado','pt_BR':'comida','pt_PT':'comida','ru_RU':''}},'holidays':{urlTranslation:{'en_US':'holidays','de_DE':'feiertag','es_ES':'celebraciones+pblicas','fr_FR':'vnement+public','it_IT':'festa','ja_JP':'','ko_KR':'holidays','pl_PL':'wito','pt_BR':'holidays','pt_PT':'feriado','ru_RU':''}},'celebration':{urlTranslation:{'en_US':'holidays','de_DE':'feiertag','es_ES':'celebraciones+pblicas','fr_FR':'vnement+public','it_IT':'festa','ja_JP':'','ko_KR':'holidays','pl_PL':'wito','pt_BR':'holidays','pt_PT':'feriado','ru_RU':''}},'health care':{urlTranslation:{'en_US':'healthcare','de_DE':'gesundheitsfuersorge','es_ES':'medico','fr_FR':'mdecine','it_IT':'medicina','ja_JP':'','ko_KR':'','pl_PL':'zdrowy','pt_BR':'saudveis','pt_PT':'saudveis','ru_RU':''}},'lifestyle':{urlTranslation:{'en_US':'lifestyle','de_DE':'lebensstil','es_ES':'estilos+de+vida','fr_FR':'style+de+vie','it_IT':'stili+di+vita','ja_JP':'','ko_KR':'+','pl_PL':'ycie','pt_BR':'estilo+de+vida','pt_PT':'estilos+de+vida','ru_RU':'+'}},'babies':{urlTranslation:{'en_US':'babies','de_DE':'baby','es_ES':'beb','fr_FR':'bb','it_IT':'infante','ja_JP':'','ko_KR':'','pl_PL':'niemowl','pt_BR':'beb','pt_PT':'beb','ru_RU':''}},'children':{urlTranslation:{'en_US':'children','de_DE':'kind','es_ES':'nio','fr_FR':'enfant','it_IT':'bambino','ja_JP':'','ko_KR':'','pl_PL':'dziecko','pt_BR':'criana','pt_PT':'criana','ru_RU':''}},'family':{urlTranslation:{'en_US':'families','de_DE':'familie','es_ES':'familias','fr_FR':'famille','it_IT':'famiglia','ja_JP':'','ko_KR':'','pl_PL':'rodzina','pt_BR':'famlia','pt_PT':'familia','ru_RU':''}},'medicine and science':{urlTranslation:{'en_US':'medicine+science','de_DE':'medikament+or+wissenschaft','es_ES':'medicina+or+ciencia','fr_FR':'mdicament+ou+science','it_IT':'medicina+or+scienza','ja_JP':'+or+','ko_KR':'+or+','pl_PL':'medycyna+or+nauka','pt_BR':'remdio+or+cincia','pt_PT':'remdio+or+cincia','ru_RU':'+or+'}},'medical':{urlTranslation:{'en_US':'medical','de_DE':'medizin','es_ES':'medico','fr_FR':'mdecine','it_IT':'medicina','ja_JP':'','ko_KR':'','pl_PL':'medyczny','pt_BR':'saudvel','pt_PT':'medicina','ru_RU':''}},'research':{urlTranslation:{'en_US':'research','de_DE':'forschen','es_ES':'Investigacin','fr_FR':'recherche','it_IT':'ricerca','ja_JP':'','ko_KR':'','pl_PL':'badanie','pt_BR':'pesquisa','pt_PT':'pesquisa','ru_RU':''}},'nature':{urlTranslation:{'en_US':'nature','de_DE':'natur','es_ES':'naturaleza','fr_FR':'nature','it_IT':'natura','ja_JP':'','ko_KR':'','pl_PL':'natura','pt_BR':'natureza','pt_PT':'natureza','ru_RU':''}},'flowers':{urlTranslation:{'en_US':'flowers','de_DE':'blume','es_ES':'flor','fr_FR':'fleur','it_IT':'fiore','ja_JP':'','ko_KR':'','pl_PL':'kwiat','pt_BR':'flor','pt_PT':'flor','ru_RU':''}},'landscapes':{urlTranslation:{'en_US':'landscapes','de_DE':'landschaft','es_ES':'paisaje','fr_FR':'paysage','it_IT':'paesaggio','ja_JP':'','ko_KR':'','pl_PL':'krajobraz','pt_BR':'paisagem','pt_PT':'paisagem','ru_RU':''}},'people':{urlTranslation:{'en_US':'people','de_DE':'menschen','es_ES':'personas','fr_FR':'personne','it_IT':'persone','ja_JP':'','ko_KR':'','pl_PL':'ludzie','pt_BR':'pessoas','pt_PT':'pessoas','ru_RU':''}},'sports':{urlTranslation:{'en_US':'sports','de_DE':'sport','es_ES':'deportes','fr_FR':'sport','it_IT':'sport','ja_JP':'','ko_KR':'','pl_PL':'zabawa','pt_BR':'esporte','pt_PT':'desporto','ru_RU':''}},'fitness':{urlTranslation:{'en_US':'fitness','de_DE':'durchtrainiertem','es_ES':'entrenamientos','fr_FR':'exercice+physique','it_IT':'riscaldamento','ja_JP':'','ko_KR':'','pl_PL':'fizyczny+ruch','pt_BR':'exercitam','pt_PT':'malhao','ru_RU':'++'}},'technology':{urlTranslation:{'en_US':'technology','de_DE':'technologie','es_ES':'tecnologa','fr_FR':'technologie','it_IT':'tecnologia','ja_JP':'','ko_KR':'','pl_PL':'technologia','pt_BR':'tecnologia','pt_PT':'tecnologia','ru_RU':''}},'travel':{urlTranslation:{'en_US':'travel','de_DE':'reisen','es_ES':'viajes','fr_FR':'voyage','it_IT':'viaggi','ja_JP':'','ko_KR':'','pl_PL':'przesuw','pt_BR':'viagem','pt_PT':'viagem','ru_RU':''}},'landmarks':{urlTranslation:{'en_US':'landmarks','de_DE':'sehenswrdigkeit','es_ES':'lugar+de+inters','fr_FR':'lieu+touristique','it_IT':'luogo+d\'interesse','ja_JP':'','ko_KR':'+','pl_PL':'miejsce+zainteresowania','pt_BR':'ponto+tturstico','pt_PT':'lugar+de+interesse','ru_RU':'++'}}},translate:function(category){var str=category.toLowerCase(),url='',categoryInfo=self.categories[str];if(istock.locale&&categoryInfo){url=categoryInfo.urlTranslation[istock.locale];}
if(url===''){url=str.replace(/\s/g,'+');}
return url;},categoryUrl:function(category){return'/royalty-free/'+self.translate(category);}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('assetService',['$q','OptionsRestangular',function($q,OptionsRestangular){var ASSETS_ENDPOINT='assets',rest,cachedData={},_getDeferred,_getAsset;_getAsset=function(gettyId,hasCookie,user){var defer=$q.defer();if(!(gettyId in cachedData)){if(!hasCookie&&user===null){rest=OptionsRestangular.getJavaRestWithDescription();}else{rest=OptionsRestangular.getJavaRestConfig();}
rest.one(ASSETS_ENDPOINT,gettyId).get().then(function(asset){cachedData[gettyId]=asset;defer.resolve(cachedData[gettyId]);},function(error){defer.reject(error);});}else{defer.resolve(cachedData[gettyId]);}
return defer.promise;};return{getAsset:_getAsset,getDeferred:_getDeferred};}]);}());(function(){'use strict';angular.module('common.services').factory('legacyFacetService',['facetStateService',function(facetStateService){var self={facetMapping:{0:'searchId',2:'lightboxID',3:'portfolioID',4:'color',5:'copySpace',6:'activeStatus',7:'fileCollection',9:'filterContent',12:'showPeople',15:'tempo',16:'audioKey',17:'timeSignature1',18:'timeSignature2',19:'date',20:'orientation',21:'exclusiveContributor',25:'order',26:'bestMatchMix',30:'perPage',34:'abstractType',35:'text',36:'textDisambiguation',39:'pageNumber',40:'noCache',41:'photoSize',42:'vectorPrice',44:'videoSize',45:'audioPrice',46:'priceLevel',47:'editorsPick',50:'fileIdSet',51:'decoration',52:'subscriptionCollection',53:'loginToken',54:'keywordLanguage',55:'deduplicate',56:'gettyMasterIdSet',57:'similarity',420:'exclusiveEditorsPickVetta',1002:'countryID',1003:'additionalAudio',1004:'editorial',1006:'shuffleFiletypeCycle',1008:'adminSearch',1009:'userPartition',1010:'shufflePriceLevelCycle',1012:'aspectRatioVideo',3001:'latestFiles',3003:'filterVector',3004:'keywordRankAdjustment',3005:'collectionPrice'},optionsMapping:{editorsPick:{0:'false',1:'true'},noCache:{0:'false',1:'true'},filterVector:{0:'false',1:'true'},exclusiveEditorsPickVetta:{1:'onlyFromIstock',2:'editorsPick',4:'vetta'},photoSize:{1:'xl',10:'xxl',85:'xxxl'},fileCollection:{2:'essentials',4:'vetta',8:'value',9:'signature',16:'signature+'},abstractType:{1:'photos',7:'illustrations',8:'video',9:'audio'},order:{4:'new',6:'bestMatch',7:'yearPopular',10:'bestMatchAlternate',12:'allTimePopular',13:'monthPopular'},editorial:{0:false,1:true},collectionPrice:{1:'essentials',2:'signature'},exclusiveContributor:{0:false,1:true},showPeople:{0:false,1:true,2:'other'},filterContent:{0:false,1:true},orientation:{1:'vertical',2:'square',4:'horizontal'},aspectRatioVideo:{1:'4:3',2:'16:9'},videoSize:{18:'ntsc',21:'pal',23:'hd1080',24:'hd720',33:'dv'},tempo:{1:'all',2:'very slow',3:'slow',4:'medium',5:'fast',6:'very fast'},audioKey:{0:'all',1:'undefined',2:'A',3:'A major',4:'A minor',5:'A flat',6:'A flat major',7:'A flat minor',8:'B',9:'B major',10:'B minor',11:'B flat',12:'B flat major',13:'B flat minor',14:'C',15:'C major',16:'C minor',17:'C sharp',18:'C sharp major',19:'C sharp minor',20:'D',21:'D major',22:'D minor',23:'E',24:'E major',25:'E minor',26:'E flat',27:'E flat major',28:'E flat minor',29:'F',30:'F major',31:'F minor',32:'F sharp',33:'F sharp major',34:'F sharp minor',35:'G',36:'G major',37:'G minor'},audioPrice:{68:'basic',75:'moderate',102:'detailed',77:'complex',79:'elaborate'},subscriptionCollection:{standard:'standard'},date:{1:'oneHour',2:'oneDay',3:'oneWeek',4:'oneMonth',5:'threeMonths',6:'sixMonths'}},initFromLegacyFacets:function(legacyFacets){var name='',option='',tempArray=[];angular.forEach(legacyFacets,function(value,key){name=self.facetMapping[key];if(angular.isArray(facetStateService.getFacet(name))&&!angular.isArray(value)){tempArray.push(value);value=tempArray;tempArray=[];}
if(self.optionsMapping[name]){if(angular.isArray(value)){angular.forEach(value,function(v){option=self.optionsMapping[name][v];if(option!==undefined){facetStateService.setFacetOption(name,option,true);}});}else{option=self.optionsMapping[name][value];if(option!==undefined){facetStateService.setFacetOption(name,option,true);}}}else if(name!==undefined){switch(typeof facetStateService.getFacet(name)){case'number':value=Number(value);break;case'boolean':value=value==='true';break;}
facetStateService.setFacet(name,value);}});self.setAppropriateAbstractFileType();},setAppropriateAbstractFileType:function(){var images=facetStateService.hasActiveFacets(facetStateService.imagesFacets),audio=facetStateService.hasActiveFacets(facetStateService.audioFacets),video=facetStateService.hasActiveFacets(facetStateService.videoFacets),abstractType=facetStateService.getFacet('abstractType'),fileType=facetStateService.getActiveValues('abstractType');if(fileType.length===1){if((fileType.indexOf('photos')!==-1||fileType.indexOf('illustrations')!==-1)&&(audio||video)){facetStateService.clearFileTypeFacetGroups('images');abstractType.audio=false;abstractType.video=false;}else{if(fileType.indexOf('video')!==-1&&(images||audio)){facetStateService.clearFileTypeFacetGroups('video');abstractType.audio=false;abstractType.photos=false;abstractType.illustrations=false;}else if(fileType.indexOf('audio')!==-1&&(images||video)){facetStateService.clearFileTypeFacetGroups('audio');abstractType.video=false;abstractType.photos=false;abstractType.illustrations=false;}}}else{if(images+audio+video>1){facetStateService.setFileTypeToDefault();facetStateService.clearFileTypeFacetGroups('images');}else if(images){abstractType.photos=true;abstractType.illustrations=true;abstractType.video=false;abstractType.audio=false;}else if(audio){abstractType.audio=true;abstractType.photos=false;abstractType.illustrations=false;abstractType.video=false;}else if(video){abstractType.video=true;abstractType.audio=false;abstractType.photos=false;abstractType.illustrations=false;}else{if(fileType.length>1){facetStateService.setFileTypeToDefault();}}}}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('dropboxService',['$q','OptionsRestangular','dropboxErrorHandlerService',function($q,OptionsRestangular,dropboxErrorHandlerService){var DROPBOX_ENDPOINT='oauthclient/dropbox',DROPBOX_ASSETPUSH_ENDPOINT='user/preference/assetpush';return{getAuthenticationUrl:function(dropboxKey,state,redirectUri){var metaLang=angular.element('html').attr('lang').split('-')[0].toLowerCase();return['https://www.dropbox.com/1/oauth2/authorize','?response_type=code&client_id=',dropboxKey,'&redirect_uri=',redirectUri,'&locale=',metaLang,'&state=',state].join('');},connectAccount:function(code,redirectUri){var unencodedDropboxData={'code':code,'redirect_uri':redirectUri},params,str=[],deferred=$q.defer();for(params in unencodedDropboxData){if(params!==undefined){str.push(encodeURIComponent(params)+'='+encodeURIComponent(unencodedDropboxData[params]));}}
str=str.join('&');OptionsRestangular.getJavaRestConfig().one(DROPBOX_ENDPOINT).customPOST(str,null,null,{'Content-Type':'application/x-www-form-urlencoded'}).then(function(response){if(response.status===201){deferred.resolve({'connected':true,'timeStamp':response.data});}},function(error){deferred.reject({'connected':false,'error':error,'message':dropboxErrorHandlerService.getErrorMessage(error.status)});});return deferred.promise;},disconnectAccount:function(){var deferred=$q.defer();OptionsRestangular.getJavaRestConfig().one(DROPBOX_ENDPOINT).remove().then(function(response){if(response.status===200){deferred.resolve({'disconnected':true});}},function(error){deferred.reject({'disconnected':false,'error':error,'message':dropboxErrorHandlerService.getErrorMessage(error.status)});});return deferred.promise;},getAccountStatus:function(){var deferred=$q.defer();OptionsRestangular.getJavaRestConfig().one(DROPBOX_ENDPOINT).get().then(function(response){if(response.status===200){deferred.resolve({'connected':true});}},function(error){if(error.status===404){deferred.resolve({'connected':false});}else{deferred.reject({'connected':false,'message':dropboxErrorHandlerService.getErrorMessage(error.status)});}});return deferred.promise;},setAssetPushStatus:function(backUpFutureDownloads,daysBack){var settings={'Dropbox':{'backUpFutureDownloads':backUpFutureDownloads,'daysBack':daysBack}},deferred=$q.defer();OptionsRestangular.getJavaRestConfig().one(DROPBOX_ASSETPUSH_ENDPOINT).customPUT(settings).then(function(response){if(response.status===200){deferred.resolve({'updated':true});}},function(error){deferred.reject({'updated':false,'message':dropboxErrorHandlerService.getErrorMessage(error.status)});});return deferred.promise;},getAssetPushStatus:function(){var deferred=$q.defer();OptionsRestangular.getJavaRestConfig().one(DROPBOX_ASSETPUSH_ENDPOINT).get().then(function(response){if(response.status===200){deferred.resolve({'error':false,'daysBack':response.data.Dropbox.daysBack,'downloadsFromDate':response.data.Dropbox.backUpFutureLastSet,'lastUpdateDate':response.data.Dropbox.daysBackSettingLastSet});}},function(error){deferred.resolve({'error':true,'message':dropboxErrorHandlerService.getErrorMessage(error.status)});});return deferred.promise;},getErrorMessages:function(statusCodes){return dropboxErrorHandlerService.getErrorMessages(statusCodes);}};}]);}());(function(){'use strict';angular.module('common.services').factory('dropboxErrorHandlerService',['ERROR_MESSAGING','$filter',function(ERROR_MESSAGING,$filter){var self={getErrorMessage:function(statusCode){var errorMessage='';switch(statusCode){case 403:case 401:case 502:errorMessage=$filter('i18n')(ERROR_MESSAGING.DROPBOX_ERROR.OAUTH_TOKEN_BROKEN,statusCode);break;case 429:errorMessage=$filter('i18n')(ERROR_MESSAGING.DROPBOX_ERROR.API_LIMIT_ERROR,'/contact_ticket',statusCode);break;case 507:errorMessage=$filter('i18n')(ERROR_MESSAGING.DROPBOX_ERROR.STORAGE_FULL,statusCode);break;case 404:errorMessage=$filter('i18n')(ERROR_MESSAGING.DROPBOX_ERROR.SERVER_ERROR,'/contact_ticket',statusCode);break;default:errorMessage=$filter('i18n')(ERROR_MESSAGING.DROPBOX_ERROR.ERROR,'/contact_ticket');}
return errorMessage;},getErrorMessages:function(statusCodes){var message=[];angular.forEach(statusCodes,function(statusCode){message.push(self.getErrorMessage(statusCode));});return message.join('<br><br>');}};return self;}]);}());(function(){'use strict';var RENDER_DELAY=100,DOCUMENT_DELAY=2000;angular.module('common.services').factory('lazyImageService',['$document','$window','$timeout',function($document,$window,$timeout){var renderDelay=RENDER_DELAY,documentDelay=DOCUMENT_DELAY,documentHeight=$document.height(),win=angular.element($window),isWatchingWindow=false,renderTimer=null,documentTimer=null,self={enabled:false,images:[],prioritizeFirstBatch:false,addImage:function(element,onLoad,tag){var image={source:null,isRendered:false,height:null,element:element,tag:tag||'src',onLoad:onLoad};self.images.push(image);if(!renderTimer){self.startRenderTimer();}
if(!isWatchingWindow){self.startWatchingWindow();}
return image;},removeImage:function(image){var index=self.images.indexOf(image);if(index!==-1){self.images.splice(index,1);}
if(self.images.length===0){self.clearRenderTimer();self.stopWatchingWindow();}},checkDocumentHeight:function(){var currentDocumentHeight=$document.height();if(renderTimer||currentDocumentHeight===documentHeight){return;}
documentHeight=currentDocumentHeight;self.startRenderTimer();},checkImages:function(){var visible=[],hidden=[],windowHeight=win.height(),scrollTop=win.scrollTop(),topFoldOffset=scrollTop,bottomFoldOffset=(topFoldOffset+windowHeight);angular.forEach(self.images,function(image){if(self.isVisible(image,topFoldOffset,bottomFoldOffset)){visible.push(image);}else{hidden.push(image);}});var visibleCount=visible.length;angular.forEach(visible,function(img){self.render(img);if(self.prioritizeFirstBatch){img.element.load(function(){visibleCount--;if(visibleCount===0){angular.forEach(self.images,function(img){self.render(img);});self.images=[];self.clearRenderTimer();self.stopWatchingWindow();}});}});self.images=hidden;self.clearRenderTimer();if(self.images.length===0){self.stopWatchingWindow();}},clearRenderTimer:function(){if(renderTimer){$timeout.cancel(renderTimer);renderTimer=null;}},startRenderTimer:function(){if(renderTimer===null){renderTimer=$timeout(self.checkImages,renderDelay);}},startWatchingWindow:function(){if(!isWatchingWindow){isWatchingWindow=true;win.on('resize.lazySrc',self.windowChanged);win.on('scroll.lazySrc',self.windowChanged);documentTimer=$timeout(self.checkDocumentHeight,documentDelay);}},stopWatchingWindow:function(){if(isWatchingWindow){isWatchingWindow=false;win.off('resize.lazySrc');win.off('scroll.lazySrc');$timeout.cancel(documentTimer);}},windowChanged:function(){if(renderTimer===null){self.startRenderTimer();}},isVisible:function(image,topFoldOffset,bottomFoldOffset){var top,bottom;if(!image.element.is(':visible')){return false;}
if(image.height===null){image.height=image.element.height();}
top=image.element.offset().top;bottom=(top+image.height);return(((top<=bottomFoldOffset)&&(top>=topFoldOffset))||((bottom<=bottomFoldOffset)&&(bottom>=topFoldOffset))||((top<=topFoldOffset)&&(bottom>=bottomFoldOffset)));},render:function(image){image.isRendered=true;self.renderSource(image);},setSource:function(image,newSource){image.source=newSource;if(!self.enabled||image.isRendered){self.renderSource(image);}},renderSource:function(imageData){var image;if(self.enabled){image=new Image();image.onload=imageData.onLoad;image.src=imageData.source;}
imageData.element.attr(imageData.tag,imageData.source);}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('flattenService',[function(){var flatten,unflatten,isObject,SEPARATOR='.';isObject=function(value){var type=Object.prototype.toString.call(value);return(type==='[object Object]'||type==='[object Array]');};flatten=function(target){var output={},step;step=function(obj,prev){Object.keys(obj).forEach(function(key){var value=obj[key],newKey=key;if(prev){newKey=[prev,key].join(SEPARATOR);}
if(isObject(value)&&Object.keys(value).length){return step(value,newKey);}
output[newKey]=value;});};step(target);return output;};unflatten=function(target){var result={},getKey;if(!isObject(target)){return target;}
getKey=function(key){var parsedKey=Number(key);if(isNaN(parsedKey)||key.indexOf(SEPARATOR)!==-1){return key;}else{return parsedKey;}};Object.keys(target).forEach(function(key){var keys=key.split(SEPARATOR),key1=getKey(keys.shift()),key2=getKey(keys[0]),container=result;while(typeof key2!=='undefined'){if(typeof container[key1]==='undefined'){if(typeof key2==='number'){container[key1]=[];}else{container[key1]={};}}
container=container[key1];if(keys.length>0){key1=getKey(keys.shift());key2=getKey(keys[0]);}}
container[key1]=unflatten(target[key]);});return result;};return{flatten:flatten,unflatten:unflatten};}]);}());(function(){'use strict';angular.module('common.services').factory('hashService',[function(){var hashCode;hashCode=function(str){var hash=0,i,chr,len;if(str.length===0){return hash;}
for(i=0,len=str.length;i<len;i++){chr=str.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash|=0;}
return hash;};return{hashCode:hashCode};}]);}());(function(){'use strict';var NS='common.directives';angular.module(NS,['ngDebounce','common.services']);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mpAudioInfoPane',[function(){return{restrict:'E',require:'^mediaPlayer',templateUrl:'/static/js/angular/common/partials/media-player/_audioInfoPane.html',link:function(scope,elem,attrs,ctrl){scope.result=ctrl.getResultData();}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mediaPlayer',['MEDIAPLAYER_STATES','mediaPlayerService',function(MEDIAPLAYER_STATES,mediaPlayerService){return{restrict:'E',scope:{media:'=',mediaData:'='},transclude:true,templateUrl:function(elem,attrs){return['/static/js/angular/common/partials/media-player/_',attrs.media,'.html'].join('');},controller:function($scope){var t=this;$scope.state={currentState:MEDIAPLAYER_STATES.STOP,currentTime:0,loop:false,mutedVolume:'1.0',previewUrl:'',timeLeft:0,totalTime:0,volume:'1.0'};this.inferType=function(media){var type;switch(media){case'audio':type='audio/mp3';break;case'video':type='video/mp4';break;}
return type;};this.getSource=function(media){var previewUrl;switch(media){case'audio':previewUrl=['/audio_mp3_preview.php?id=',$scope.mediaData.fileId].join('');break;case'video':previewUrl=$scope.mediaData.previewUrl;break;}
$scope.state.previewUrl=previewUrl;return $scope.state.previewUrl;};this.getPreviewUrl=function(){return $scope.state.previewUrl;};this.setState=function(newState){if(newState&&newState!==$scope.state.currentState){$scope.state.currentState=newState;}};this.play=function(){$scope.mediaElement[0].play();t.setState(MEDIAPLAYER_STATES.PLAY);};this.pause=function(){$scope.mediaElement[0].pause();t.setState(MEDIAPLAYER_STATES.PAUSE);};this.stop=function(hardStop){if($scope.state.loop&&!hardStop){$scope.mediaElement[0].currentTime=0;$scope.mediaElement[0].play();}else if(!$scope.mediaElement[0].paused||$scope.mediaElement[0].currentTime!==0){$scope.mediaElement[0].pause();$scope.mediaElement[0].currentTime=0;this.setState(MEDIAPLAYER_STATES.STOP);}};this.playToggle=function(){if($scope.mediaElement[0].paused){mediaPlayerService.playMedia($scope.$id);}else{this.pause();}};this.getVolume=function(){return $scope.state.volume;};this.setVolume=function(value){$scope.state.volume=value;$scope.mediaElement[0].volume=value;};this.muteVolume=function(){$scope.state.mutedVolume=$scope.state.volume;$scope.state.setVolume(0.0);};this.restoreVolume=function(){$scope.state.setVolume($scope.state.mutedVolume);};this.seekTime=function(value){$scope.mediaElement[0].currentTime=value;$scope.state.currentTime=value;};this.getResultData=function(){return $scope.mediaData;};this.getDuration=function(){var duration=$scope.state.totalTime;if(!duration){if($scope.mediaData.audio&&$scope.mediaData.audio.duration){duration=$scope.mediaData.audio.duration;}else{duration=$scope.mediaElement[0].duration;}
$scope.state.totalTime=duration;}
return duration;};this.onUpdateTime=function(event){var duration=t.getDuration();$scope.state.currentTime=event.target.currentTime;if(t.getDuration()!==Infinity){$scope.state.timeLeft=duration-event.target.currentTime;}
$scope.$apply();};this.onComplete=function(){t.stop();};$scope.state=this;},link:function(scope,elem,attrs,ctrl){var canPlay;scope.mediaElement=elem.find(attrs.media);if(attrs.loop!==undefined){scope.state.loop=true;}
scope.$watch('mediaData',function(data){if(data&&scope.mediaElement[0].canPlayType){scope.type=ctrl.inferType(attrs.media);canPlay=scope.mediaElement[0].canPlayType(scope.type);if(canPlay==='maybe'||canPlay==='probably'){scope.mediaElement.attr('src',scope.state.getSource(attrs.media));scope.mediaElement.attr('type',scope.type);}}});if(attrs.playOnHover!==undefined&&attrs.hoverTrigger){elem.closest(attrs.hoverTrigger)[0].addEventListener('mouseover',ctrl.play,false);elem.closest(attrs.hoverTrigger)[0].addEventListener('mouseout',ctrl.pause,false);}
if(attrs.autoplay!==undefined){scope.mediaElement[0].addEventListener('loadedmetadata',ctrl.playToggle,false);}
scope.mediaElement[0].addEventListener('loadedmetadata',ctrl.onUpdateTime,false);scope.mediaElement[0].addEventListener('loadedmetadata',ctrl.setVolume(1.0),false);scope.mediaElement[0].addEventListener('timeupdate',ctrl.onUpdateTime,false);scope.mediaElement[0].addEventListener('ended',ctrl.onComplete,false);mediaPlayerService._register(scope);}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mpPlayButton',['MEDIAPLAYER_STATES','omnitureService',function(MEDIAPLAYER_STATES,omnitureService){return{restrict:'E',require:'^mediaPlayer',templateUrl:'/static/js/angular/common/partials/media-player/_playButton.html',link:function(scope,elem,attrs,ctrl){scope.onPlayPause=function(){ctrl.playToggle();if(scope.playerState.play){omnitureService.playAudioFile();}};scope.changeIcon=function(newState){switch(newState){case MEDIAPLAYER_STATES.PLAY:scope.playerState={pause:true};break;case MEDIAPLAYER_STATES.PAUSE:case MEDIAPLAYER_STATES.STOP:scope.playerState={play:true};break;}};scope.playerState={play:true};scope.$watch(function(){return ctrl.currentState;},function(newState,oldState){if(newState!==oldState){scope.changeIcon(newState);}});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mpScrubBar',['$document',function($document){return{restrict:'E',require:'^mediaPlayer',templateUrl:'/static/js/angular/common/partials/media-player/_scrubBar.html',link:function(scope,elem,attrs,ctrl){var scrubber=elem.find('.scrub-bar'),dragMask=elem.find('.scrubber-drag-mask');scope.updateTime=function updateTime(newCurrentTime){var scrubberElem=elem.find('.scrubber'),percentTime;if(typeof newCurrentTime==='number'&&ctrl.getDuration()){percentTime=100*(newCurrentTime/ctrl.getDuration());scrubberElem.css('width',percentTime+'%');}else{scrubberElem.css('width',0);}};scope.scrubSeek=function scrubSeek(event){var scrubberWidth=scrubber.width(),clickOffset,scrubberPercent;if(event.offsetX===undefined){clickOffset=event.pageX-elem.find('.scrub-bar').offset().left;}else{clickOffset=event.offsetX;}
scrubberPercent=clickOffset/scrubberWidth;scope.updateTime(ctrl.getDuration()*scrubberPercent);ctrl.seekTime(ctrl.getDuration()*scrubberPercent);};scope.$watch(function(){return ctrl.currentTime;},function(newVal){scope.updateTime(newVal);});scope.scrubberMouseup=function scrubberMouseup(event){scope.scrubSeek(event);dragMask.unbind('mouseout',scope.scrubberMouseup);$document.unbind('mousemove',scope.scrubSeek);$document.unbind('mouseup',scope.scrubberMouseup);};dragMask.on('mousedown',function(event){event.preventDefault();dragMask.on('mouseout',scope.scrubberMouseup);$document.on('mousemove',scope.scrubSeek);$document.on('mouseup',scope.scrubberMouseup);});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mpTime',['MEDIAPLAYER_STATES',function(MEDIAPLAYER_STATES){return{restrict:'E',require:'^mediaPlayer',templateUrl:'/static/js/angular/common/partials/media-player/_time.html',scope:{duration:'='},link:function(scope,elem,attrs,ctrl){scope.isStopped=true;scope.mediaLength=0;if(scope.duration!==undefined){scope.mediaLength=scope.duration;}
scope.$watch(function(){return ctrl.totalTime;},function(totalTime){if(totalTime!==Infinity&&totalTime!==undefined&&!isNaN(totalTime)){scope.mediaLength=totalTime;}});scope.$watch(function(){return ctrl.currentTime;},function(newVal){scope.currentTime=newVal;});scope.$watch(function(){return ctrl.currentState;},function(newState){switch(newState){case MEDIAPLAYER_STATES.PLAY:case MEDIAPLAYER_STATES.PAUSE:scope.isStopped=false;break;case MEDIAPLAYER_STATES.STOP:scope.isStopped=true;break;}});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mpVolume',['$document',function($document){return{restrict:'E',require:'^mediaPlayer',templateUrl:'/static/js/angular/common/partials/media-player/_volume.html',link:function(scope,elem,attrs,ctrl){var scrubber=elem.find('.volume-scrub-bar'),dragMask=elem.find('.volume-scrubber-drag-mask');scope.adjustVolume=function adjustVolume(event){var scrubberWidth=scrubber.width(),clickOffset,scrubberPercent;if(event.offsetX===undefined){clickOffset=event.pageX-scrubber.offset().left;}else{clickOffset=event.offsetX;}
scrubberPercent=clickOffset/scrubberWidth;if(scrubberPercent>1.0){scrubberPercent=1.0;}else if(scrubberPercent<0.0){scrubberPercent=0.1;}
scope.updateVolume(scrubberPercent);ctrl.setVolume(scrubberPercent);};scope.updateVolume=function updateVolume(newVolume){var scrubberElem=elem.find('.scrubber'),iconElem=elem.find('.volume-icon'),volumePercent=newVolume*100;scrubberElem.css('width',volumePercent+'%');iconElem.removeClass('high-volume low-volume mute-volume');if(volumePercent===0){iconElem.addClass('mute-volume');}else if(volumePercent<50.0){iconElem.addClass('low-volume');}else{iconElem.addClass('high-volume');}};scope.toggleMute=function toggleMute(){if(ctrl.volume===0.0){scope.updateVolume(ctrl.mutedVolume);ctrl.restoreVolume();}else{scope.updateVolume(0.0);ctrl.muteVolume();}};scope.volumeMouseup=function volumeMouseup(event){scope.adjustVolume(event);dragMask.unbind('mouseout',scope.volumeMouseup);$document.unbind('mousemove',scope.adjustVolume);$document.unbind('mouseup',scope.volumeMouseup);};dragMask.on('mousedown',function(event){event.preventDefault();dragMask.on('mouseout',scope.volumeMouseup);$document.on('mousemove',scope.adjustVolume);$document.on('mouseup',scope.volumeMouseup);});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mpWaveform',[function(){return{restrict:'E',require:'^mediaPlayer',link:function(scope,elem,attrs,ctrl){var wavesurfer;elem.css('display','block');scope.$watch(function(){return ctrl.getPreviewUrl();},function(previewUrl){var options=angular.extend({container:elem[0]},attrs);options.interact=false;wavesurfer=WaveSurfer.create(options);if(previewUrl!==''){wavesurfer.load(previewUrl,attrs.data||null);}});scope.$watch(function(){return ctrl.currentTime;},function(newTime){wavesurfer.seekTo(newTime/ctrl.totalTime);});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('dropdown',['$document','dropdownService','SEARCH_STATE',function($document,dropdownService,SEARCH_STATE){return{restrict:'E',scope:{activationMethod:'@',label:'@',labelClass:'@',showActive:'@',activeOption:'@',orientation:'@',disableDropdownLabel:'@'},templateUrl:'/static/js/angular/common/partials/_dropdown.html',transclude:true,link:function(scope,element){scope.isVisible=false;dropdownService._register(scope);scope.dropdownToggle=function(_isVisible){dropdownService.toggle(scope.$id);scope.isVisible=_isVisible;};scope.isFileTypeExecutingSearch=function(){if(scope.labelClass==='search-file-type-selector'){return SEARCH_STATE.EXECUTING_SEARCH;}
return;};if(scope.activationMethod==='hover'){if(Modernizr.touch){element.on('click',function(){scope.dropdownToggle(!scope.isVisible);});}else{element.on('mouseenter',function(){scope.dropdownToggle(true);scope.$apply();}).on('mouseleave',function(){scope.dropdownToggle(false);scope.$apply();});}}else{element.on('click',function(){scope.dropdownToggle(!scope.isVisible);}).on('mouseleave',function(){scope.dropdownToggle(false);scope.$apply();});}}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('validator',['$compile','$animate','formValidationService',function($compile,$animate,formValidationService){return{restrict:'A',require:'ngModel',scope:true,link:function(scope,element,attrs,ctrl){scope.elementName=element[0].name;scope.deregistrationFuncs=[];scope.shouldValidate=true;scope.optional=false;scope.setValidity=function(name,valid){if(scope.optional===true){if(valid){element.removeClass('ng-warning');if(name.length>0){element.removeClass(['ng-',name,'-warning'].join(''));}}else{element.addClass('ng-warning');if(name.length>0){element.addClass(['ng-',name,'-warning'].join(''));}}}else{ctrl.$setValidity(name,valid);}};scope.setupListeners=function(validators){var modelWatch,eventListener,validMethods,watch;if(attrs.optional===''||attrs.optional==='true'){scope.optional=true;}
ctrl.$validate=function(){scope.updateValidation(validators);};if(attrs.validateIf){watch=scope.$watch(attrs.validateIf,function(){if(scope.$eval(attrs.validateIf)){scope.shouldValidate=true;}else{scope.shouldValidate=false;scope.removeMessage();}},true);scope.deregistrationFuncs.push(watch);}
scope.$on('form-submit',function(){scope.updateValidation(validators);});if(typeof attrs.validMethod!=='undefined'){validMethods=attrs.validMethod.split(/\s*,\s*/);validMethods.forEach(function(validMethod){if(validMethod==='blur'||validMethod==='change'){element.bind(validMethod+'.validate',function(){scope.$apply(function(){if(ctrl.$pristine){return;}
scope.updateValidation(validators);});});}else if(validMethod!=='submit'){modelWatch=scope.$watch(attrs.ngModel,function(){scope.updateValidation(validators);});scope.deregistrationFuncs.push(modelWatch);}});}
eventListener=scope.$on(ctrl.$name+'submit',function(){scope.updateValidation(validators);});scope.deregistrationFuncs.push(eventListener);if(attrs.validMethod!=='submit'&&!ctrl.$pristine){scope.updateValidation(validators);}};scope.deregisterListeners=function(){element.unbind('blur.validate');element.unbind('change.validate');scope.deregistrationFuncs.forEach(function(deregFunc){deregFunc();});scope.deregistrationFuncs=[];};scope.onValidatorChange=function(newVal){var validatorList;if(!newVal){return;}
validatorList=attrs.validator.split(/\s*,+\s*/);scope.deregisterListeners();scope.setupListeners(validatorList);};scope.removeMessage=function(){var inputContainer=element.closest('.input-container'),messageContainer=inputContainer.parent().find('.message-container'),message=messageContainer.find('.message');scope.setValidity(ctrl.$name,true);if(message.children().not('.'+element.attr('name')).length>0){message.find('.'+element.attr('name')).remove();}else{if(messageContainer.length>0){$animate.leave(messageContainer);}}};scope.addMessage=function(container,translationKey){var domElement='<span class="'+element.attr('name')+'" data-error="'+ctrl.$name+'" data-i18n= "'+translationKey+'">'+'</span>',compiledElement=$compile(domElement)(scope);container.append(compiledElement);};scope.showErrors=function(haveErrors,invalidValidator,isPromise){var translationKey,inputContainer=element.closest('.input-container'),messageContainer=inputContainer.parent().find('.message-container'),message=messageContainer.find('.message');if(haveErrors){if(messageContainer.length===0){messageContainer=angular.element('<div class="message-container"></div>');message=angular.element('<div class="message"></div>');messageContainer.append(message);$animate.enter(messageContainer,'',inputContainer);}
message.find('.'+element.attr('name')).remove();translationKey=attrs[invalidValidator+'ErrorMessageKey']||formValidationService.getDefaultMsgKey(invalidValidator).error;scope.addMessage(message,translationKey);}else{if(isPromise===false||(isPromise===true&&invalidValidator!==undefined)){scope.removeMessage();}}};scope.updateValidation=function(validators){if(scope.shouldValidate===false){return;}
var haveErrors=false,inputValue=ctrl.$viewValue,isPromise=false,invalidValidator;validators.forEach(function(validator){var isValid=formValidationService.process(validator,inputValue);if(typeof isValid==='object'&&!haveErrors){isValid.then(function(status){scope.setValidity(ctrl.$name,status);ctrl.$setViewValue(ctrl.$viewValue);scope.showErrors(!status,validator,true);if(attrs.afterValidation){scope.$eval(attrs.afterValidation);}},function(){scope.setValidity(ctrl.$name,false);ctrl.$setViewValue(ctrl.$viewValue);scope.showErrors(true,validator,true);if(attrs.afterValidation){scope.$eval(attrs.afterValidation);}});isValid=true;isPromise=true;}
if(!haveErrors&&!isValid){haveErrors=true;invalidValidator=validator;scope.setValidity(ctrl.$name,false);ctrl.$setViewValue(ctrl.$viewValue);isPromise=false;}});scope.showErrors(haveErrors,invalidValidator,isPromise);if(attrs.afterValidation){scope.$eval(attrs.afterValidation);}};attrs.$observe('validator',scope.onValidatorChange);}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('headroom',function(){return{restrict:'EA',scope:{tolerance:'=',offset:'=',classes:'=',enabled:'='},link:function(scope,element){scope.$on('destroy',function(){scope.headroom.destroy();});scope.$watch('enabled',function(newVal){if(newVal&&scope.headroom===undefined){scope.initHeadroom();}});scope.initHeadroom=function(){var options={};angular.forEach(Headroom.options,function(value,key){options[key]=scope[key]||Headroom.options[key];});options.offset=180;if(scope.offset){options.offset=scope.offset;}
options.onTop=function(){element.removeClass('searchbar-pinned');};scope.headroom=new Headroom(element[0],options).init();};}};});}());(function(){'use strict';var module=angular.module('common.directives');module.directive('focusInput',[function(){return{restrict:'A',scope:true,link:function(scope,element,attrs){element.on('click',function(){jQuery('#'+attrs.focusInput).focus();});}};}]);}());(function(){'use strict';angular.module('common.directives').directive('prettyPrice',function(){return{restrict:'E',transclude:true,scope:{symbol:'@',isPrefixSymbol:'@',shortName:'@',showShortName:'@'},template:['<span class="symbol" ng-show="isPrefixSymbol">{{ symbol }}</span>','<span class="amount" ng-transclude></span>','<span class="symbol" ng-hide="isPrefixSymbol">{{ symbol }}</span>','<span ng-show="showShortName">{{ shortName }}</span>'].join('')};});}());(function(){'use strict';var module=angular.module('common.directives');module.directive('loadingButton',function(){return{restrict:'A',transclude:true,scope:{loading:'='},template:['<span ng-transclude></span><div class="loader">','<div class="circle"></div><div class="circle"></div><div class="circle"></div>','</div>'].join(''),link:function(scope,element){scope.$watch('loading',function(val){if(val===true){element.addClass('loading');}else{element.removeClass('loading');}});}};});}());(function(){'use strict';var module=angular.module('common.directives');module.directive('searchFileTypeSelector',['OMNITURE_EVENTS','facetService','facetStateService',function(OMNITURE_EVENTS,facetService,facetStateService){var partialPath='/static/js/angular/common/partials/';return{restrict:'E',scope:{type:'@',resultCount:'=?'},templateUrl:[partialPath,'_searchFileTypeSelector.html'].join(''),controller:function($scope){$scope.fileTypeSelected=function(value){facetStateService.clearFacetGroup('abstractType');facetStateService.setFacet('additionalAudio','');facetStateService.setFacet('pageNumber',1);facetStateService.clearFileTypeFacetGroups(value);if(value==='images'){facetStateService.toggleFacet('abstractType','photos');facetStateService.toggleFacet('abstractType','illustrations');}else if(value==='all'){facetStateService.activateAllOptions('abstractType');facetStateService.setFacet('additionalAudio','true');}else{facetStateService.toggleFacet('abstractType',value);if(value==='audio'){facetStateService.setFacet('additionalAudio','true');}}
localStorage.setItem('typesSelectedSRP',angular.toJson(facetStateService.getActiveValues('abstractType')));$scope.selectedFileType=value;$scope.$emit(OMNITURE_EVENTS.SRP.SRP_SEARCH_UPDATE,'fileType',$scope.selectedFileType);};},link:function(scope){var totalNumberOfAbstractType=Object.keys(facetStateService.getFacet('abstractType')).length,lightboxID=facetStateService.getFacet('lightboxID'),portfolioID=facetStateService.getFacet('portfolioID'),adminSearch=facetStateService.getFacet('adminSearch');scope.facetGroup=facetService.getFacetGroup('abstractType').facets;scope.facetGroup.photos.isImageSubFacet=true;scope.facetGroup.illustrations.isImageSubFacet=true;scope.$watch(function(){return facetStateService.getActiveValues('abstractType');},function(newActiveValue){if(newActiveValue.length===totalNumberOfAbstractType){if(lightboxID||portfolioID||adminSearch){scope.selectedFileType='all';}else{scope.selectedFileType='images';}}else if(newActiveValue.length===1){scope.selectedFileType=newActiveValue;}else{scope.selectedFileType='images';}},true);scope.getFileTypeOptionState=function(value){return scope.selectedFileType.toString()===value;};scope.checkAccessibility=function(accessibility){var lightboxID=facetStateService.getFacet('lightboxID'),portfolioID=facetStateService.getFacet('portfolioID'),adminSearch=facetStateService.getFacet('adminSearch');if(accessibility==='private'){if(lightboxID||portfolioID||adminSearch){return true;}
return false;}
return true;};}
};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('scrollTo',[function(){return{restrict:'A',scope:'true',link:function(scope){scope.$on('scrollTo',function(event,scrollElement){angular.element('html, body').stop().animate({scrollTop:scrollElement.offset().top},1000,'easeOutQuart');});}
};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('spinner',['spinnerService',function(spinnerService){return{restrict:'E',replace:true,scope:{id:'@',group:'@?',showSpinner:'@?',type:'@?'},template:['<span class="ouroboros-spinner {{type}}" ng-show="showSpinner">','<span class="left"><span class="animation"></span></span>','<span class="right"><span class="animation"></span></span>','</span>'].join(''),controller:function($scope){spinnerService._register($scope);}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('affix',function($window){return function(scope,element,attrs){var winElem=angular.element($window),item;if(scope._stickyElements===undefined){scope._stickyElements=[];winElem.bind('scroll.affix',function(){var winTop=winElem.scrollTop(),i,item;for(i=0;i<scope._stickyElements.length;i++){item=scope._stickyElements[i];item.scroll(winTop);}});winElem.bind('resize',function(){var i,item,winTop=winElem.scrollTop(),winBottom=winElem.scrollTop()+winElem.height();for(i=0;i<scope._stickyElements.length;i++){item=scope._stickyElements[i];item.resize(winTop,winBottom);}});winElem.bind('load',function(){var i,item;for(i=0;i<scope._stickyElements.length;i++){item=scope._stickyElements[i];item.isFixed=item.element.hasClass('affix');if(!item.isFixed){item.start=item.element.offset().top;}else if(angular.isElement(item.placeholder)){item.start=item.placeholder.offset().top;}}});}
item={element:element,isFixed:element.hasClass('affix'),placeholder:attrs.useplaceholder!==undefined,placeholderClass:attrs.placeholderclass||'',start:element.offset().top,useBottomAnchor:attrs.bottomanchor!==undefined,bottomAnchor:angular.element(attrs.bottomanchor),scroll:function(winScrollTop){var diff;if(!this.isFixed&&winScrollTop>this.start){this.element.css('width',this.element.outerWidth()+'px');this.element.css('left',this.element.offset().left+'px');this.element.addClass('affix');this.isFixed=true;if(this.placeholder===true){this.placeholder=angular.element('<div class="affix-placeholder '+this.placeholderClass+'"></div>').css('height',item.element.outerHeight()+'px').insertBefore(item.element);}}else if(this.isFixed&&winScrollTop<=this.start){this.element.removeClass('affix');this.element.css('width','');this.element.css('left','');this.element.css('margin-top','');this.isFixed=false;if(angular.isElement(this.placeholder)){this.placeholder.remove();this.placeholder=true;}}
if(this.isFixed&&this.useBottomAnchor){diff=(this.bottomAnchor.offset().top)-(winScrollTop+this.element.outerHeight());if(diff<0){this.element.css('margin-top',diff+'px');}else{this.element.css('margin-top','');}}},resize:function(winScrollTop){this.element.removeClass('affix');this.element.css('width','');this.element.css('left','');this.isFixed=false;if(angular.isElement(this.placeholder)){this.placeholder.remove();this.placeholder=true;}
this.scroll(winScrollTop);}};scope.$watch(function(){return[element[0].clientWidth,element[0].clientHeight].join('x');},function(){item.resize(winElem.scrollTop());});scope._stickyElements.push(item);};});}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mbox',[function(){return{restrict:'E',scope:true,transclude:true,template:'<div id="{{campaign}}" ng-transclude></div>',link:function(scope,element,attrs){scope.otherAttrs={};scope.init=function(){if(!attrs.campaign||typeof attrs.campaign!=='string'){console.log('mbox attr "campaign" is required.');return false;}
scope.campaign=attrs.campaign;window.mboxDefine(scope.campaign,scope.campaign);angular.forEach(attrs,function(value,key){var closureFunction=function(){var theKey=key;return function(value){scope.update(false,value,theKey);};};if(key!=='campaign'&&key.charAt(0)!=='$'){scope.otherAttrs[key]=value;attrs.$observe(key,closureFunction());}});return true;};scope.update=function(isFirstTime,value,key){var updateArgs=[scope.campaign],theKey,hasEmptyValues=false,hasChanged=true;if(!isFirstTime){hasChanged=(value!==scope.otherAttrs[key]);scope.otherAttrs[key]=value;}
for(theKey in scope.otherAttrs){if(scope.otherAttrs.hasOwnProperty(theKey)){if(!scope.otherAttrs[theKey]){hasEmptyValues=true;break;}
if(scope.otherAttrs[theKey]!=='null'){updateArgs.push(theKey+'='+scope.otherAttrs[theKey]);}}}
if(!hasEmptyValues&&hasChanged){window.mboxUpdate.apply(this,updateArgs);}};if(scope.init()){scope.update(true);}}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('replaceWith',['$debounce','$compile',function($debounce,$compile){var triggerReady=$debounce(function(){angular.element(document).triggerHandler('replaceWith:ready');},20,false);return{restrict:'A',link:function(scope,element,attrs){var jsVar=null;if(attrs.replaceWith!==''){scope.$watch(function(){try{jsVar=eval(attrs.replaceWith);}catch(e){}
return jsVar;},function(newval){if(typeof newval==='string'){element.html($compile('<span>'+newval+'</span>')(scope));triggerReady();}});}
triggerReady();element.bind('refresh',function(){scope.$digest();});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('removeItem',[function(){return{restrict:'A',scope:{callbackFunction:'&removeCallback'},compile:function(tElement,tAttrs){var prependedElement,ngshow='';if(tAttrs.removeItem){ngshow='ng-show="'+tAttrs.removeItem+'"';}
prependedElement=tElement.prepend('<div class="remove-item-wrapper"><div class="remove-item" '+
ngshow+'></div></div>');return{post:function postLink(scope,element){var removeElement;removeElement=angular.element(element.find('.remove-item'));removeElement.on('click',function(){element.hide(function(){scope.callbackFunction({removeData:{}});});});}};}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('highlightChange',[function(){return{restrict:'A',scope:true,link:function(scope,element,attrs){scope.$watch(attrs.highlightChange,function(oldValue,newValue){if(newValue){element.stop(true,true).effect('highlight',{color:'#ffd900'},1500);}});}};}]);}());(function(){'use strict';var directiveFn,HINT_LIMIT=7,MEMBER_LIMIT=4,ARROW_INDEX=-1,KEYED_VALUE='',isOmnitureLoaded=false,DEFAULT_PLACEHOLDER_TEXT='Start searching...',REFINE_LOCAL_STORAGE_NAME='srpRefinementVisible';directiveFn=function($q,$window,$filter,$location,$timeout,redirect,hints,urlBuilder,facetStateService,omnitureService){return{restrict:'EA',templateUrl:'/static/js/angular/common/partials/_searchBar.html',scope:{placeHolder:'@',peekingOffset:'@',searchData:'='},controller:function($scope){$scope.getFileTypesFromLocalStorage=function(){var filetypes=[];if(localStorage.typesSelectedSRP){filetypes=angular.fromJson(localStorage.getItem('typesSelectedSRP'));}
if(typeof istock.hasSubscription!==undefined&&istock.hasSubscription===true){filetypes=['photos','illustrations'];}
if(filetypes instanceof Array){return filetypes.join(',');}
return filetypes;};$scope.toggleRefinePanel=function(){if($scope.searchData!==undefined){$scope.searchData.showRefinePanel=!($scope.searchData.showRefinePanel);omnitureService.toggleRefinePanel($scope.searchData.showRefinePanel);localStorage.setItem(REFINE_LOCAL_STORAGE_NAME,$scope.searchData.showRefinePanel);}};$scope.showBadge=function(){return facetStateService.hasActiveFacets(facetStateService.filterFacets);};},link:function($scope,element,attrs){var keyDownQuery='',defaultFileTypes=['photos','illustrations'];$scope.hintLimit=attrs.hintLimit||HINT_LIMIT;$scope.memberLimit=attrs.memberLimit||MEMBER_LIMIT;$scope.placeHolder=$scope.PlaceHolderText=$scope.placeHolder||DEFAULT_PLACEHOLDER_TEXT;$scope.placeHolderMobile=attrs.placeHolderMobile||DEFAULT_PLACEHOLDER_TEXT;$scope.source=attrs.source||null;$scope.fileTypes=attrs.fileTypes||$scope.getFileTypesFromLocalStorage()||defaultFileTypes;$scope.query='';$scope.hints=[];$scope.members=[];$scope.peeking=attrs.hasOwnProperty('peeking');$scope.input=element.find('input');if(JSON.parse(localStorage.getItem(REFINE_LOCAL_STORAGE_NAME))){$scope.toggleRefinePanel();}
$scope.setPlaceholder=function(){if(Breakpoints.isMatched({name:'LESSTHAN800_BREAKPOINT',el:jQuery('#content-root')[0]})){$scope.placeHolder=$scope.placeHolderMobile;}else{$scope.placeHolder=$scope.PlaceHolderText;}
if(($scope.searchData&&facetStateService.getFacet('text').length>0)||(facetStateService.getFacet('portfolioID')||facetStateService.getFacet('lightboxID'))){$scope.placeHolder='';}
return $scope.placeHolder;};$scope.initBreakpoints=function(){Breakpoints.on({name:'LESSTHAN800_BREAKPOINT',el:jQuery('#content-root')[0],matched:function(){$scope.setPlaceholder();$scope.$apply();}});Breakpoints.on({name:'GREATERTHAN800_BREAKPOINT',el:jQuery('#content-root')[0],matched:function(){$scope.setPlaceholder();$scope.$apply();}});if($scope.searchData){$scope.searchData.refinePanelMobile=false;Breakpoints.on({name:'MEDIUM_DOWN_BREAKPOINT',el:jQuery('.srp-container')[0],matched:function(){$scope.searchData.refinePanelMobile=true;$scope.searchData.smallViewOnly=true;angular.element('#refine-arrow-open').addClass('small-size');$scope.query=facetStateService.getFacet('text').join(' ');$scope.$apply();},exit:function(){$scope.searchData.refinePanelMobile=false;$scope.searchData.smallViewOnly=false;angular.element('#refine-arrow-open').removeClass('small-size');$scope.query='';$scope.$apply();}});}};$timeout($scope.initBreakpoints);$scope.triggerQuery=function(query){if(typeof query==='string'&&query.length<1){$scope.clearQuery();return undefined;}
$scope.input.addClass('loading');$scope.hints=[];$scope.members=[];hints.getHints(query).then(function(data){$scope.hints=data.hints;$scope.members=data.members;$scope.version=data.version;$scope.requestTime=data.requestTime;$scope.fromCache=data.cache;$scope.keyword=data.source;$scope.language=data.language;$scope.startTime=data.startTime;})
['finally'](function(){$scope.input.removeClass('loading');$scope.displayTime=Math.round((new Date()).getTime())-$scope.startTime;});};$scope.focus=function(query){if($scope.searchData){$scope.searchData.showKeywordTags=true;if(!Breakpoints.isMatched({name:'SMALL_BREAKPOINT'})&&!Breakpoints.isMatched({name:'MEDIUM_BREAKPOINT'})){if($scope.searchData.searchResponse.pendingKeywords){$scope.query='';}else{$scope.query=facetStateService.getFacet('text').join(' ');}
$scope.triggerQuery($scope.query);}}else{$scope.triggerQuery(query);}
element.find('.search-bar').addClass('focus');};$scope.blur=function(){if($scope.searchData){if(!Breakpoints.isMatched({name:'SMALL_BREAKPOINT'})&&!Breakpoints.isMatched({name:'MEDIUM_BREAKPOINT'})){$timeout(function(){$scope.query='';$scope.searchData.showKeywordTags=false;},0,false);}else{$timeout(function(){$scope.query=facetStateService.getFacet('text').join(' ');$scope.searchData.showKeywordTags=false;},0,false);}}
element.find('.search-bar').removeClass('focus');};$scope.keywordOnFocus=function(){return $scope.searchData.showKeywordTag;};$scope.clearQueryMobile=function(){if(facetStateService.getFacet('portfolioID')||facetStateService.getFacet('lightboxID')){facetStateService.setFacet('text',[]);}
$scope.query='';$timeout(function(){angular.element('#search-bar-input').focus();},0,false);};$scope.performSearch=function(hint){var alternateView=facetStateService.getFacet('portfolioID')||facetStateService.getFacet('lightboxID');if(typeof hint==='string'){hint=hint.replace(/['"\(\)\{\}\[\]]+/g,'');}
$scope.doTrigger(hint);if(hint.length===0&&!alternateView){return;}else if($scope.searchData&&$scope.searchData.searchResponse){$scope.query='';facetStateService.setFacet('pageNumber',1);facetStateService.clearFacetGroup('searchId');facetStateService.clearFacetGroup('similarity');facetStateService.clearFacetGroup('fileIdSet');if(typeof hint==='object'){$scope.searchData.singleView.clearSingleAlternateView();facetStateService.setFacet('portfolioID',hint.userId);$scope.searchData.singleView.setAlternateView('portfolio',{state:true,name:hint.string});facetStateService.activateAllOptions('abstractType');facetStateService.setFacet('additionalAudio','true');}
if(!$scope.searchData.searchResponse.pendingKeywords){$scope.searchData.searchResponse.pendingKeywords=[];}
if(!hint||typeof hint==='object'){facetStateService.setFacet('text',[]);$scope.searchData.searchResponse.keywordTerms=[];}else if(facetStateService.getFacet('text').join(' ')!==hint){$scope.searchData.searchResponse.pendingKeywords.push(hint);facetStateService.setFacet('text',[hint]);}else{$timeout(function(){angular.element('#search-bar-input').blur();},0,false);}
if(Breakpoints.isMatched({name:'SMALL_BREAKPOINT'})||Breakpoints.isMatched({name:'MEDIUM_BREAKPOINT'})){if(typeof hint!=='object'){$scope.query=hint;}}
$scope.clearQuery();}else{urlBuilder.build(hint,$scope.fileTypes,$scope.source).then(function(url){if(typeof hint==='string'){hint={userString:hint};}
$scope.query=hint.userString;$scope.clearQuery();localStorage.setItem('typesSelectedSRP',angular.toJson($scope.fileTypes));redirect.to(url);});}};$scope.hasHints=function(){var flag=false,queryLower=$scope.query.toLowerCase();if($scope.query.length&&(('hints'in $scope&&$scope.hints.length>0)||('members'in $scope&&$scope.members.length>0))){if((Breakpoints.isMatched({name:'SMALL_BREAKPOINT'})||Breakpoints.isMatched({name:'MEDIUM_BREAKPOINT'}))&&$scope.searchData&&!$scope.searchData.showKeywordTags){return flag;}
for(var i in $scope.hints){if($scope.hints.hasOwnProperty(i)){if($scope.hints[i].string.toLowerCase().indexOf(queryLower)>-1){flag=true;}}}
for(i in $scope.members){if($scope.members.hasOwnProperty(i)&&$scope.members[i].string.toLowerCase().indexOf(queryLower)>-1){flag=true;}}
return flag;}
return false;};$scope.clearQuery=function(){$window.setTimeout(function(){$scope.hints=[];$scope.members=[];$scope.input.removeClass('loading');$scope.$apply();},10);};$scope.getOmnitureString=function(item){var omnitureString,time=0,time1=0,time2=0,index=-1,isContributor=false;if($scope.hasHints()){omnitureString=$scope.version;}else{omnitureString=0;}
if($scope.fromCache){omnitureString+='|1|';}else{omnitureString+='|0|';}
if($scope.hasHints()){time=($scope.requestTime-($scope.requestTime%100))/100;time1=($scope.displayTime-($scope.displayTime%100))/100;var clickTime=Math.round((new Date()).getTime())-$scope.startTime;time2=(clickTime-(clickTime%100))/100;}
omnitureString+=time+'*'+time1+'*'+time2+'|';isContributor=item.hasOwnProperty('userId');if(isContributor){index=$scope.members.indexOf(item);omnitureString+=index+'|1|';}else{index=$scope.hints.indexOf(item);omnitureString+=index+'|0|';}
if($scope.hasHints()){omnitureString+=$scope.language+'|'+$scope.keyword;}else{omnitureString+='en_US|'+item;}
return omnitureString;};$scope.doTrigger=function(item){if(!isOmnitureLoaded){jQuery(document).on('omniture:trackingLoaded',function(){isOmnitureLoaded=true;jQuery(document).trigger('omniture:autoSuggest',$scope.getOmnitureString(item));});}else{jQuery(document).trigger('omniture:autoSuggest',$scope.getOmnitureString(item));}};$scope.keyDown=function(e,query){var KEY_BACKSPACE=8;if(e.keyCode&&e.keyCode===KEY_BACKSPACE){keyDownQuery=query;}};$scope.keyUp=function(e,query){var KEY_RETURN=13,KEY_UP=38,KEY_DOWN=40,LIS=element.find('.hints li'),MAX=LIS.length-1,thisLi,stripTags,alternateView;LIS.removeClass('active');switch(e.keyCode){case KEY_RETURN:alternateView=facetStateService.getFacet('portfolioID')||facetStateService.getFacet('lightboxID');if(ARROW_INDEX<0||alternateView){$scope.performSearch(query);}else{setTimeout(function(){LIS.eq(ARROW_INDEX).triggerHandler('click');},0);}
break;case KEY_UP:ARROW_INDEX--;if(ARROW_INDEX<-1){ARROW_INDEX=-1;}
break;case KEY_DOWN:ARROW_INDEX++;if(ARROW_INDEX>MAX){ARROW_INDEX=MAX;}
break;default:KEYED_VALUE=query;ARROW_INDEX=-1;}
if(e.keyCode===KEY_UP||e.keyCode===KEY_DOWN){if(ARROW_INDEX<0){$scope.input.val(KEYED_VALUE);}else{thisLi=LIS.eq(ARROW_INDEX);thisLi.addClass('active');stripTags=String(thisLi.html()).replace(/<[^>]+>/gm,'');$scope.input.val(stripTags);}}};if($window.addEventListener){$window.addEventListener('click',function(){$scope.clearQuery();});}
$scope.$watch('searchData.searchResponse',function(response){if(response){if((response.keywordTerms&&response.keywordTerms.length>0)||(response.pendingKeywords&&response.pendingKeywords.length>0)){$scope.placeHolder='';}else{$scope.placeHolder=$scope.PlaceHolderText;}}},true);$scope.$watch('query',$scope.triggerQuery);}};};angular.module('common.directives').directive('searchBar',['$q','$window','$filter','$location','$timeout','redirect','hints','urlBuilder','facetStateService','omnitureService',directiveFn]);jQuery(document).on('omniture:trackingLoaded',function(){isOmnitureLoaded=true;});}());(function(){'use strict';var module=angular.module('common.directives');module.directive('cmsWell',['$http','$location','$compile',function($http,$location,$compile){return{restrict:'E',scope:{passthru:'@',fallback:'&',callback:'&'},link:function(scope,element,attrs){if(scope.passthru){var url='/cms/angular?passthru='+scope.passthru;if($location.search().cmsDisable){url+='&cmsDisable';}
$http.get(url).success(function(data){if(data.length<=0){if(scope.callback){scope.callback({result:'callback'});}else{element.html(attrs.fallback);}}else{data=$compile(data.Content)(scope.$parent);element.html(data);if(scope.callback){scope.callback({result:'CMS'});}}}).error(function(){if(scope.callback){scope.callback({result:'callback'});}else{element.html(attrs.fallback);}});}else{if(scope.callback){scope.callback({result:'callback'});}else{element.html(attrs.fallback);}}}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('dotdotdot',function(){return function(scope,element){element.dotdotdot();};});}());(function(){'use strict';var m=angular.module('common.services');m.directive('script',function($injectedData){return{restrict:'E',compile:function(el,attrs){if(attrs.type!=='text/injected'){return;}
var data=angular.fromJson(el.text());if(attrs.hasOwnProperty('name')){$injectedData[attrs.name]=data;}else{angular.extend($injectedData,data);}}};});m.value('$injectedData',{});}());(function(){'use strict';var module=angular.module('common.directives');module.directive('iterateOver',['$compile',function($compile){return{restrict:'A',link:function(scope,element,attrs){var jsVar=null,iter=null;if(attrs.iterateOver!==''&&attrs.flexkey!==''){scope.$watch(function(){try{jsVar=eval(attrs.iterateOver);iter=eval(attrs.flexkey);}catch(e){}
if(Array.isArray(iter)&&iter.length>0){for(var i=0;i<iter.length;i++){if(iter[i].active){return jsVar[iter[i].sku];}}}
if(jsVar===null){return null;}
return jsVar['default'];},function(newval){if(typeof newval==='string'){element.html($compile('<span>'+newval+'</span>')(scope));}});}}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('dropboxIntroModal',['ipCookie','$timeout','$injectedData','omnitureService',function(ipCookie,$timeout,$injectedData,omnitureService){return{restrict:'E',link:function(scope){var cookieName='dropboxIntroModalHide',userClosed=false;scope.canBeSeen=false;scope.appLink=$injectedData.https+'account/apps';$timeout(function(){scope.setCanBeSeen();},100);scope.dontShowMe=function(){ipCookie(cookieName,true,{path:'/'});omnitureService.adpDropboxCtaClick('DontShowDropbox');scope.close();};scope.getStarted=function(){omnitureService.adpDropboxCtaClick('GetStartedDropbox');};scope.close=function(){userClosed=true;scope.canBeSeen=false;};scope.setCanBeSeen=function(){if(userClosed){scope.canBeSeen=!userClosed;}else{scope.canBeSeen=!ipCookie(cookieName);}};}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('lazySrc',['$window','$document','lazyImageService',function($window,$document,lazyImageService){function link($scope,element,attributes){var parentLi=element.closest('li'),image,target;if(attributes.lazyTag){target=attributes.lazyTag;}
image=lazyImageService.addImage(element,function(){parentLi.removeClass('loading');},target);attributes.$observe('lazySrc',function(src){if(src!==null){if(lazyImageService.enabled){parentLi.addClass('loading');}
lazyImageService.setSource(image,src);}});$scope.$on('$destroy',function(){lazyImageService.removeImage(image);});}
return{link:link,restrict:'A'};}]);}());(function(){'use strict';angular.module('common.filters',[]);})();(function(){'use strict';var search=angular.module('common.filters');search.filter('preserveObjectOrder',[function(){return function(input){var array=[],objectKey;if(!angular.isObject(input)){return input;}
for(objectKey in input){if(objectKey){array.push(input[objectKey]);}}
return array;};}]);}());(function(){'use strict';angular.module('common.services').factory('lightboxService',['$q','OptionsRestangular',function($q,OptionsRestangular){var LIGHTBOX_ENDPOINT='favorites',ASSETS_ENDPOINT='assets',SEARCH_ENDPOINT='search',defers={},self={lightboxes:null,searchedBoxes:null,defaultNameCount:0,incrementDefaultNameCount:function(){self.defaultNameCount++;return self.defaultNameCount;},getLightboxes:function(){var deferred=$q.defer();if(self.lightboxes===null){OptionsRestangular.getJavaRestConfig().one(LIGHTBOX_ENDPOINT).withHttpConfig({ignoreLoadingBar:true}).get().then(function(response){self.lightboxes=response.favorites;deferred.resolve(self.lightboxes);},function(response){deferred.reject(response);});}else{deferred.resolve(self.lightboxes);}
return deferred.promise;},searchLightboxes:function(assets,pageNumber,itemsPerPage,includeAll){var deferred=$q.defer(),data;if(includeAll&&self.searchedBoxes!==null){deferred.resolve(self.searchedBoxes);}else{data={pageNumber:pageNumber,itemsPerPage:itemsPerPage,includeAll:includeAll,assets:assets};OptionsRestangular.getJavaRestConfig().one(LIGHTBOX_ENDPOINT).one(SEARCH_ENDPOINT).withHttpConfig({ignoreLoadingBar:true}).customPOST(data).then(function(response){deferred.resolve(response);if(includeAll){self.searchedBoxes=response;}},function(response){deferred.reject(response);});}
return deferred.promise;},createLightbox:function(newName){var data={name:newName};if(!(newName in defers)){defers[newName]=$q.defer();self.getLightboxes().then(function(){OptionsRestangular.getJavaFullResponseConfig().one(LIGHTBOX_ENDPOINT).withHttpConfig({ignoreLoadingBar:true}).customPOST(data).then(function(response){var location=response.headers('Location'),lightboxId=parseInt(location.substr(location.lastIndexOf('/')+1));self.lightboxes.unshift({name:newName,id:lightboxId,assets:[]});defers[newName].resolve(lightboxId);},function(){defers[newName].reject();});}).catch(function(){defers[newName].reject();});}
return defers[newName].promise;},addToLightbox:function(lightboxId,gettyMasterId){var deferred=$q.defer();self.getLightboxes().then(function(){OptionsRestangular.getJavaRestConfig().one(LIGHTBOX_ENDPOINT,lightboxId).one(ASSETS_ENDPOINT,gettyMasterId).withHttpConfig({ignoreLoadingBar:true}).put().then(function(){for(var i=0;i<self.lightboxes.length;++i){if(self.lightboxes[i].id===lightboxId&&self.lightboxes[i].assets.indexOf(gettyMasterId)===-1){self.lightboxes[i].assets.push(gettyMasterId);self.lightboxes.unshift(self.lightboxes.splice(i,1)[0]);break;}}
deferred.resolve();},function(response){deferred.reject(response);});});return deferred.promise;},removeFromLightbox:function(lightboxId,gettyMasterId){var deferred=$q.defer();self.getLightboxes().then(function(){OptionsRestangular.getJavaRestConfig().one(LIGHTBOX_ENDPOINT,lightboxId).one(ASSETS_ENDPOINT,gettyMasterId).withHttpConfig({ignoreLoadingBar:true}).remove().then(function(){for(var i=0;i<self.lightboxes.length;++i){if(self.lightboxes[i].id===lightboxId&&self.lightboxes[i].assets.indexOf(gettyMasterId)!==-1){self.lightboxes[i].assets.splice(self.lightboxes[i].assets.indexOf(gettyMasterId),1);break;}}
deferred.resolve();},function(response){deferred.reject(response);});});return deferred.promise;}};return self;}]);}());(function(){'use strict';var MAX_LIGHTBOX_COUNT=3,module=angular.module('common.directives');module.directive('lightbox',['OMNITURE_EVENTS','ERROR_MESSAGING','LIGHTBOX_EVENTS','lightboxService','gettyMasterIdService','$animate','$timeout','$window','$filter','$location','$rootScope',function(OMNITURE_EVENTS,ERROR_MESSAGING,LIGHTBOX_EVENTS,lightboxService,gettyMasterIdService,$animate,$timeout,$window,$filter,$location,$rootScope){return{restrict:'E',scope:{assetType:'=',assetCollection:'=',assetId:'=',assetLicense:'=',assetIsEditorial:'=',appId:'=',user:'=',error:'='},templateUrl:'/static/js/angular/common/partials/lightbox/_lightboxButton.html',link:function(scope,element){scope.maxLightboxes=MAX_LIGHTBOX_COUNT;scope.lightboxCreated=false;scope.lighboxTooltip=$filter('i18n')('ADD_TO_LIGHTBOX');scope.lightboxPlaceholder='LIGHTBOX_PLACEHOLDER';scope.menuOpen=false;scope.hideExcessBoxes=false;scope.lightboxes=[];scope.gettyId='';scope.editing={newLightboxName:''};scope.toggleLightbox=function(index){var lightbox=scope.lightboxes[index],isEditorial=false,promise;if(lightbox.assets.indexOf(scope.gettyId)>=0){promise=lightboxService.removeFromLightbox(lightbox.id,scope.gettyId).then(function(){scope.error.showErrorMessage=false;lightbox.assets.splice(lightbox.assets.indexOf(scope.gettyId),1);lightbox.count--;$rootScope.$broadcast(LIGHTBOX_EVENTS.LB_REMOVED_EVENT,{assetId:scope.assetId});});}else{promise=lightboxService.addToLightbox(lightbox.id,scope.gettyId).then(function(){scope.error.showErrorMessage=false;lightbox.assets.push(scope.gettyId);lightbox.count++;isEditorial=scope.assetLicense==='Editorial'||scope.assetIsEditorial;scope.sendToOmniture(OMNITURE_EVENTS.LB_ADD,{assetType:scope.assetType,assetCollection:scope.assetCollection,assetId:scope.assetId,assetIsEditorial:isEditorial,appId:scope.appId,name:lightbox.name});});}
promise.catch(function(){scope.displayError();});};scope.displayMenu=function(){if(scope.user){if(!scope.menuOpen){scope.getGettyMasterId().then(function(){lightboxService.searchLightboxes([scope.gettyId],1,3,false).then(function(serviceBoxes){scope.lightboxes=angular.copy(serviceBoxes.favorites);scope.error.showErrorMessage=false;scope.hideExcessBoxes=false;if(serviceBoxes.totalResults>MAX_LIGHTBOX_COUNT){scope.hideExcessBoxes=true;}
scope.toggleMenuOpen(true);}).catch(function(){scope.displayError();});}).catch(function(){scope.displayError();});}else{scope.toggleMenuOpen(false);}}else{var redirectUrl=$window.btoa(encodeURIComponent($location.absUrl()));$window.location='/sign-in/'+redirectUrl;}};scope.addNewLightbox=function(){var lightboxName=scope.editing.newLightboxName,generatedName;if(lightboxName===''){generatedName=scope.generateLightboxName();lightboxName=$filter('i18n')('LIGHTBOX_EMPTY_NAME',generatedName);scope.editing.newLightboxName=lightboxName;}
scope.createLightboxReq(lightboxName).then(function(lightboxId){scope.lightboxAddReq(lightboxId,lightboxName).catch(function(){scope.displayError();});}).catch(function(){scope.displayError();});scope.toggleMenuOpen(false);scope.showLightboxCreated();};scope.createLightboxReq=function(lightboxName){return lightboxService.createLightbox(lightboxName).then(function(newId){scope.error.showErrorMessage=false;scope.sendToOmniture(OMNITURE_EVENTS.LB_CREATE,{assetId:scope.assetId,appId:scope.appId,name:lightboxName});return newId;});};scope.lightboxAddReq=function(lightboxId,lightboxName){return lightboxService.addToLightbox(lightboxId,scope.gettyId).then(function(){var isEditorial=false;if(scope.assetLicense==='Editorial'||scope.assetIsEditorial){isEditorial=true;}
scope.sendToOmniture(OMNITURE_EVENTS.LB_ADD,{assetCollection:scope.assetCollection,assetType:scope.assetType,assetId:scope.assetId,assetIsEditorial:isEditorial,appId:scope.appId,name:lightboxName});});};scope.generateLightboxName=function(){var date=new Date(),days=[date.getMonth()+1,date.getDate(),date.getFullYear()];return'('+days.join('/')+')-'+lightboxService.incrementDefaultNameCount();};scope.extendLightboxList=function(){scope.hideExcessBoxes=false;lightboxService.searchLightboxes([scope.gettyId],1,3,true).then(function(serviceBoxes){scope.lightboxes=angular.copy(serviceBoxes.favorites);scope.error.showErrorMessage=false;scope.maxLightboxes=serviceBoxes.totalResults;}).catch(function(){scope.displayError();});};scope.toggleMenuOpen=function(open){var isEditorial=false;if(open!==undefined){scope.menuOpen=open;}else{scope.menuOpen=!scope.menuOpen;}
if(scope.menuOpen){scope.setupModalOutClick();scope.editing.newLightboxName='';$rootScope.$broadcast(LIGHTBOX_EVENTS.LB_OPEN_EVENT,{assetId:scope.assetId});if(scope.assetLicense==='Editorial'||scope.assetIsEditorial){isEditorial=true;}
scope.sendToOmniture(OMNITURE_EVENTS.LB_TOGGLE,{assetId:scope.assetId,assetIsEditorial:isEditorial,assetType:scope.assetType,assetCollection:scope.assetCollection,appId:scope.appId});}else{scope.maxLightboxes=MAX_LIGHTBOX_COUNT;scope.hideExcessBoxes=false;scope.clearModalOutClick();}};scope.shouldDisplayOnRight=function(){var lightboxListEl=element.find('.lightbox-add-wrapper,.lightbox-create-wrapper'),lightboxBtn=element.find('.lightbox-btn'),lightboxOffsetLeft;lightboxOffsetLeft=lightboxBtn.offset().left-lightboxListEl.width();return(lightboxOffsetLeft<0);};scope.showLightboxCreated=function(){scope.lightboxCreated=true;$timeout(function(){scope.lightboxCreated=false;},2000);};scope.sendToOmniture=function(event,args){$rootScope.$broadcast(event,args);};scope.displayError=function(){scope.error.showErrorMessage=true;scope.error.errorMessage=ERROR_MESSAGING.LIGHTBOX_ERROR;};scope.setupModalOutClick=function(){$timeout(function(){$window.onclick=function(event){var targetEl=angular.element(event.target),lightboxListEl=angular.element('.lightbox-add-wrapper'),lightboxAddEl=angular.element('.lightbox-create-wrapper');if((!lightboxListEl.is(targetEl)&&lightboxListEl.has(targetEl).length===0)&&(!lightboxAddEl.is(targetEl)&&lightboxAddEl.has(targetEl).length===0)){if(scope.menuOpen){scope.toggleMenuOpen(false);}}};});};scope.clearModalOutClick=function(){$window.onclick=null;};scope.getGettyMasterId=function(){return gettyMasterIdService.getMasterId(scope.assetId).then(function(gettyObject){if(gettyObject){scope.gettyId=gettyObject.gettyMasterId;}});};$rootScope.$on(LIGHTBOX_EVENTS.LB_OPEN_EVENT,function(event,args){if(args.assetId!==scope.assetId){scope.menuOpen=false;}});}};}]);}());(function(){'use strict';var module=angular.module('common.directives'),DARK='#000000',LIGHT='#D1D1D1',DEFAULT='# HEX';module.directive('colorPicker',['colorService','$timeout',function(colorService,$timeout){return{restrict:'E',scope:{facetColor:'=',change:'&'},templateUrl:'/static/js/angular/common/partials/_colorPicker.html',controller:function($scope){$scope.placeholder=DEFAULT;$scope.input='';$scope.cursorMove={color:'',X:0,Y:0,showCursor:false};if($scope.facetColor&&$scope.facetColor!==''){$scope.input='#'+colorService.formatHexadecimalValue($scope.facetColor);}
this.setColorSelection=function(hex){$scope.facetColor=colorService.formatHexadecimalValue(hex);$scope.input=hex;$scope.$apply();$scope.change();};this.setCursor=function(color,X,Y){$scope.cursorMove.color=color;$scope.cursorMove.X=X;$scope.cursorMove.Y=Y;$scope.$apply();};this.showCursor=function(show){$scope.cursorMove.showCursor=show;$scope.$apply();};$scope.clearColor=function(){$timeout(function(){$scope.input='';$scope.facetColor='';$scope.cursorMove.showCursor=false;$scope.$apply();$scope.change();});};$scope.getTextColor=function(hex){if(colorService.isHexadecimalValue(hex)){return colorService.getMostVisibleColor(hex,LIGHT,DARK);}else{return LIGHT;}};$scope.getHexadecimalValue=function(){var hex='';if(colorService.isHexadecimalValue($scope.input)){if($scope.input.indexOf('#')===-1){hex='#';}
hex+=$scope.input;}
return hex;};$scope.inputChanged=function(){if(colorService.isHexadecimalValue($scope.input)){$timeout(function(){$scope.facetColor=colorService.formatHexadecimalValue($scope.input);$scope.$apply();$scope.change();$scope.cursorMove.showCursor=false;});}};$scope.inputSize=function(){var size=6;if($scope.input.indexOf('#')!==-1){size=7;}
return size;};}};}]);}());(function(){'use strict';var module=angular.module('common.directives'),RADIUS=67;module.directive('colorWheel',['$document','colorService',function($document,colorService){return{restrict:'A',require:'^colorPicker',link:function(scope,element,attrs,colorPickerCtrl){var ctx=element[0].getContext('2d'),img=new Image(),mousedown=false;img.src='/static/images/banshee/colorpicker/Color-Picker.png';img.onload=function(){ctx.drawImage(img,0,0);};element.on('mouseenter',function(){toggleMouseEvents(true);});element.on('mouseleave',function(){mousedown=false;toggleMouseEvents(false);});element.on('mousedown',function(event){var hex='',position=convertPosition(event);if(distance(position.X,position.Y)>RADIUS){return;}
mousedown=true;hex=getHexValue(position.X,position.Y);colorPickerCtrl.setCursor(hex,translateXCoordinate(position.X),translateYCoordinate(position.Y));colorPickerCtrl.showCursor(true);toggleMouseEvents(true);});function mousemove(event){var position=convertPosition(event),d=0,hex='';if(!mousedown){return;}
if(position.X<0){position.X=0;}
if(position.Y<0){position.Y=0;}
d=distance(position.X,position.Y);if(d>RADIUS){position.X=closestPointWithinWheel(d,position.X);position.Y=closestPointWithinWheel(d,position.Y);}
hex=getHexValue(position.X,position.Y);colorPickerCtrl.setCursor(hex,translateXCoordinate(position.X),translateYCoordinate(position.Y));}
function mouseup(event){if(mousedown){var position=convertPosition(event),hex=getHexValue(position.X,position.Y);mousedown=false;colorPickerCtrl.setColorSelection(hex);toggleMouseEvents(false);}}
function toggleMouseEvents(on){if(on){$document.on('mousemove',mousemove);$document.on('mouseup',mouseup);}else{$document.off('mousemove',mousemove);$document.off('mouseup',mouseup);}}
function convertPosition(event){var newPosition={X:event.offsetX,Y:event.offsetY};if(newPosition.X===undefined||newPosition.Y===undefined){newPosition.X=event.pageX-angular.element(event.target).offset().left;newPosition.Y=event.pageY-angular.element(event.target).offset().top;}
return newPosition;}
function getHexValue(x,y){var rgb=[],hex='';if(x<0||y<0){return'#000000';}
rgb=ctx.getImageData(x,y,1,1).data;hex=colorService.rgbToHex(rgb[0],rgb[1],rgb[2]);return hex;}
function distance(x,y){return Math.sqrt(Math.pow(RADIUS-x,2)+Math.pow(RADIUS-y,2));}
function closestPointWithinWheel(distance,p){var angle=Math.abs(RADIUS-p)/distance,newDistance=angle*(distance-RADIUS),newPoint=(p<RADIUS)?p+newDistance:p-newDistance;return newPoint;}
function translateXCoordinate(x){return x+(element.parent().outerWidth()-element.outerWidth())/2;}
function translateYCoordinate(y){return y+(element.parent().outerHeight()-element.outerHeight())/2;}}};}]);}());"use strict";var WaveSurfer={defaultParams:{height:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",cursorWidth:1,skipLength:2,minPxPerSec:20,pixelRatio:window.devicePixelRatio,fillParent:!0,scrollParent:!1,hideScrollbar:!1,normalize:!1,audioContext:null,container:null,dragSelection:!0,loopSelection:!0,audioRate:1,interact:!0,splitChannels:!1,renderer:"Canvas",backend:"WebAudio",mediaType:"audio"},init:function(a){if(this.params=WaveSurfer.util.extend({},this.defaultParams,a),this.container="string"==typeof a.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("Container element not found");if(this.mediaContainer="undefined"==typeof this.params.mediaContainer?this.container:"string"==typeof this.params.mediaContainer?document.querySelector(this.params.mediaContainer):this.params.mediaContainer,!this.mediaContainer)throw new Error("Media Container element not found");this.savedVolume=0,this.isMuted=!1,this.tmpEvents=[],this.createDrawer(),this.createBackend()},createDrawer:function(){var a=this;this.drawer=Object.create(WaveSurfer.Drawer[this.params.renderer]),this.drawer.init(this.container,this.params),this.drawer.on("redraw",function(){a.drawBuffer(),a.drawer.progress(a.backend.getPlayedPercents())}),this.drawer.on("click",function(b,c){setTimeout(function(){a.seekTo(c)},0)}),this.drawer.on("scroll",function(b){a.fireEvent("scroll",b)})},createBackend:function(){var a=this;this.backend&&this.backend.destroy(),"AudioElement"==this.params.backend&&(this.params.backend="MediaElement"),"WebAudio"!=this.params.backend||WaveSurfer.WebAudio.supportsWebAudio()||(this.params.backend="MediaElement"),this.backend=Object.create(WaveSurfer[this.params.backend]),this.backend.init(this.params),this.backend.on("finish",function(){a.fireEvent("finish")}),this.backend.on("audioprocess",function(b){a.fireEvent("audioprocess",b)})},restartAnimationLoop:function(){var a=this,b=window.requestAnimationFrame||window.webkitRequestAnimationFrame,c=function(){a.backend.isPaused()||(a.drawer.progress(a.backend.getPlayedPercents()),b(c))};c()},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(a,b){this.backend.play(a,b),this.restartAnimationLoop(),this.fireEvent("play")},pause:function(){this.backend.pause(),this.fireEvent("pause")},playPause:function(){this.backend.isPaused()?this.play():this.pause()},skipBackward:function(a){this.skip(-a||-this.params.skipLength)},skipForward:function(a){this.skip(a||this.params.skipLength)},skip:function(a){var b=this.getCurrentTime()||0,c=this.getDuration()||1;b=Math.max(0,Math.min(c,b+(a||0))),this.seekAndCenter(b/c)},seekAndCenter:function(a){this.seekTo(a),this.drawer.recenter(a)},seekTo:function(a){var b=this.backend.isPaused(),c=this.params.scrollParent;b&&(this.params.scrollParent=!1),this.backend.seekTo(a*this.getDuration()),this.drawer.progress(this.backend.getPlayedPercents()),b||(this.backend.pause(),this.backend.play()),this.params.scrollParent=c,this.fireEvent("seek",a)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(a){this.backend.setVolume(a)},setPlaybackRate:function(a){this.backend.setPlaybackRate(a)},toggleMute:function(){this.isMuted?(this.backend.setVolume(this.savedVolume),this.isMuted=!1):(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0)},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},drawBuffer:function(){var a=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),b=this.drawer.getWidth(),c=a;this.params.fillParent&&(!this.params.scrollParent||b>a)&&(c=b);var d=this.backend.getPeaks(c);this.drawer.drawPeaks(d,c),this.fireEvent("redraw",d,c)},loadArrayBuffer:function(a){this.decodeArrayBuffer(a,function(a){this.loadDecodedBuffer(a)}.bind(this))},loadDecodedBuffer:function(a){this.backend.load(a),this.drawBuffer(),this.fireEvent("ready")},loadBlob:function(a){var b=this,c=new FileReader;c.addEventListener("progress",function(a){b.onProgress(a)}),c.addEventListener("load",function(a){b.loadArrayBuffer(a.target.result)}),c.addEventListener("error",function(){b.fireEvent("error","Error reading file")}),c.readAsArrayBuffer(a),this.empty()},load:function(a,b){switch(this.params.backend){case"WebAudio":return this.loadBuffer(a);case"MediaElement":return this.loadMediaElement(a,b)}},loadBuffer:function(a){return this.empty(),this.getArrayBuffer(a,this.loadArrayBuffer.bind(this))},loadMediaElement:function(a,b){this.empty(),this.backend.load(a,this.mediaContainer,b),this.tmpEvents.push(this.backend.once("canplay",function(){this.drawBuffer(),this.fireEvent("ready")}.bind(this)),this.backend.once("error",function(a){this.fireEvent("error",a)}.bind(this))),!b&&this.backend.supportsWebAudio()&&this.getArrayBuffer(a,function(a){this.decodeArrayBuffer(a,function(a){this.backend.buffer=a,this.drawBuffer()}.bind(this))}.bind(this))},decodeArrayBuffer:function(a,b){this.backend.decodeArrayBuffer(a,this.fireEvent.bind(this,"decoded"),this.fireEvent.bind(this,"error","Error decoding audiobuffer")),this.tmpEvents.push(this.once("decoded",b))},getArrayBuffer:function(a,b){var c=this,d=WaveSurfer.util.ajax({url:a,responseType:"arraybuffer"});return this.tmpEvents.push(d.on("progress",function(a){c.onProgress(a)}),d.on("success",b),d.on("error",function(a){c.fireEvent("error","XHR error: "+a.target.statusText)})),d},onProgress:function(a){if(a.lengthComputable)var b=a.loaded/a.total;else b=a.loaded/(a.loaded+1e6);this.fireEvent("loading",Math.round(100*b),a.target)},exportPCM:function(a,b,c){a=a||1024,b=b||1e4,c=c||!1;var d=this.backend.getPeaks(a,b),e=[].map.call(d,function(a){return Math.round(a*b)/b}),f=JSON.stringify(e);return c||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(f)),f},clearTmpEvents:function(){this.tmpEvents.forEach(function(a){a.un()})},empty:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy"),this.clearTmpEvents(),this.unAll(),this.backend.destroy(),this.drawer.destroy()}};WaveSurfer.create=function(a){var b=Object.create(WaveSurfer);return b.init(a),b},WaveSurfer.util={extend:function(a){var b=Array.prototype.slice.call(arguments,1);return b.forEach(function(b){Object.keys(b).forEach(function(c){a[c]=b[c]})}),a},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},ajax:function(a){var b=Object.create(WaveSurfer.Observer),c=new XMLHttpRequest,d=!1;return c.open(a.method||"GET",a.url,!0),c.responseType=a.responseType||"json",c.addEventListener("progress",function(a){b.fireEvent("progress",a),a.lengthComputable&&a.loaded==a.total&&(d=!0)}),c.addEventListener("load",function(a){d||b.fireEvent("progress",a),b.fireEvent("load",a),200==c.status||206==c.status?b.fireEvent("success",c.response,a):b.fireEvent("error",a)}),c.addEventListener("error",function(a){b.fireEvent("error",a)}),c.send(),b.xhr=c,b}},WaveSurfer.Observer={on:function(a,b){this.handlers||(this.handlers={});var c=this.handlers[a];return c||(c=this.handlers[a]=[]),c.push(b),{name:a,callback:b,un:this.un.bind(this,a,b)}},un:function(a,b){if(this.handlers){var c=this.handlers[a];if(c)if(b)for(var d=c.length-1;d>=0;d--)c[d]==b&&c.splice(d,1);else c.length=0}},unAll:function(){this.handlers=null},once:function(a,b){var c=this,d=function(){b.apply(this,arguments),setTimeout(function(){c.un(a,d)},0)};return this.on(a,d)},fireEvent:function(a){if(this.handlers){var b=this.handlers[a],c=Array.prototype.slice.call(arguments,1);b&&b.forEach(function(a){a.apply(null,c)})}}},WaveSurfer.util.extend(WaveSurfer,WaveSurfer.Observer),WaveSurfer.WebAudio={scriptBufferSize:256,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return!(!window.AudioContext&&!window.webkitAudioContext)},getAudioContext:function(){return WaveSurfer.WebAudio.audioContext||(WaveSurfer.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),WaveSurfer.WebAudio.audioContext},getOfflineAudioContext:function(a){return WaveSurfer.WebAudio.offlineAudioContext||(WaveSurfer.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,a)),WaveSurfer.WebAudio.offlineAudioContext},init:function(a){this.params=a,this.ac=a.audioContext||this.getAudioContext(),this.lastPlay=this.ac.currentTime,this.startPosition=0,this.scheduledPause=null,this.states=[Object.create(WaveSurfer.WebAudio.state.playing),Object.create(WaveSurfer.WebAudio.state.paused),Object.create(WaveSurfer.WebAudio.state.finished)],this.setState(this.PAUSED_STATE),this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setPlaybackRate(this.params.audioRate)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(a){a&&a.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))},setState:function(a){this.state!==this.states[a]&&(this.state=this.states[a],this.state.init.call(this))},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(a){this.disconnectFilters(),a&&a.length&&(this.filters=a,this.analyser.disconnect(),a.reduce(function(a,b){return a.connect(b),b},this.analyser).connect(this.gainNode))},createScriptNode:function(){var a=this,b=this.scriptBufferSize;this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(b):this.ac.createJavaScriptNode(b),this.scriptNode.connect(this.ac.destination),this.scriptNode.onaudioprocess=function(){var b=a.getCurrentTime();a.buffer&&b>a.getDuration()?a.setState(a.FINISHED_STATE):a.buffer&&b>=a.scheduledPause?a.setState(a.PAUSED_STATE):a.state===a.states[a.PLAYING_STATE]&&a.fireEvent("audioprocess",b)}},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(a){this.gainNode.gain.value=a},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(a,b,c){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(a,function(a){b(a)}.bind(this),c)},getPeaks:function(a){for(var b=this.buffer.length/a,c=~~(b/10)||1,d=this.buffer.numberOfChannels,e=[],f=[],g=0;d>g;g++)for(var h=e[g]=[],i=this.buffer.getChannelData(g),j=0;a>j;j++){for(var k=~~(j*b),l=~~(k+b),m=0,n=k;l>n;n+=c){var o=i[n];o>m?m=o:-o>m&&(m=-o)}h[j]=m,(0==g||m>f[j])&&(f[j]=m)}return this.params.splitChannels?e:f},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){this.source&&this.source.disconnect()},destroy:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect()},load:function(a){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=a,this.createSource()},createSource:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){return this.buffer?this.buffer.duration:0},seekTo:function(a,b){return this.scheduledPause=null,null==a&&(a=this.getCurrentTime(),a>=this.getDuration()&&(a=0)),null==b&&(b=this.getDuration()),this.startPosition=a,this.lastPlay=this.ac.currentTime,this.state===this.states[this.FINISHED_STATE]&&this.setState(this.PAUSED_STATE),{start:a,end:b}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(a,b){this.createSource();var c=this.seekTo(a,b);a=c.start,b=c.end,this.scheduledPause=b,this.source.start(0,a,b-a),this.setState(this.PLAYING_STATE)},pause:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(this.PAUSED_STATE)},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},setPlaybackRate:function(a){a=a||1,this.isPaused()?this.playbackRate=a:(this.pause(),this.playbackRate=a,this.play())}},WaveSurfer.WebAudio.state={},WaveSurfer.WebAudio.state.playing={init:function(){},getPlayedPercents:function(){var a=this.getDuration();return this.getCurrentTime()/a||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}},WaveSurfer.WebAudio.state.paused={init:function(){},getPlayedPercents:function(){var a=this.getDuration();return this.getCurrentTime()/a||0},getCurrentTime:function(){return this.startPosition}},WaveSurfer.WebAudio.state.finished={init:function(){this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}},WaveSurfer.util.extend(WaveSurfer.WebAudio,WaveSurfer.Observer),WaveSurfer.MediaElement=Object.create(WaveSurfer.WebAudio),WaveSurfer.util.extend(WaveSurfer.MediaElement,{init:function(a){this.params=a,this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}},this.mediaType=a.mediaType.toLowerCase(),this.elementPosition=a.elementPosition},load:function(a,b,c){var d=this,e=document.createElement(this.mediaType);e.controls=!1,e.autoplay=!1,e.preload="auto",e.src=a,e.addEventListener("error",function(){d.fireEvent("error","Error loading media element")}),e.addEventListener("canplay",function(){d.fireEvent("canplay")}),e.addEventListener("ended",function(){d.fireEvent("finish")}),e.addEventListener("timeupdate",function(){d.fireEvent("audioprocess",d.getCurrentTime())});var f=b.querySelector(this.mediaType);f&&b.removeChild(f),b.appendChild(e),this.media=e,this.peaks=c,this.onPlayEnd=null,this.buffer=null,this.setPlaybackRate(this.playbackRate)},isPaused:function(){return this.media.paused},getDuration:function(){var a=this.media.duration;return a>=1/0&&(a=this.media.seekable.end()),a},getCurrentTime:function(){return this.media.currentTime},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},setPlaybackRate:function(a){this.playbackRate=a||1,this.media.playbackRate=this.playbackRate},seekTo:function(a){null!=a&&(this.media.currentTime=a),this.clearPlayEnd()},play:function(a,b){this.seekTo(a),this.media.play(),b&&this.setPlayEnd(b)},pause:function(){this.media.pause(),this.clearPlayEnd()},setPlayEnd:function(a){var b=this;this.onPlayEnd=function(c){c>=a&&(b.pause(),b.seekTo(a))},this.on("audioprocess",this.onPlayEnd)},clearPlayEnd:function(){this.onPlayEnd&&(this.un("audioprocess",this.onPlayEnd),this.onPlayEnd=null)},getPeaks:function(a){return this.buffer?WaveSurfer.WebAudio.getPeaks.call(this,a):this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(a){this.media.volume=a},destroy:function(){this.pause(),this.unAll(),this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}),WaveSurfer.AudioElement=WaveSurfer.MediaElement,WaveSurfer.Drawer={init:function(a,b){this.container=a,this.params=b,this.width=0,this.height=b.height*this.params.pixelRatio,this.lastPos=0,this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()},handleEvent:function(a){a.preventDefault();var b=this.wrapper.getBoundingClientRect();return(a.clientX-b.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0},setupWrapperEvents:function(){var a=this;this.wrapper.addEventListener("click",function(b){var c=a.wrapper.offsetHeight-a.wrapper.clientHeight;if(0!=c){var d=a.wrapper.getBoundingClientRect();if(b.clientY>=d.bottom-c)return}a.params.interact&&a.fireEvent("click",b,a.handleEvent(b))}),this.wrapper.addEventListener("scroll",function(b){a.fireEvent("scroll",b)})},drawPeaks:function(a,b){this.resetScroll(),this.setWidth(b),this.drawWave(a)},style:function(a,b){return Object.keys(b).forEach(function(c){a.style[c]!=b[c]&&(a.style[c]=b[c])}),a},resetScroll:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)},recenter:function(a){var b=this.wrapper.scrollWidth*a;this.recenterOnPosition(b,!0)},recenterOnPosition:function(a,b){var c=this.wrapper.scrollLeft,d=~~(this.wrapper.clientWidth/2),e=a-d,f=e-c,g=this.wrapper.scrollWidth-this.wrapper.clientWidth;if(0!=g){if(!b&&f>=-d&&d>f){var h=5;f=Math.max(-h,Math.min(h,f)),e=c+f}e=Math.max(0,Math.min(g,e)),e!=c&&(this.wrapper.scrollLeft=e)}},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(a){a!=this.width&&(this.width=a,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize())},setHeight:function(a){a!=this.height&&(this.height=a,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize())},progress:function(a){var b=1/this.params.pixelRatio,c=Math.round(a*this.width)*b;if(c<this.lastPos||c-this.lastPos>=b){if(this.lastPos=c,this.params.scrollParent){var d=~~(this.wrapper.scrollWidth*a);this.recenterOnPosition(d)}this.updateProgress(a)}},destroy:function(){this.unAll(),this.wrapper&&(this.container.removeChild(this.wrapper),this.wrapper=null)},createElements:function(){},updateSize:function(){},drawWave:function(){},clearWave:function(){},updateProgress:function(){}},WaveSurfer.util.extend(WaveSurfer.Drawer,WaveSurfer.Observer),WaveSurfer.Drawer.Canvas=Object.create(WaveSurfer.Drawer),WaveSurfer.util.extend(WaveSurfer.Drawer.Canvas,{createElements:function(){var a=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,top:0,bottom:0}));if(this.waveCc=a.getContext("2d"),this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.params.waveColor!=this.params.progressColor){var b=this.progressWave.appendChild(document.createElement("canvas"));this.progressCc=b.getContext("2d")}},updateSize:function(){var a=Math.round(this.width/this.params.pixelRatio);this.waveCc.canvas.width=this.width,this.waveCc.canvas.height=this.height,this.style(this.waveCc.canvas,{width:a+"px"}),this.style(this.progressWave,{display:"block"}),this.progressCc&&(this.progressCc.canvas.width=this.width,this.progressCc.canvas.height=this.height,this.style(this.progressCc.canvas,{width:a+"px"})),this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc&&this.progressCc.clearRect(0,0,this.width,this.height)},drawWave:function(a,b){if(a[0]instanceof Array){var c=a;if(this.params.splitChannels)return this.setHeight(c.length*this.params.height*this.params.pixelRatio),void c.forEach(this.drawWave,this);a=c[0]}var d=.5/this.params.pixelRatio,e=this.params.height*this.params.pixelRatio,f=e*b||0,g=e/2,h=a.length,i=1;this.params.fillParent&&this.width!=h&&(i=this.width/h);var j=1;this.params.normalize&&(j=Math.max.apply(Math,a)),this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(b){if(b){b.beginPath(),b.moveTo(d,g+f);for(var c=0;h>c;c++){var e=Math.round(a[c]/j*g);b.lineTo(c*i+d,g+e+f)}b.lineTo(this.width+d,g+f),b.moveTo(d,g+f);for(var c=0;h>c;c++){var e=Math.round(a[c]/j*g);b.lineTo(c*i+d,g-e+f)}b.lineTo(this.width+d,g+f),b.closePath(),b.fill(),b.fillRect(0,g+f-d,this.width,d)}},this)},updateProgress:function(a){var b=Math.round(this.width*a)/this.params.pixelRatio;this.style(this.progressWave,{width:b+"px"})}});(function(){'use strict';var APP='default';angular.module(APP,['ngSanitize','isLocalization','common.services','common.directives','common.constants']);}());