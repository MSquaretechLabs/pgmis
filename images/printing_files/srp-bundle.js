
(function(){'use strict';angular.module('search.controllers',[]);})();(function(){'use strict';angular.module('search.services',[]);})();(function(){'use strict';angular.module('search.services').factory('searchRequestService',['SEARCH','Restangular','resultsCacheService','$q','$injectedData',function(SEARCH,Restangular,resultsCache,$q,$injectedData){var lastTimestamp;function executeSearch(facets,options){var requestObj={},deferred=$q.defer(),cachedResults=null,doPrefetch=options.doPrefetch||false,cachedTime,maxCacheTime;cachedResults=resultsCache.get(facets);cachedTime=cachedResults&&cachedResults.timestamp||Date.now();maxCacheTime=cachedTime+SEARCH.MAX_RESULTS_CACHE_TIME;requestObj.facets=facets;lastTimestamp=requestObj.timestamp=Date.now();if(options&&options.searchToken){requestObj.searchToken=options.searchToken;}
if(cachedResults&&Date.now()<maxCacheTime){lastTimestamp=Date.now();cachedResults.isLatest=true;cachedResults.timestamp=lastTimestamp;deferred.resolve(cachedResults);}else{Restangular.one('search').withHttpConfig({ignoreLoadingBar:doPrefetch}).customPOST(requestObj).then(function(response){response.isLatest=lastTimestamp===response.timestamp;if('results'in response&&response.results.length>0){resultsCache.put(facets,response);}
deferred.resolve(response);});}
return deferred.promise;}
function executeSearchNextPage(facets,options){facets.pageNumber=facets.pageNumber||1;facets.pageNumber++;options.doPrefetch=true;executeSearch(facets,options);}
function loadLocalResults(facets){var response=$injectedData.initialResults;response.isLatest=true;if('results'in response&&response.results.length>0){resultsCache.put(facets,response);}
return response;}
return{executeSearch:executeSearch,executeSearchNextPage:executeSearchNextPage,loadLocalResults:loadLocalResults};}]);}());(function(){'use strict';angular.module('search.services').factory('whatIfsService',[function(){var self={whatIfs:{},setWhatIfs:function(whatIfsObject){self.whatIfs=whatIfsObject;},getWhatIfs:function(){return self.whatIfs;},facetHasZeroCountWhatIf:function(facetName,value){if(self.whatIfs&&self.whatIfs[facetName]&&self.whatIfs[facetName][value]){if(self.whatIfs[facetName][value].count===0){return true;}}
return false;}};return self;}]);}());(function(){'use strict';angular.module('search.services').factory('resultsService',[function(){var self={searchResponse:'',setSearchResponse:function(response){self.searchResponse=response;},getResults:function(){return self.searchResponse.results;},getTotalResults:function(){return self.searchResponse.totalResults;}};return self;}]);}());(function(){'use strict';angular.module('search.services').factory('alternateViewService',[function(){var self={alternateView:{defaultView:true,audio:false,singleViews:{lightbox:{state:false,name:''},portfolio:{state:false,name:''}},admin:false,zeroResults:false},setAlternateView:function(view,value){if(typeof value==='object'){self.alternateView.singleViews[view].state=value.state;self.alternateView.singleViews[view].name=value.name;}else{self.alternateView[view]=value;}},getAlternateView:function(){return self.alternateView;},clearSingleAlternateView:function(){angular.forEach(self.alternateView.singleViews,function(value,key){self.alternateView.singleViews[key].state=false;self.alternateView.singleViews[key].name='';});}};return self;}]);}());(function(){'use strict';angular.module('search.services').factory('srpOmnitureService',['omnitureService','facetService','$window',function(omnitureService,facetService,$window){var self={orderMapping:{bestMatch:'Best Match',new:'Age',allTimePopular:'Downloads|All time',monthPopular:'Downloads|This month',yearPopular:'Downloads|This year'},showPeopleMapping:{true:'People',false:'No people','other':'Other'},exclusiveContributorMapping:{true:'Only from iStock'},editorialMapping:{true:'editorial',false:'creative'},dateMapping:{oneDay:'Past 24 hours',oneWeek:'Past week',oneMonth:'Past month',threeMonths:'Past 3 months',sixMonths:'Past 6 months',allTimes:'All times'},firstSearch:true,srpCommonOmniture:function(args){var name='iStock|Search|',date=new Date(),color='Colour',tempArray,tempObj;args.abstractType=self.mapFacetGroup('abstractType',args.abstractType,false,true);if(args.alternateViews.lightbox.state){s.pageName=s.eVar5='iStock|MyAccount|LightboxDetail';}else if(args.alternateViews.portfolio.state){s.pageName=s.eVar5='iStock|Search|Portfolio';}else if(args.totalResults>0){tempArray=[];angular.forEach(args.abstractType,function(value){var uppercaseValue=value.charAt(0).toUpperCase()+value.slice(1);if(uppercaseValue==='Photos'||uppercaseValue==='Illustrations'){uppercaseValue=uppercaseValue.slice(0,-1);}
tempArray.push(uppercaseValue);});s.pageName=s.eVar5=name+tempArray.join('-')+'Results';}else{s.pageName=s.eVar5=name+'ZeroResults';}
s.channel=s.prop1=s.eVar1=s.prop2=s.eVar2='Search';s.server=s.eVar6=$window.location.host;s.prop3=args.keywordLanguage;if(args.userID){s.prop4=s.eVar4=args.userID;}else{s.prop4=s.eVar4='Visitor';}
angular.forEach(args.keyword,function(value,key){if(value==='and'||value==='or'||value==='not'){value=value.toUpperCase();}
args.keyword[key]=value;});if(args.lightboxName){s.prop10=s.eVar10=args.lightboxName;}
s.prop11=s.eVar11=args.keyword.join('|');if(args.alternateViews.portfolio.state){s.prop12=s.eVar12='memberID';}else if(self.checkCookie(s.categoryCookieName)){s.prop12=s.eVar12='category';self.deleteCookie(s.categoryCookieName);}else if(self.checkCookie(s.keywordCookieName)){s.prop12=s.eVar12='keywordlink';self.deleteCookie(s.keywordCookieName);}else{s.prop12=s.eVar12='keyword';}
s.prop13=args.totalResults.toString();if(args.pageNumber){s.prop14=s.eVar14=args.pageNumber.toString();}
s.prop15=s.eVar15=self.orderMapping[args.sortOrder];s.prop16=s.eVar16=args.abstractType.join('|');s.prop18=s.getPercentPageViewed();args.compositionFilter=self.mapFacetGroup('orientation',args.compositionFilter);if(args.colorFilter){args.compositionFilter.unshift(color);}
s.prop31=s.eVar31=args.compositionFilter.join('|');s.prop32=s.eVar32=args.colorFilter;s.prop33=s.eVar33=(self.mapFacetGroup('videoSize',args.videoSize)).concat(args.aspectRatioVideo).join('|');s.prop34=s.eVar34=(self.mapFacetGroup('tempo',args.tempo)).concat(self.mapFacetGroup('audioKey',args.audioKey)).concat(self.mapFacetGroup('audioPrice',args.audioPrice)).join('|');if(args.filterOnSub||args.collectionPrice[0]==='essentials'){s.prop35=s.eVar35='C-Essentials';}else if(args.collectionPrice[0]==='signature'){s.prop35=s.eVar35='C-Signature';}else{s.prop35=s.eVar35=null;}
tempArray=[];if(args.showPeople.length>0){tempArray=tempArray.concat(self.mapFacetGroup(self.showPeopleMapping,args.showPeople,true));}
if(args.exclusiveContributor.length>0){tempArray=tempArray.concat(self.mapFacetGroup(self.exclusiveContributorMapping,args.exclusiveContributor,true));}
if(args.date.length>0){tempArray=tempArray.concat(self.mapFacetGroup(self.dateMapping,args.date,true));}
s.prop36=s.eVar36=tempArray.join('|');s.prop38=self.compileTaxonomyData(args.results);s.eVar38=[date.getFullYear(),(date.getMonth()+1),date.getDate()].join('');s.prop39=s.eVar39=args.searchSegment;s.prop43=s.eVar43=self.mapFacetGroup(self.editorialMapping,args.editorial,true).join();tempObj=self.getNumberRowsAndColumns();s.prop44=s.eVar44=tempObj.numPerRows+':'+tempObj.numPerColumns;s.prop45=args.keywordRelevance;if(args.resultsPerPage){s.prop53=s.eVar53=args.resultsPerPage.toString();}
s.prop60=args.curatedSearch;s.prop75='pre:'+args.metrics.preSearch+'|'+'lust:'+args.metrics.lustTime+'|'+'post:'+args.metrics.postSearch+'|'+'trans:'+window.timestamps.translations+'|'+'totphp:'+args.metrics.total;if(self.firstSearch){s.events='event2,event14';self.firstSearch=false;}else{s.events='';}},srpPageLoad:function(data){self.srpCommonOmniture(data);s.prop65=s.eVar65='SRP_2015_New';omnitureService.srpPageLoad();},checkCookie:function(name){var cookieValue=self.getCookie(name);return(cookieValue!=='');},getCookie:function(name){var cookieName=name+'=',cookieList=document.cookie.split(';'),i=0,cookie='';for(i=0;i<cookieList.length;i++){cookie=cookieList[i];while(cookie.charAt(0)===' '){cookie=cookie.substring(1);}
if(cookie.indexOf(cookieName)===0){return cookie.substring(cookieName.length,cookie.length);}}
return'';},deleteCookie:function(name){document.cookie=name+'=; expires=Thu, 01 Jan 1970 00:00:00 UTC ;domain=.istockphoto.com;path=/';},getNumberRowsAndColumns:function(){var result={numPerRows:0,numPerColumns:0},resultset=jQuery('.search-list ul li');if(resultset.length>0){result.numPerRows=Math.round(jQuery('.search-results').outerWidth()/resultset.first().outerWidth());if(result.numPerRows>0){result.numPerColumns=Math.ceil(resultset.length/result.numPerRows);}}
return result;},facetChanged:function(data,name,value){var map={order:{bestMatch:'SRP-SortBestMatch',new:'SRP-SortFileAge',yearPopular:'SRP-SortPopularThisYear',monthPopular:'SRP-SortPopularThisMonth',allTimePopular:'SRP-SortPopularAllTime'},collectionPrice:{essentials:'SRP-CollectionsEssentials',signature:'SRP-CollectionsSignature',variables:'prop35,eVar35'},exclusiveContributor:{true:'SRP-SelectionsiStock',variables:'prop36,eVar36'},editorial:{false:'SRP-LicenseCreative',true:'SRP-LicenseEditorial',variables:'prop43,eVar43'},showPeople:{true:'SRP-People',false:'SRP-NoPeople','other':'SRP-PeopleOther',variables:'prop36,eVar36'},orientation:{horizontal:'SRP-OrientationHoriz',vertical:'SRP-OrientationVert',square:'SRP-OrientationSquare',variables:'prop31,eVar31'},color:{title:'SRP-HexFilter',variables:'prop32,eVar32'},tempo:{title:'SRP-SelectTempo',variables:'prop34,eVar34'},audioKey:{title:'SRP-SelectKey',variables:'prop34,eVar34'},audioPrice:{title:'SRP-SelectComplexity',variables:'prop34,eVar34'},aspectRatioVideo:{title:'SRP-SelectAspectRatio',variables:'prop33,eVar33'},videoSize:{title:'SRP-SelectResolution',variables:'prop33,eVar33'},date:{title:'SRP-SelectDate',variables:'prop36,eVar36'},fileType:{title:'SRP-FileType'},nextPage:{title:'SRP-NextPage'},prevPage:{title:'SRP-PrevPage'},essentialSubsToggle:{title:'SRP-ToggleEssentials',variables:'prop35,eVar35'},removeAdultContent:{title:'SRP-ShowAdultContent'},excludeEditorial:{title:'SRP-AlwaysExclEditorial',variables:'prop43,eVar43'},resultsPerPage:{title:'SRP-ToggleFilesPerPage'}},title='',newLinkTrackVars='';if(name==='fileType'&&value){map.fileType.title+=value.charAt(0).toUpperCase()+value.substr(1).toLowerCase();}
self.srpCommonOmniture(data);omnitureService.commonPageLoad();if(map[name]){if(map[name].title){title=map[name].title;}else if(map[name][value]){title=map[name][value];}
if(map[name].variables){newLinkTrackVars=map[name].variables;}}
if(title!==''){s.linkTrackVars+=','+newLinkTrackVars+','+omnitureService.srpSearchDetails;s.tl(true,'o',title);}},showFileDetailsDisplaySettingChanged:function(change){var map={showDetails:{title:'SRP-ShowFileDetails'}};if(map[change]){if(map[change].variables){s.linkTrakVars+=map[change].variables+','+omnitureService.srpSearchDetails;}
s.tl(true,'o',map[change].title);}},oldSrpToggle:function(){s.linkTrackEvents='event47';s.events='event47';s.tl(true,'o','ToggleOldSRP');},mapFacetGroup:function(facetGroupName,facetGroupValues,internalMapping,doNotTranslate){if(!facetGroupValues){return;}
angular.forEach(facetGroupValues,function(value,key){if(internalMapping){facetGroupValues[key]=facetGroupName[value];}else{if(doNotTranslate){facetGroupValues[key]=facetService.getConfig()[facetGroupName].facets[facetGroupValues[key]].value;}else{facetGroupValues[key]=facetService.getConfig()[facetGroupName].facets[facetGroupValues[key]].display;}}});return facetGroupValues;},compileTaxonomyData:function(results){var data={1:{value:0,essentials:0,signature:0,'signature+':0},7:{value:0,essentials:0,signature:0,'signature+':0},8:{value:0,essentials:0,signature:0,'signature+':0},9:{value:0,essentials:0,signature:0,'signature+':0}},fileTypeArray=[],collectionArray=[];angular.forEach(results,function(asset){data[asset.abstractType.id][asset.collection]++;});angular.forEach(data,function(fileType){collectionArray=[];angular.forEach(fileType,function(collection){collectionArray.push(collection);});fileTypeArray.push(collectionArray.join('|'));});return fileTypeArray.join(';');}};return self;}]);}());(function(){'use strict';angular.module('search.services').factory('metadataService',['$filter','$location','ABSTRACT_TYPE','siteLang',function($filter,$location,ABSTRACT_TYPE,siteLang){var _setMetadata,_setOpenGraphData,_setSeoMetadata,_setTwitterMetaData,_getSeoLinkUrls,_getTotalPages;_setMetadata=function(response){_setOpenGraphData(response);_setSeoMetadata(response);_setTwitterMetaData(response);};_setOpenGraphData=function(response){var jsHead=angular.element('html head'),title=angular.element('title')[0].text.split(' - iStock')[0],description=angular.element('meta[name=description]')[0].content,firstResult,firstResultAssets,output='';jsHead.find('meta[property*="og"]').remove();if(response.results!==undefined){firstResult=response.results[0];}
output+='<meta property="og:url" content="'+$location.absUrl().split('?')[0]+'" />';output+='<meta property="og:site_name" content="iStockphoto" />';output+='<meta property="og:title" content="'+title+'" />';output+='<meta property="og:description" content="'+description+'" />';if(firstResult!==undefined&&firstResult.abstractType!==ABSTRACT_TYPE.audio){firstResultAssets=firstResult.assets.retinaThumb;output+='<meta property="og:image" content="'+firstResultAssets.url+'" />';output+='<meta property="og:image:type" content="image/jpeg" />';if(firstResultAssets.dimensions){output+='<meta property="og:image:width" content="'+firstResultAssets.dimensions.width+'" />';output+='<meta property="og:image:height" content="'+firstResultAssets.dimensions.height+'" />';}}
output+='<meta property="og:type" content="article" />';output+='<meta property="article:publisher" content="https://www.facebook.com/istock" />';jsHead.append(output);};_setSeoMetadata=function(response){var jsHead=angular.element('html head'),currentPage=response.page||0,totalPages=_getTotalPages(response),urls=_getSeoLinkUrls(currentPage,totalPages),output='';jsHead.find('meta[name*="robots"]').remove();jsHead.find('link[rel="next"], link[rel="prev"]').remove();if(response.totalResults<10){output+='<meta name="robots" content="noindex,follow">';}
if(currentPage<totalPages){output+=['<link href="',urls.next,'" rel="next">'].join('');}
if(currentPage>1){output+=['<link href="',urls.prev,'" rel="prev">'].join('');}
jsHead.append(output);};_setTwitterMetaData=function(response){var jsHead=angular.element('html head'),output='',keyword='',title,description,thumbSize='thumb_190';jsHead.find('meta[name*="twitter"]').remove();if(response.keywordTerms&&response.keywordTerms.length){keyword=response.keywordTerms[0];keyword=keyword.charAt(0).toUpperCase()+keyword.slice(1);}
title=$filter('i18n')('META_TWITTER_TITLE',keyword);description=$filter('i18n')('META_TWITTER_DESCRIPTION',keyword);output+='<meta name="twitter:site" content="@istock" />';output+='<meta name="twitter:card" content="gallery" />';output+='<meta name="twitter:title" content="'+title+'">';output+='<meta name="twitter:description" content="'+description+'" />';angular.forEach(response.results,function(result,index){output+='<meta name="twitter:image'+index+'" content="'+result.assets[thumbSize]+'" />';});jsHead.append(output);};_getSeoLinkUrls=function(currentPage,totalPages){var baseUrl=$location.absUrl().split('/'),domain=baseUrl[0]+'//'+baseUrl[2],keyword='',keywordList=[],fileType,params,urls={next:'',prev:''};if(baseUrl.length>=5){keywordList=baseUrl[4].split('?');if(keywordList.length){keyword=keywordList[0];}}
if(siteLang==='EN'){fileType=baseUrl[3];}else{fileType='royalty-free';}
if(currentPage<totalPages){params='?page='+(currentPage+1);urls.next=[domain,'/',fileType,'/',keyword,params].join('');}
if(currentPage>1){if(currentPage!==2){params='?page='+(currentPage-1);}else{params='';}
urls.prev=[domain,'/',fileType,'/',keyword,params].join('');}
return urls;};_getTotalPages=function(response){var perPage=response.lookAhead,totalResults=response.totalResults,totalPages=0;if(perPage){totalPages=Math.ceil(totalResults/perPage);}
return totalPages;};return{setOpenGraphData:_setOpenGraphData,setMetadata:_setMetadata,setSeoMetadata:_setSeoMetadata,setTwitterMetaData:_setTwitterMetaData,getSeoLinkUrls:_getSeoLinkUrls,getTotalPages:_getTotalPages};}]);}());(function(){'use strict';angular.module('search.services').factory('resultsCacheService',['SEARCH','locker','flattenService','hashService',function(SEARCH,locker,flattenService,hashService){var getHash,put,get,_getOldestKey;get=function(facetStack){var key=getHash(facetStack);return locker.get(key);};put=function(facetStack,value){var key=getHash(facetStack),keySet=locker.namespace('srp').all(),oldestKey=_getOldestKey(keySet);if(locker.namespace('srp').count()>=SEARCH.MAX_CACHED_RESULT_COUNT){locker.forget(oldestKey);}
try{locker.put(key,value);}catch(err){locker.forget(oldestKey);locker.put(key,value);}};getHash=function(stack){var flattened,key,arr=[];flattened=flattenService.flatten(stack);for(key in flattened){if(flattened.hasOwnProperty(key)){arr.push([key,flattened[key]]);}}
arr.sort(function(a,b){var x=a[0].toLowerCase(),y=b[0].toLowerCase();if(x===y){return 0;}
if(x<y){return-1;}
if(x>y){return 1;}});return hashService.hashCode(arr.toString());};_getOldestKey=function(keySet){var pointer={timestamp:Date.now()},key,oldestKey;for(key in keySet){if(keySet[key].timestamp<pointer.timestamp){pointer=keySet[key];oldestKey=key;}}
return oldestKey;};return{get:get,put:put};}]);}());(function(){'use strict';angular.module('search.directives',[]);})();(function($){'use strict';var module=angular.module('search.directives');module.directive('refinePanel',['facetStateService',function(facetStateService){return{restrict:'E',require:'^searchBar',templateUrl:'/static/js/angular/apps/search/partials/_refinePanel.html',link:function(scope){scope.showOrderMostPopularOptions=false;scope.fileType='photos';scope.$watchCollection(function(){var order=facetStateService.getFacet('order');return{yearPopular:order.yearPopular,monthPopular:order.monthPopular,allTimePopular:order.allTimePopular,bestMatch:order.bestMatch,new:order.new};},function(facets){if(facets.yearPopular||facets.monthPopular||facets.allTimePopular){scope.showOrderMostPopularOptions=true;}else if(facets.bestMatch||facets.new){scope.showOrderMostPopularOptions=false;}},true);scope.$watch(function(){return facetStateService.getFacet('abstractType');},function(abstractTypeFacet){angular.forEach(abstractTypeFacet,function(selected,type){if(selected){scope.fileType=type;}});},true);scope.$watch(function(){return facetStateService.allOptionsActive('abstractType');},function(allOptionActive){if(allOptionActive===true){scope.searchData.showRefinePanel=false;}},true);scope.validFor=function(types){var typeList=types.split(',');return $.inArray(scope.fileType,typeList)!==-1;};scope.invalidFor=function(types){return scope.validFor(types);};}};}]);}(jQuery));(function(){'use strict';var module=angular.module('search.directives');module.directive('refineModal',['facetStateService',function(facetStateService){return{restrict:'E',templateUrl:'/static/js/angular/apps/search/partials/_refineModal.html',link:function($scope){$scope.fileType='photos';$scope.$watch(function(){return facetStateService.getFacet('abstractType');},function(abstractTypeFacet){angular.forEach(abstractTypeFacet,function(selected,type){if(selected){$scope.fileType=type;}});},true);$scope.validFor=function(types){var typeList=types.split(',');return jQuery.inArray($scope.fileType,typeList)!==-1;};$scope.invalidFor=function(types){return $scope.validFor(types);};$scope.onSubmit=function(){$scope.searchData.showRefinePanel=false;};}};}]);}());(function(){'use strict';var module=angular.module('search.directives');module.directive('facetGroup',['facetStateService','facetService','whatIfsService','resultsService','alternateViewService','OMNITURE_EVENTS',function(facetStateService,facetService,whatIfsService,resultsService,alternateViewService,OMNITURE_EVENTS){var partialPath='/static/js/angular/apps/search/partials/facets/';return{restrict:'E',scope:{name:'@',display:'@',showActive:'@',hasSubFacet:'@',orientation:'@?',mobileView:'@',parentFacet:'@'},templateUrl:[partialPath,'_facetGroup.html'].join(''),link:function(scope,element){var templateType,deregisterInit,badgeElement=angular.element('<span class="badge"></span>');scope.facetGroup={};scope.selectedOption=[];scope.isVisible=false;scope.name='';scope.initRun=false;scope.activeOptionDisplay='';deregisterInit=scope.$watch(function(){return facetStateService.isInitialized();},function(){scope.initFacetGroup();});scope.$watch(function(){return facetStateService.getActiveValues(scope.name);},function(){if(facetStateService.isInitialized()){scope.setActiveOptionDisplay();}},true);scope.$watch(function(){return facetStateService.hasActiveFacets(scope.name);},function(){scope.updateBadge(scope.name);});scope.initFacetGroup=function(){deregisterInit();if(!angular.isArray(scope.name)){scope.name=scope.name.split(',');}
if(scope.name.length===1){scope.name=scope.name[0];}
if(angular.isArray(scope.name)){for(var i=0;i<scope.name.length;i++){scope.facetGroup[scope.name[i]]=facetService.getFacetGroup(scope.name[i]).facets;}
templateType='multi';}else{if(scope.name.indexOf('order')!==-1&&scope.mobileView){scope.facetGroup[scope.name]=facetService.getFacetGroup(scope.name).mixedFacets;}else if(scope.name.indexOf('color')!==-1){scope.facetGroup[scope.name]=facetService.getFacetGroup(scope.name);}else if(scope.hasSubFacet){scope.facetGroup[scope.name]=facetService.getFacetGroup(scope.name).subFacets;}else{scope.facetGroup[scope.name]=facetService.getFacetGroup(scope.name).facets;}
templateType=facetService.getFacetGroup(scope.name).type;}
if(scope.name.indexOf('color')!==-1){scope.selectedOption=facetStateService.getActiveValues(scope.name)[0];}
scope.initRun=true;};scope.getTemplate=function(){var template;switch(templateType){case'multi':case'multi-null-complete':template='_multi.html';break;case'color':template='_color.html';break;default:template='_single.html';}
return[partialPath,template].join('');};scope.updateBadge=function(name){var hasActiveValues;if(!scope.initRun||!name){return;}
hasActiveValues=facetStateService.hasActiveFacets(name);if(name!=='order'&&hasActiveValues){element.find('.descriptor').prepend(badgeElement);}else{if((name==='collectionPrice'&&facetStateService.getActiveValues('exclusiveContributor').length>0)||(name==='exclusiveContributor'&&facetStateService.getActiveValues('collectionPrice').length>0)){return;}
element.find('.badge').remove();}};scope.facetChanged=function(name,value){var groupType;if(scope.disableFacetOption(name,value)){return;}
facetStateService.setFacet('pageNumber',1);groupType=facetService.getFacetGroup(name).type;if(groupType==='color'){facetStateService.setFacet(name,value);scope.selectedOption=facetStateService.getActiveValues(scope.name)[0];}else{if(groupType==='single'){facetStateService.clearFacetGroup(name);}
facetStateService.toggleFacet(name,value);if(groupType==='multi-null-complete'){if(facetStateService.allOptionsActive(name)){facetStateService.clearFacetGroup(name);}}}
scope.updateBadge(name);scope.$emit(OMNITURE_EVENTS.SRP.SRP_SEARCH_UPDATE,name,value);};scope.disableFacetOption=function(facetName,value){if(facetService.getFacetGroup(facetName).type==='single'&&facetService.getFacetGroup(facetName).default===value){return false;}
if(scope.getOptionState(facetName,value)||facetName==='color'){return false;}
if(!resultsService.getTotalResults()||whatIfsService.facetHasZeroCountWhatIf(facetName,value)){return true;}
return false;};scope.disableFacetGroupDropdown=function(facetGroup){var disableFacetGroupDropdown=true;if(scope.name==='color'){return false;}
angular.forEach(facetGroup,function(facetOptions,facetGroupName){angular.forEach(facetOptions,function(optionObject){if(!(scope.disableFacetOption(facetGroupName,optionObject.value))){disableFacetGroupDropdown=false;}});});return disableFacetGroupDropdown;};scope.getOptionState=function(name,value){if(value==='yearPopular'&&!scope.hasSubFacet&&!scope.mobileView){if(facetStateService.getOptionState(name,'yearPopular')||facetStateService.getOptionState(name,'allTimePopular')||facetStateService.getOptionState(name,'monthPopular')){return true;}}
return facetStateService.getOptionState(name,value);};scope.setActiveOptionDisplay=function(){var thisGroup=scope.facetGroup[scope.name];if(!scope.initRun){return;}
var activeValueAry,outputAry=[],nameAry;scope.activeOptionDisplay='';if(!angular.isArray(scope.name)){nameAry=scope.name=scope.name.split(',');}else{nameAry=scope.name;}
if(scope.name.length===1){scope.name=scope.name[0];}
activeValueAry=facetStateService.getActiveValues(scope.name);if(scope.parentFacet){if(thisGroup[activeValueAry[0]]){scope.activeOptionDisplay=thisGroup[activeValueAry[0]].display;return;}else if(scope.name==='order'){scope.activeOptionDisplay=thisGroup.mostPopular.display;return;}}
if(scope.showActive&&activeValueAry.length){if(nameAry.length>1){angular.forEach(activeValueAry,function(val){angular.forEach(nameAry,function(facetName){angular.forEach(scope.facetGroup[facetName],function(facetVal){if(val.toString()===facetVal.value.toString()){outputAry.push(facetVal.display);}});});});scope.activeOptionDisplay=outputAry.join(', ');}else if(scope.name==='color'){scope.activeOptionDisplay=activeValueAry[0];}else{if(thisGroup[activeValueAry[0]]){angular.forEach(activeValueAry,function(facetVal){outputAry.push(thisGroup[facetVal].display);});scope.activeOptionDisplay=outputAry.join(', ');}else{if(activeValueAry[0]==='false'||activeValueAry[0]==='true'){angular.forEach(activeValueAry,function(selectedVal){angular.forEach(thisGroup,function(facetVal){if(selectedVal.toString()===facetVal.value.toString()){outputAry.push(facetVal.display);}});});scope.activeOptionDisplay=outputAry.join(', ');}else{if(thisGroup[activeValueAry[0]]){scope.activeOptionDisplay=thisGroup[activeValueAry[0]].display;}}}}}};scope.isAdmin=function(){return alternateViewService.getAlternateView().admin;};}};}]);}());(function(){'use strict';var module=angular.module('search.directives');module.directive('keywordTags',['$sce','$window','$timeout','$rootScope','facetStateService','alternateViewService',function($sce,$window,$timeout,$rootScope,facetStateService,alternateViewService){return{restrict:'E',require:'ngModel',scope:{tags:'=ngModel',pendingTags:'=',inputFocus:'='},replace:true,templateUrl:'/static/js/angular/apps/search/partials/_keywordTags.html',link:function(scope){scope.$watchCollection(function(){return[facetStateService.getFacet('lightboxID'),facetStateService.getFacet('portfolioID')];},function(views){if(views[0]){scope.altViewSearch='Lightbox';}else if(views[1]){scope.altViewSearch='Portfolio';}else{alternateViewService.clearSingleAlternateView();scope.altViewSearch=false;}});scope.removeAltView=function(){facetStateService.clearAltViewFacets();alternateViewService.clearSingleAlternateView();facetStateService.setFileTypeToDefault();scope.altViewSearch=false;};scope.remove=function(index,$event){var keyword=[];$event.stopPropagation();scope.tags.splice(index,1);if(scope.tags.length>0){keyword.push(scope.tags.join(' '));}
facetStateService.setFacet('text',keyword);};scope.keywordOnFocus=function(){return scope.inputFocus;};scope.setFocusSearchBar=function(index){scope.$parent.focus(index);};scope.edit=function(index){var position=0,keywordList=facetStateService.getFacet('text').join(' ').split(' '),input=document.getElementById('search-bar-input'),keyword,i;for(i=0;i<=index;i++){keyword=keywordList[i].toLowerCase();if(keyword==='and'){position+=keyword.length+1;}
position+=scope.tags[i].length;}
position+=index;scope.setFocusSearchBar(index);$timeout(function(){input.focus();input.setSelectionRange(position,position);},0,false);};scope.sanitizeTag=function(tag){var splitTags,operator,output;if(!tag||typeof tag!=='string'){return;}
splitTags=tag.split(' ');operator=splitTags[0];output=tag;if(operator==='NOT'||operator==='OR'){splitTags.shift();splitTags.join(' ');output=['<span class="boolean ',operator.toLowerCase(),'">',operator,' </span>',splitTags.join(' ')].join(' ');}
return $sce.trustAsHtml(output);};scope.$watchCollection(function(){return[scope.tags,scope.pendingTags];},function(newValues){var newTags=newValues[0];if(newTags===null&&facetStateService.getFacet('text').length>0&&(typeof scope.pendingTags==='undefined'||scope.pendingTags.length===0)){newTags=facetStateService.getFacet('text').slice();scope.tags=newTags;}});}};}]);}());(function(){'use strict';var module=angular.module('search.directives');module.directive('pagination',['$rootScope','$timeout','facetStateService','metadataService','OMNITURE_EVENTS',function($rootScope,$timeout,facetStateService,metadataService,OMNITURE_EVENTS){return{restrict:'E',templateUrl:'/static/js/angular/apps/search/partials/_pagination.html',scope:{currentPage:'=',perPage:'=',totalResults:'='},link:function($scope,$element){var resizeInputField,validateNewPage,onKeyMovement,doc=angular.element(document);$scope.totalPages=0;$scope.pageInput=1;$scope.urls={};$scope.$watchCollection('[currentPage, totalResults, perPage]',function(){if($scope.totalResults){$scope.totalPages=Math.ceil($scope.totalResults/$scope.perPage);$scope.pageInput=$scope.currentPage;$scope.urls=metadataService.getSeoLinkUrls($scope.currentPage,$scope.totalPages);}});$scope.$watch('pageInput',function(newPage,oldPage){if(isNaN(newPage)){$scope.pageInput=oldPage;}else{resizeInputField(newPage);}});$scope.onPreviousPage=function(){var page=$scope.currentPage-1;if(page){$scope.requestPage(page);$scope.$emit(OMNITURE_EVENTS.SRP.SRP_SEARCH_UPDATE,'prevPage','');}};$scope.onNextPage=function(){var page=$scope.currentPage+1;if(page<=$scope.totalPages){$scope.requestPage(page);$scope.$emit(OMNITURE_EVENTS.SRP.SRP_SEARCH_UPDATE,'nextPage','');}};$scope.onFinalPage=function(){$scope.requestPage($scope.totalPages);};$scope.requestPage=function(page){page=validateNewPage(page);if(page!==$scope.currentPage){if(page===$scope.currentPage+1){$rootScope.$broadcast('srpNextPage');}
facetStateService.setFacet('pageNumber',page);$scope.scrollToTop();}};$scope.scrollToTop=function(){var topOfSearchBar=angular.element('.srp-container').position().top;angular.element('html,body').animate({scrollTop:topOfSearchBar},550,function(){$rootScope.$broadcast('srpFinishedScrolling');});};$element.find('input.num').bind('keydown keypress',function(event){if(event.which===13){this.blur();$scope.$apply();}}).bind('blur',function(){$scope.requestPage($scope.pageInput);$scope.$apply();}).bind('click',function(){this.select();});resizeInputField=function(page){var newWidth;if(page!==undefined){var pageDigits=page.toString().length,padding=9*2,charWidth=9;newWidth=((pageDigits+1)*charWidth)+padding+'px';$element.find('input.num').width(newWidth);}};validateNewPage=function(page){if(page<1){page=1;}else if(page>$scope.totalPages){page=$scope.totalPages;}
return parseInt(page);};onKeyMovement=function(e){if(document.activeElement.id==='search-bar-input'){return;}
switch(e.keyCode){case 37:$scope.onPreviousPage();$scope.$apply();break;case 39:$scope.onNextPage();$scope.$apply();break;}};doc.on('keydown',onKeyMovement);$scope.$on('$destroy',function(){doc.off('keydown',onKeyMovement);});}};}]);}());(function(){'use strict';var module=angular.module('search.directives');module.directive('zeroResults',['facetStateService','categoriesService','$filter',function(facetStateService,categoriesService,$filter){return{restrict:'E',scope:{keywords:'='},templateUrl:'/static/js/angular/apps/search/partials/_zeroResults.html',link:function(scope){var categories=[{category:'arts abstract',title:$filter('i18n')('ABSTRACT')},{category:'animals',title:$filter('i18n')('ANIMALS')},{category:'architecture',title:$filter('i18n')('ARCHITECTURE')},{category:'babies',title:$filter('i18n')('BABIES')},{category:'backgrounds',title:$filter('i18n')('BACKGROUNDS')},{category:'beauty',title:$filter('i18n')('BEAUTY')},{category:'business',title:$filter('i18n')('BUSINESS')},{category:'celebration',title:$filter('i18n')('CELEBRATION')},{category:'children',title:$filter('i18n')('CHILDREN')},{category:'dogs',title:$filter('i18n')('DOGS')},{category:'family pictures',title:$filter('i18n')('FAMILY_PICTURES')},{category:'fashion',title:$filter('i18n')('FASHION')},{category:'fitness',title:$filter('i18n')('FITNESS')},{category:'flowers',title:$filter('i18n')('FLOWERS')},{category:'food',title:$filter('i18n')('FOOD')},{category:'holidays',title:$filter('i18n')('HOLIDAYS')},{category:'body',title:$filter('i18n')('HUMAN_ANATOMY')},{category:'landscapes',title:$filter('i18n')('LANDSCAPES')},{category:'lifestyle',title:$filter('i18n')('LIFESTYLE')},{category:'love',title:$filter('i18n')('LOVE')},{category:'medical',title:$filter('i18n')('MEDICAL')},{category:'nature',title:$filter('i18n')('NATURE')},{category:'people',title:$filter('i18n')('PEOPLE')},{category:'pets',title:$filter('i18n')('PETS')},{category:'romance',title:$filter('i18n')('ROMANCE')},{category:'sports',title:$filter('i18n')('SPORTS')},{category:'technology',title:$filter('i18n')('TECHNOLOGY')},{category:'travel',title:$filter('i18n')('TRAVEL')},{category:'vintage',title:$filter('i18n')('VINTAGE')},{category:'wildlife',title:$filter('i18n')('WILDLIFE')}];scope.categoryList=[];categories.forEach(function(category){scope.categoryList.push({url:categoriesService.categoryUrl(category.category),display:category.title});});scope.hasActiveFacets=function(){return facetStateService.hasActiveFacets(facetStateService.filterFacets);};scope.formattedKeywords=function(){var formattedkeywords='';if(scope.keywords){formattedkeywords=scope.keywords.join(' AND ');}
return formattedkeywords;};scope.getAbstractType=function(){var abstractTypeStr='';if(facetStateService.getActiveValues('abstractType').length>1){abstractTypeStr='images';}else{abstractTypeStr=facetStateService.getActiveValues('abstractType')[0];}
return abstractTypeStr;};scope.displayError=function(){var error='';if(scope.hasActiveFacets()&&scope.keywords>=1){error=$filter('i18n')('ZERO_RESULTS');}else{error=$filter('i18n')('CATEGORIES_NOT_SURE_WHERE_TO_START');}
return error;};scope.displaySuggestion=function(){var suggestion='';if(scope.hasActiveFacets()){suggestion=$filter('i18n')('CHECK_THAT_EVERYTHING_SPELLED_REFINE');}else{if(scope.keywords&&scope.keywords.length>1){suggestion=$filter('i18n')('CHECK_THAT_EVERYTHING_SPELLED');}else if(scope.keywords&&scope.keywords.length===1){suggestion=$filter('i18n')('SPELLED_CORRECTLY_OR_NEW_KEYWORD');}else{suggestion=$filter('i18n')('CATEGORIES_ENTER_A_KEYWORD');}}
return suggestion;};scope.setOmnitureCookie=function(name){var cookieName='c_c',d=new Date(),expires='';d.setTime(d.getTime()+(1*24*60*60*1000));expires='expires='+d.toUTCString();document.cookie=cookieName+'='+name+';expires='+
expires+';domain=.istockphoto.com;path=/';};}};}]);}());(function(){'use strict';angular.module('search.filters',[]);})();(function(){'use strict';var APP='search',APP_PATH='js/angular/apps/'+APP+'/';angular.module(APP,['ngRoute','ngAnimate','ipCookie','restangular','ngSanitize','sly','angular-locker','isLocalization','angular-loading-bar','common.constants','common.filters','common.services','common.directives','common.controllers',APP+'.controllers',APP+'.directives',APP+'.filters',APP+'.constants',APP+'.services']).config(['$locationProvider','$routeProvider','$sceDelegateProvider','cfpLoadingBarProvider','isLocalizeProvider','lockerProvider','RestangularProvider','siteLang','translations',function($loc,$routeProvider,$sce,loadingBarProvider,isLocalizeProvider,lockerProvider,RestangularProvider,siteLang,translations){var partialsPath=['/static/',APP_PATH,'partials'].join(''),whitelist=[/(?:http(?:s)?:\/\/)?(?:[^\.]+\.)(istock)(img|photo)\.com(.*)?/,'self'],cache={};$sce.resourceUrlWhitelist(whitelist);$routeProvider.otherwise({templateUrl:partialsPath+'/index.html',reloadOnSearch:false});$loc.html5Mode(true).hashPrefix('!');cache[siteLang]=translations;isLocalizeProvider.setOptions({baseUrl:['/static/',APP_PATH,'i18n/'].join(''),language:siteLang,cache:cache,loadResourceOnInit:true});RestangularProvider.setDefaultHeaders({'Content-Type':'application/json','X-Requested-With':'XMLHttpRequest'});RestangularProvider.setBaseUrl('/api/');loadingBarProvider.parentSelector='.search-loader';loadingBarProvider.includeSpinner=false;loadingBarProvider.includeBar=true;lockerProvider.defaults({driver:'session',namespace:'srp'});}]);}());(function(){'use strict';var search=angular.module('search.controllers'),SEARCH_KEY='facets',VISITED_COOKIE='visitedSRP';search.controller('SearchCtrl',['$scope','$location','$timeout','$debounce','$http','$q','facetStateService','searchRequestService','accountService','alternateViewService','whatIfsService','resultsService','metadataService','preferenceService','gettyMasterIdService','assetService','userService','$injectedData','urlBuilder','redirect','ipCookie','ABSTRACT_TYPE','legacyFacetService','srpOmnitureService','OMNITURE_EVENTS','SEARCH_STATE','LIGHTBOX_EVENTS','baseUrl','$window','SEARCH','searchValues','lazyImageService',function($scope,$location,$timeout,$debounce,$http,$q,facetStateService,searchRequestService,accountService,alternateViewService,whatIfsService,resultsService,metadataService,preferenceService,gettyMasterIdService,assetService,userService,$injectedData,urlBuilder,redirect,ipCookie,ABSTRACT_TYPE,legacyFacetService,srpOmnitureService,OMNITURE_EVENTS,SEARCH_STATE,LIGHTBOX_EVENTS,baseUrl,$window,SEARCH,searchValues,lazyImageService){lazyImageService.enabled=false;$scope.facetFreshness=(new Date()).getTime();$scope.viewState={showFilterOnSub:false,filterOnSub:false,filterOnSubPref:true,header:'',adpUrlST:window.prerenderReady===undefined};$scope.alternateView=alternateViewService.getAlternateView();$scope.searchData={searchResponse:{},showRefinePanel:false,allowRefineFacets:true,singleView:alternateViewService,showKeywordTags:false};$scope.location={ignore:false};$scope.account=null;$scope.error={showErrorMessage:false,errorMessage:''};$scope.fileTypeMapping=ABSTRACT_TYPE;$scope.omnitureClickEvent=null;$scope.initFlag=false;$scope.nextPageRequested=false;$scope.init=function(){$scope.initFlag=true;lazyImageService.prioritizeFirstBatch=true;$scope.setupPreferences().then(preferenceService.initSearchPreferences).then(function(prefs){if(prefs){$scope.preferences=prefs;}
$scope.setupFacets();$scope.$on('$routeUpdate',$scope.onLocationChange);$scope.setupHeader();$scope.initializeAccount().finally(function(){$scope.setupFilterOnSub();$scope.setThumbnailSize();$scope.triggerSearch(true);$scope.$watch(function(){if(facetStateService.isDirty()){$scope.facetFreshness=(new Date()).getTime();}
return $scope.facetFreshness;},function(newVal,oldVal){if(newVal!==oldVal){$scope.triggerSearch(true);$scope.updateUrl();lazyImageService.enabled=true;}});});});angular.element(angular.element($window)).on('scroll',function(){if($window.pageYOffset/(angular.element('.inner-wrap').height()-$window.innerHeight)>0.5&&!$scope.nextPageRequested){$scope.preFetchNextPage();$scope.nextPageRequested=true;}});};$scope.$on('srpNextPage',function(){angular.element('.search-list li').removeClass('loaded');});$scope.$on('srpFinishedScrolling',function(){$scope.nextPageRequested=false;});$scope.preFetchNextPage=function(){searchRequestService.executeSearchNextPage(facetStateService.build(),{initFlag:false});};$scope.setupFacets=function(){facetStateService.initDefaultValues();$scope.initFacetsFromURL();localStorage.setItem('typesSelectedSRP',angular.toJson(facetStateService.getActiveValues('abstractType')));};$scope.setupLocation=function(){$scope.$on('$routeUpdate',$scope.onLocationChange);};$scope.setupPreferences=function(){var deferred=$q.defer();if($injectedData.params.preferences){deferred.resolve($injectedData.params.preferences);}else{preferenceService.getPreferences().then(function(data){deferred.resolve(angular.fromJson(data));});}
return deferred.promise;};$scope.urlIsFormatted=function(){var searchPath=$location.search()[SEARCH_KEY],facets=angular.fromJson(searchPath);return facets&&facets[SEARCH.FORMATTED_KEY];};$scope.initFacetsFromURL=function(){var isFormatted=$scope.urlIsFormatted(),searchPath=$location.search()[SEARCH_KEY],injectedData,facets,fileType;if(searchPath){facets=angular.fromJson(decodeURI(searchPath));}
if(isFormatted){$scope.initFromFacets(facets);}else{injectedData=$injectedData.params;if('module'in injectedData&&injectedData.module==='administration'){facetStateService.setFacet('adminSearch',true);}
if($location.search()[SEARCH_KEY]){legacyFacetService.initFromLegacyFacets(facets);if(facetStateService.getFacet('portfolioID')){$scope.setAltView('portfolio','portfolioID','',facetStateService.getFacet('portfolioID'));facetStateService.activateAllOptions('abstractType');}
if(facetStateService.getFacet('lightboxID')){$scope.setAltView('lightbox','lightboxID','',facetStateService.getFacet('lightboxID'));facetStateService.activateAllOptions('abstractType');}}else{if(injectedData.text){facetStateService.setFacet('text',[injectedData.text]);}
if(injectedData.collection){facetStateService.toggleFacet('collectionPrice',injectedData.collection);facetStateService.setFacetOption('date','sixMonths',true);facetStateService.toggleFacet('abstractType','photos');facetStateService.toggleFacet('abstractType','illustrations');}
if(injectedData.subscriptionCollection){facetStateService.setFacet('subscriptionCollection',injectedData.subscriptionCollection);}
if($scope.isAbstractType(injectedData.filetype)){fileType=facetStateService.mapLegacyFacetValue(injectedData.filetype);facetStateService.toggleFacet('abstractType',fileType);if(fileType==='audio'){facetStateService.setFacet('additionalAudio','true');}}else if($scope.checkIfAltView()){facetStateService.activateAllOptions('abstractType');facetStateService.setFacet('additionalAudio','true');}else{facetStateService.toggleFacet('abstractType','photos');facetStateService.toggleFacet('abstractType','illustrations');}
$scope.seoPageHack();}
$scope.updateUrl(false);$location.replace();}};$scope.seoPageHack=function(){var pageParam=$location.search().page;if(pageParam){facetStateService.setFacet('pageNumber',parseInt(pageParam));}};$scope.initFromFacets=function(facets){facetStateService.initFromFacets(facets);if(facetStateService.getFacet('portfolioID')||facetStateService.getFacet('lightboxID')){$scope.checkIfAltView();}};$scope.initializeAccount=function(){return accountService.getAccount().then(function(account){if(account){$scope.account=account;}});};$scope.optOut=function(){var fileType=facetStateService.getActiveValues('abstractType'),searchTerm=facetStateService.getFacet('text'),mapFileType='',keyword='';angular.forEach(fileType,function(type){if(mapFileType){mapFileType+=',';}
mapFileType+='"'+ABSTRACT_TYPE[type]+'"';});if(searchTerm.toString()){keyword=',"35":["'+searchTerm.toString()+'"]';}
$scope.srpOptoutLink=baseUrl+location.pathname+'?facets={"34":['+mapFileType+']'+
keyword+'}'+'&optout=2';srpOmnitureService.oldSrpToggle();$window.location=$scope.srpOptoutLink;};$scope.removeSearchBarFocus=function(){$timeout(function(){angular.element('#search-bar-input').blur();},0,false);$scope.searchData.showKeywordTags=false;};$scope.setupFilterOnSub=function(){var accountType;if($scope.account&&$scope.account.hasSub){accountType=$scope.account.sub.type;}else if(accountService.getSubTypeCookie()){accountType=accountService.getSubTypeCookie();}
$scope.setupSubFilter(accountType);};$scope.setupSubFilter=function(accountType){var typeWatch=function(newType,oldType){var shouldShow=newType.photos||newType.illustrations;if(newType!==oldType){$scope.viewState.showFilterOnSub=shouldShow;if(!shouldShow){$scope.viewState.filterOnSub=false;}else if($scope.viewState.filterOnSubPref){$scope.viewState.filterOnSub=$scope.viewState.filterOnSubPref;}}},filterWatch=function(shouldFilter,oldFilter){if(shouldFilter!==oldFilter){if($scope.viewState.showFilterOnSub){$scope.viewState.filterOnSubPref=shouldFilter;}
facetStateService.setFacet('subscriptionCollection',{standard:shouldFilter});}};if(accountType&&accountType==='essentials'){$scope.viewState.showFilterOnSub=true;$scope.$watch(function(){return facetStateService.getFacet('abstractType');},typeWatch,true);$scope.$watch('viewState.filterOnSub',filterWatch);typeWatch(facetStateService.getFacet('abstractType'));filterWatch($scope.viewState.filterOnSub);}};$scope.toggleEssentialSub=function(){$scope.viewState.filterOnSub=!$scope.viewState.filterOnSub;$scope.omnitureClickEvent={name:'essentialSubsToggle',value:''};};$scope.setUpView=function(){var injectedData=$injectedData.params,activeValues;if($scope.searchData.searchResponse.totalResults===0||$scope.searchData.searchResponse.totalResults===null){alternateViewService.setAlternateView('zeroResults',true);}else{alternateViewService.setAlternateView('zeroResults',false);}
activeValues=facetStateService.getActiveValues('abstractType');if(activeValues.length===1&&activeValues[0]==='audio'){alternateViewService.setAlternateView('audio',true);}else{alternateViewService.setAlternateView('audio',false);}
if(injectedData.module&&injectedData.module==='administration'){alternateViewService.clearSingleAlternateView();alternateViewService.setAlternateView('admin',true);facetStateService.setFacet('adminSearch',true);}};$scope.setupHeader=function(){if(!ipCookie(VISITED_COOKIE)){$scope.$watchCollection(function(){return[facetStateService.getFacet('text'),facetStateService.getFacet('abstractType')];},function(newValues){var text=newValues[0][0],abstractType=facetStateService.getActiveValues('abstractType'),displayType,keywords;if(text&&text.length>0){keywords=text[0].toUpperCase()+text.slice(1);if(abstractType.length!==1){displayType='images';}else{displayType=abstractType[0];}
switch(displayType){default:case'photos':$scope.viewState.header=[keywords,'Stock Photos'].join(' ');break;case'illustrations':$scope.viewState.header=[keywords,'Illustrations and Vectors'].join(' ');break;case'video':$scope.viewState.header=[keywords,'Video Footage'].join(' ');break;case'audio':$scope.viewState.header=[keywords,'Stock Music'].join(' ');break;}}});}
ipCookie(VISITED_COOKIE,true);};$scope.triggerSearch=function(dirty){var text,handleResults;if(dirty){handleResults=function(){whatIfsService.setWhatIfs($scope.searchData.searchResponse.whatIfs);$scope.setUpView();$scope.removeSearchBarFocus();};text=facetStateService.getFacet('text');if(text&&text.length===1){$scope.checkKeywordForFileID(text);}
$scope.searchData.allowRefineFacets=!facetStateService.allOptionsActive('abstractType');if($scope.initFlag){$scope.executeSearchFromLocal();$scope.initFlag=false;handleResults();}else{$scope.executeSearch().finally(handleResults);}
facetStateService.resetDirty();}
$scope.removeSearchBarFocus();};$scope.executeSearch=$debounce(function(){SEARCH_STATE.EXECUTING_SEARCH=true;return searchRequestService.executeSearch(facetStateService.build(),{initFlag:$scope.initFlag}).then(function(response){$scope.initFlag=false;return $scope.handleResultResponse(response);});},100);$scope.executeSearchFromLocal=function(){SEARCH_STATE.EXECUTING_SEARCH=true;$scope.initFlag=false;var response=searchRequestService.loadLocalResults(facetStateService.build());$scope.handleResultResponse(response);};$scope.handleResultResponse=function(response){if(response.isLatest){metadataService.setMetadata(response);resultsService.setSearchResponse(response);if(response.totalResults===null){response.totalResults=0;}
$scope.results=response.results;$scope.searchToken=response.internal.searchToken.substring(0,7);$scope.searchData.searchResponse=response;$scope.$emit('NEW_SEARCH_RESULTS');SEARCH_STATE.EXECUTING_SEARCH=false;}
$timeout(function(){$scope.sendToOmniture();},0);};$scope.isExecutingSearch=function(){return SEARCH_STATE.EXECUTING_SEARCH;};$scope.getUserProfileUri=function(username){return userService.getProfileUri(username);};$scope.isAbstractType=function(type){var types=['videos','music'],found=false;angular.forEach(facetStateService.getFacet('abstractType'),function(value,name){this.push(name);},types);angular.forEach(types,function(value){if(type===value){found=true;}});return found;};$scope.updateUrl=function(ignore){var facets=facetStateService.build();facets[SEARCH.FORMATTED_KEY]=true;$location.search(SEARCH_KEY,angular.toJson(facets));if(angular.isUndefined(ignore)||ignore){$scope.location.ignore=true;}
updateAuthLinks();};$scope.onLocationChange=function(){if(!$scope.location.ignore){var facets=angular.fromJson($location.search()[SEARCH_KEY]);$scope.initFromFacets(facets);facetStateService.resetDirty();$scope.triggerSearch(true);}else{$scope.location.ignore=false;}};$scope.setThumbnailSize=function(){$scope.imgThumbnail='thumb_190';$scope.videoThumbnail='html5ThumbSmall';if(Breakpoints.isMatched({name:'LARGE_UP_BREAKPOINT'})){$scope.imgThumbnail='srpThumb';$scope.videoThumbnail='html5ThumbMedium';}};$scope.checkIfAltView=function(){var injectedData=$injectedData.params;if(facetStateService.getFacet('portfolioID')&&injectedData.action!=='portfolio'){return true;}
if(injectedData.action==='portfolio'){$scope.setAltView('portfolio','portfolioID',injectedData.username,injectedData.portfolioID);return true;}else if(injectedData.action==='lightbox'){$scope.setAltView('lightbox','lightboxID',injectedData.lightboxName,parseInt(injectedData.id));return true;}
return false;};$scope.setAltView=function(viewName,facetName,title,id){alternateViewService.clearSingleAlternateView();alternateViewService.setAlternateView(viewName,{state:true,name:title});facetStateService.setFacet(facetName,id);};$scope.checkKeywordForFileID=function(text){var keyword=text[0];if(keyword[0]==='#'){keyword=keyword.substr(1);}
if(isNaN(keyword)){return;}
keyword=parseInt(keyword);gettyMasterIdService.getMasterId(keyword).then(function(gettyObject){if(gettyObject&&gettyObject.gettyMasterId){assetService.getAsset(gettyObject.gettyMasterId).then(function(){urlBuilder.build(keyword,facetStateService.getFacet('abstractType')).then(function(url){redirect.to(url);});}).catch(function(){return;});}}).catch(function(){return;});};$scope.$on(OMNITURE_EVENTS.SRP.SRP_SEARCH_UPDATE,function(event,name,value){$scope.omnitureClickEvent={name:name,value:value};});$scope.sendToOmniture=function(){var injectedData=$injectedData.params,data={abstractType:facetStateService.getActiveValues('abstractType'),userID:injectedData.userID,filterOnSub:$scope.viewState.filterOnSub,keyword:facetStateService.getFacet('text'),alternateViews:alternateViewService.getAlternateView().singleViews,totalResults:$scope.searchData.searchResponse.totalResults||0,pageNumber:facetStateService.getFacet('pageNumber'),sortOrder:facetStateService.getActiveValues('order'),searchSegment:$scope.searchData.searchResponse.internal.segmentId,curatedSearch:$scope.searchData.searchResponse.internal.krAdjustmentInfo,keywordRelevance:$scope.searchData.searchResponse.internal.standardDeviationPixel,resultsPerPage:$scope.searchData.searchResponse.perPage,results:$scope.searchData.searchResponse.results,metrics:$scope.searchData.searchResponse.internal.metrics,keywordLanguage:$scope.searchData.searchResponse.internal.legacy.choiceLangId,compositionFilter:facetStateService.getActiveValues('orientation'),colorFilter:facetStateService.getFacet('color'),aspectRatioVideo:facetStateService.getActiveValues('aspectRatioVideo'),videoSize:facetStateService.getActiveValues('videoSize'),tempo:facetStateService.getActiveValues('tempo'),audioKey:facetStateService.getActiveValues('audioKey'),audioPrice:facetStateService.getActiveValues('audioPrice'),collectionPrice:facetStateService.getActiveValues('collectionPrice'),showPeople:facetStateService.getActiveValues('showPeople'),exclusiveContributor:facetStateService.getActiveValues('exclusiveContributor'),editorial:facetStateService.getActiveValues('editorial'),date:facetStateService.getActiveValues('date'),lightboxName:$scope.alternateView.singleViews.lightbox.name};if($scope.omnitureClickEvent){srpOmnitureService.facetChanged(data,$scope.omnitureClickEvent.name,$scope.omnitureClickEvent.value);$scope.omnitureClickEvent=null;}else{srpOmnitureService.srpPageLoad(data);}};$scope.correctSpelling=function(suggestion,misspelled){facetStateService.correctSpelling(suggestion,misspelled);};$scope.usersPerPage=function(){return facetStateService.getFacet('perPage');};$scope.getShowFileDetailsStatus=function(){return facetStateService.showFileDetails;};$scope.seoFriendlyTag=function(abstractType,isRaster){var friendlyTag='';switch(abstractType.id){case ABSTRACT_TYPE.photos:friendlyTag='stock photo';break;case ABSTRACT_TYPE.illustrations:if(isRaster){friendlyTag='illustration';}else{friendlyTag='vector art illustration';}
break;case ABSTRACT_TYPE.video:friendlyTag='video';break;case ABSTRACT_TYPE.audio:friendlyTag='music clip';break;}
return friendlyTag;};$scope.storeCoordinates=function(index){var grid,result={row:0,column:0};grid=srpOmnitureService.getNumberRowsAndColumns();result.row=Math.floor(index/grid.numPerRows)+1;result.column=index%grid.numPerRows+1;localStorage.setItem('assetClickedFromSRP',angular.toJson(result));};function updateAuthLinks(){var forEach=Array.prototype.forEach,qsa=document.querySelectorAll.bind(document),selector='.sign-in-cta, .join-cta',facets=facetStateService.build(true),url,hash;facets[SEARCH.FORMATTED_KEY]=true;url=$location.absUrl().replace(/\?.*/,'');url+='?facets='+angular.toJson(facets);hash=$window.btoa($window.encodeURIComponent(url));forEach.call(qsa(selector),function(link){var href=link.href,parts=href.split('/');parts=parts.slice(0,4);parts.push(hash);href=parts.join('/');link.href=href;});}
if(searchValues.init){$scope.init();}
$scope.$on(LIGHTBOX_EVENTS.LB_REMOVED_EVENT,function(event,args){if($scope.alternateView.singleViews.lightbox.state){for(var i=0;i<$scope.results.length;i++){if($scope.results[i].fileId===args.assetId){$scope.results.splice(i,1);$scope.searchData.searchResponse.totalResults=$scope.results.length||0;break;}}}});}]);}());(function(){'use strict';var search=angular.module('search.controllers');search.controller('DisplaySettingsCtrl',['$scope','$timeout','$filter','facetStateService','preferenceService','srpOmnitureService','OMNITURE_EVENTS','ipCookie',function($scope,$timeout,$filter,facetStateService,preferenceService,srpOmnitureService,OMNITURE_EVENTS,ipCookie){var preferenceMapping=preferenceService.getPreferenceFacetMapping();$scope.perPageValues=[20,50,100,200];$scope.perPage=facetStateService.getFacet('perPage');$scope.displaySettings=[{key:'removeAdultContent',name:$filter('i18n')('SHOW_ADULT_CONTENT'),value:false},{key:'excludeEditorial',name:$filter('i18n')('EXCLUDE_EDITORIALS'),value:false},{key:'showDetails',name:$filter('i18n')('SHOW_FILE_DETAILS'),value:facetStateService.showFileDetails}];$scope.changeSetting=function(key,value){var facet=preferenceMapping[key],preferences=$scope.$parent.preferences;switch(key){case'showDetails':facetStateService.showFileDetails=!facetStateService.showFileDetails;preferences[key]=!preferences[key];break;case'resultsPerPage':facetStateService.setFacet(facet,value);preferences[key]=value;break;default:facetStateService.toggleFacet(facet,value);preferences[key]=!preferences[key];break;}
ipCookie('sessionPreferences',preferences,{path:'/',expires:1,domain:'.istockphoto.com'});preferenceService.setPreferences(preferences);if(key==='showDetails'){srpOmnitureService.showFileDetailsDisplaySettingChanged(key);}else{$scope.$emit(OMNITURE_EVENTS.SRP.SRP_SEARCH_UPDATE,key,'');}};$scope.getOptionState=function(key,value){if(key==='showDetails'){return facetStateService.showFileDetails;}else{return facetStateService.getOptionState(preferenceMapping[key],value);}};}]);}());(function(){'use strict';angular.module('search.constants',[]);})();(function(){'use strict';angular.module('search.constants').value('searchValues',{init:true});}());